<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TruthLens Diagnostic</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #6366f1;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            font-weight: bold;
            margin-left: 10px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        .file-list {
            margin: 10px 0;
        }
        .file-list li {
            margin: 5px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>TruthLens CSS Diagnostic</h1>
        
        <div class="test-section">
            <h2>CSS File Loading Test</h2>
            <p>Testing which CSS files are loading correctly:</p>
            <ul class="file-list">
                <li>/static/css/styles.css: <span id="styles-status" class="status">Testing...</span></li>
                <li>/static/css/animations.css: <span id="animations-status" class="status">Testing...</span></li>
                <li>/static/css/truthlens-enhanced.css: <span id="enhanced-status" class="status">Testing...</span></li>
            </ul>
        </div>

        <div class="test-section">
            <h2>External Resources</h2>
            <ul class="file-list">
                <li>Font Awesome: <span id="fa-status" class="status">Testing...</span></li>
                <li>Google Fonts: <span id="fonts-status" class="status">Testing...</span></li>
                <li>Chart.js: <span id="chart-status" class="status">Testing...</span></li>
            </ul>
        </div>

        <div class="test-section">
            <h2>JavaScript Console Errors</h2>
            <pre id="console-errors">Checking for JavaScript errors...</pre>
        </div>

        <div class="test-section">
            <h2>CSS Variables Test</h2>
            <p>Testing if CSS variables are defined:</p>
            <pre id="css-vars">Testing CSS variables...</pre>
        </div>

        <div class="test-section">
            <h2>Network Requests</h2>
            <pre id="network-log">Monitoring network requests...</pre>
        </div>
    </div>

    <script>
        // Test CSS file loading
        async function testCSSFile(url, statusId) {
            try {
                const response = await fetch(url);
                const status = document.getElementById(statusId);
                
                if (response.ok) {
                    const text = await response.text();
                    if (text.includes(':root') || text.includes('body')) {
                        status.textContent = 'Loaded OK';
                        status.className = 'status success';
                    } else {
                        status.textContent = 'Empty/Invalid';
                        status.className = 'status warning';
                    }
                } else {
                    status.textContent = `Error ${response.status}`;
                    status.className = 'status error';
                }
            } catch (error) {
                document.getElementById(statusId).textContent = 'Failed to load';
                document.getElementById(statusId).className = 'status error';
            }
        }

        // Test external resources
        function testExternalResource(testFunc, statusId) {
            try {
                if (testFunc()) {
                    document.getElementById(statusId).textContent = 'Loaded';
                    document.getElementById(statusId).className = 'status success';
                } else {
                    document.getElementById(statusId).textContent = 'Not loaded';
                    document.getElementById(statusId).className = 'status error';
                }
            } catch (error) {
                document.getElementById(statusId).textContent = 'Error';
                document.getElementById(statusId).className = 'status error';
            }
        }

        // Capture console errors
        const errors = [];
        window.addEventListener('error', (e) => {
            errors.push(`${e.message} at ${e.filename}:${e.lineno}:${e.colno}`);
            document.getElementById('console-errors').textContent = errors.join('\n') || 'No errors detected';
        });

        // Test CSS variables
        function testCSSVariables() {
            const root = document.documentElement;
            const computedStyle = getComputedStyle(root);
            const variables = [
                '--primary',
                '--primary-dark',
                '--gray-50',
                '--space-md',
                '--radius'
            ];
            
            const results = variables.map(varName => {
                const value = computedStyle.getPropertyValue(varName);
                return `${varName}: ${value || 'NOT DEFINED'}`;
            });
            
            document.getElementById('css-vars').textContent = results.join('\n');
        }

        // Monitor network requests
        const networkLog = [];
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            networkLog.push(`FETCH: ${args[0]}`);
            updateNetworkLog();
            return originalFetch.apply(this, args);
        };

        function updateNetworkLog() {
            document.getElementById('network-log').textContent = networkLog.join('\n') || 'No requests logged';
        }

        // Run tests
        window.addEventListener('load', () => {
            // Test CSS files
            testCSSFile('/static/css/styles.css', 'styles-status');
            testCSSFile('/static/css/animations.css', 'animations-status');
            testCSSFile('/static/css/truthlens-enhanced.css', 'enhanced-status');
            
            // Test external resources
            testExternalResource(() => typeof Chart !== 'undefined', 'chart-status');
            testExternalResource(() => document.querySelector('[class*="fa-"]'), 'fa-status');
            testExternalResource(() => document.fonts.check('1em Inter'), 'fonts-status');
            
            // Test CSS variables
            setTimeout(testCSSVariables, 1000);
            
            // Update console errors
            setTimeout(() => {
                if (errors.length === 0) {
                    document.getElementById('console-errors').textContent = 'No JavaScript errors detected';
                }
            }, 2000);
        });
    </script>
</body>
</html>
