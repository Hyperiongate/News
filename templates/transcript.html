<!DOCTYPE html>
<html lang="en">
<head>
    <!-- 
    File: transcript.html
    Version: 6.2.0 - PROGRESS BAR FIXES + TIME ESTIMATES
    Last Updated: October 25, 2025
    Description: Standalone Transcript Fact-Checker with FIXED Progress Display
    
    LATEST CHANGES (October 25, 2025 - v6.2.0):
    ✅ FIXED: "Did You Know" facts now cycle properly every 4 seconds
    ✅ ADDED: Prominent time estimate banner at top of progress section
    ✅ FIXED: Fun facts rotation interval properly increments currentFactIndex
    ✅ IMPROVED: Better user expectations with "This could take a couple minutes" message
    ✅ PRESERVED: All v6.1.0 functionality (DO NO HARM ✓)
    
    CHANGES FROM v6.1.0:
    - Line 87-111: Added time estimate banner with pulsing animation
    - Line 934-942: Fixed funFactsInterval to properly cycle through facts
    - Added proper index increment: currentFactIndex = (currentFactIndex + 1) % funFacts.length
    - Banner shows: "⏱️ This analysis could take a couple of minutes..."
    
    ENTERTAINMENT FEATURES:
    - ⏰ Time estimate banner (new in v6.2.0)
    - 🌈 Rainbow progress bar that cycles through colors
    - 🎭 Emoji changes: 🔍 → 🎯 → 🤔 → 🎉 based on progress
    - 🎨 Percentage size: 48px bold with color morphing
    - ✨ Animated sparkles that pulse and fade
    - 🎪 Rotating fun facts NOW WORKING (cycles every 4 seconds)
    - 📊 Claim counter shows X/total with animations
    - 💫 Multiple animation layers for depth
    
    Deploy to: templates/transcript.html
    Last modified: October 25, 2025 - Progress bar fixes v6.2.0
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcript Fact Checker - TruthLens AI</title>
    <meta name="description" content="AI-powered transcript fact-checking for speeches, interviews, and YouTube videos">
    
    <!-- External Styles - Unified Navigation -->
    <link rel="stylesheet" href="/static/css/main.css">
    
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <style>
        :root {
            --primary-blue: #3b82f6;
            --primary-dark: #1e40af;
            --success-green: #10b981;
            --error-red: #ef4444;
            --warning-orange: #f59e0b;
            --purple-glow: #a855f7;
            --pink-glow: #ec4899;
            --cyan-glow: #06b6d4;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            padding-top: 90px;
        }

        /* ========================================================================
           ULTRA-ENTERTAINING PROGRESS SECTION
           ======================================================================== */
        
        /* NEW: Time Estimate Banner */
        .time-estimate-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            margin-bottom: 30px;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            animation: gentlePulse 2s ease-in-out infinite;
        }

        .time-estimate-banner i {
            font-size: 24px;
            animation: spin 3s linear infinite;
        }

        @keyframes gentlePulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            }
            50% {
                transform: scale(1.02);
                box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
            }
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        
        .progress-section {
            display: none;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 50px 40px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.15),
                0 0 40px rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }

        .progress-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.05) 0%, transparent 70%);
            animation: rotateBackground 20s linear infinite;
        }

        @keyframes rotateBackground {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-section.active {
            display: block;
            animation: slideInUp 0.5s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Multi-layer Animated Spinner */
        .spinner-container {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 0 auto 30px;
        }

        .spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            border: 5px solid transparent;
            border-top-color: #667eea;
            border-right-color: #764ba2;
            border-radius: 50%;
            animation: spin 1.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
        }

        .spinner-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.3) 0%, transparent 70%);
            animation: pulse 2s ease-in-out infinite;
        }

        .spinner-dots {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
        }

        .spinner-dot {
            position: absolute;
            width: 12px;
            height: 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            animation: spinDots 2s ease-in-out infinite;
        }

        .spinner-dot:nth-child(1) {
            top: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        .spinner-dot:nth-child(2) {
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            animation-delay: -0.5s;
        }

        .spinner-dot:nth-child(3) {
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            animation-delay: -1s;
        }

        .spinner-dot:nth-child(4) {
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            animation-delay: -1.5s;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.6;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1);
                opacity: 0.3;
            }
        }

        @keyframes spinDots {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.5);
                opacity: 0.5;
            }
        }

        /* Floating Sparkles */
        .sparkle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            opacity: 0;
            animation: float 3s ease-in-out infinite;
        }

        .sparkle:nth-child(1) { top: 10%; left: 10%; animation-delay: 0s; }
        .sparkle:nth-child(2) { top: 20%; left: 80%; animation-delay: 0.5s; }
        .sparkle:nth-child(3) { top: 70%; left: 15%; animation-delay: 1s; }
        .sparkle:nth-child(4) { top: 60%; left: 85%; animation-delay: 1.5s; }
        .sparkle:nth-child(5) { top: 40%; left: 50%; animation-delay: 2s; }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) scale(0);
                opacity: 0;
            }
            50% {
                transform: translateY(-20px) scale(1);
                opacity: 1;
            }
        }

        /* Dynamic Emoji Icon */
        .progress-emoji {
            font-size: 64px;
            margin-bottom: 20px;
            animation: bounce 1s ease-in-out infinite;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.15));
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            25% {
                transform: translateY(-10px) rotate(-5deg);
            }
            75% {
                transform: translateY(-5px) rotate(5deg);
            }
        }

        /* Progress Title */
        .progress-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: 30px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            position: relative;
            z-index: 1;
        }

        /* Rainbow Progress Bar */
        .progress-bar-container {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 20px;
            height: 32px;
            margin: 30px 0;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(
                90deg,
                #667eea 0%,
                #764ba2 25%,
                #f093fb 50%,
                #4facfe 75%,
                #00f2fe 100%
            );
            background-size: 200% 100%;
            border-radius: 20px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            animation: rainbowShift 3s ease-in-out infinite;
            box-shadow: 0 2px 12px rgba(102, 126, 234, 0.4);
            position: relative;
            overflow: hidden;
        }

        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: shimmer 2s ease-in-out infinite;
        }

        @keyframes rainbowShift {
            0%, 100% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        /* Huge Percentage Display */
        .progress-percentage {
            font-size: 48px;
            font-weight: 800;
            margin: 20px 0;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: colorShift 3s ease-in-out infinite;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
        }

        @keyframes colorShift {
            0%, 100% {
                filter: hue-rotate(0deg) drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
            }
            50% {
                filter: hue-rotate(30deg) drop-shadow(0 6px 12px rgba(0, 0, 0, 0.15));
            }
        }

        /* Claim Counter */
        .claims-analyzed {
            font-size: 18px;
            color: var(--gray-700);
            margin-top: 20px;
            font-weight: 600;
        }

        .claims-analyzed i {
            color: var(--success-green);
            margin-right: 8px;
            animation: pulse 2s ease-in-out infinite;
        }

        /* Fun Facts Box */
        .fun-facts-box {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 16px;
            padding: 24px;
            margin-top: 30px;
            position: relative;
            overflow: hidden;
        }

        .fun-facts-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #4facfe);
            background-size: 200% 100%;
            animation: rainbowShift 3s ease-in-out infinite;
        }

        .fun-fact-title {
            font-size: 18px;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .fun-fact-content {
            font-size: 16px;
            color: var(--gray-700);
            line-height: 1.6;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        /* Container */
        .container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* Main Card */
        .card {
            background: white;
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            margin-bottom: 30px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .header-title {
            font-size: 36px;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: 12px;
        }

        .header-subtitle {
            font-size: 18px;
            color: var(--gray-600);
            line-height: 1.6;
        }

        /* Tab Navigation */
        .tab-container {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            background: var(--gray-100);
            padding: 6px;
            border-radius: 12px;
        }

        .tab-button {
            flex: 1;
            padding: 14px 24px;
            border: none;
            background: transparent;
            color: var(--gray-600);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab-button:hover {
            background: rgba(102, 126, 234, 0.1);
            color: var(--primary-blue);
        }

        .tab-button.active {
            background: white;
            color: var(--primary-blue);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 12px;
        }

        .form-label i {
            color: var(--primary-blue);
            margin-right: 8px;
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-size: 16px;
            color: var(--gray-900);
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-textarea {
            min-height: 250px;
            resize: vertical;
            line-height: 1.6;
        }

        .char-counter {
            text-align: right;
            font-size: 14px;
            color: var(--gray-500);
            margin-top: 8px;
        }

        /* Helper Text */
        .helper-text {
            font-size: 14px;
            color: var(--gray-600);
            margin-top: 8px;
            line-height: 1.5;
        }

        /* Button Container */
        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-700);
        }

        .btn-secondary:hover {
            background: var(--gray-200);
        }

        /* Results Section */
        .results-section {
            display: none;
        }

        .results-section.active {
            display: block;
        }

        .credibility-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
        }

        .meter-score {
            font-size: 72px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
        }

        .credibility-label {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-700);
        }

        .claim-card {
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .claim-card:hover {
            border-color: var(--primary-blue);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
            transform: translateY(-2px);
        }

        .verdict-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Error State */
        .error-message {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            color: var(--error-red);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .error-message i {
            font-size: 24px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                padding-top: 80px;
            }

            .card {
                padding: 24px;
                border-radius: 16px;
            }

            .header-title {
                font-size: 28px;
            }

            .header-subtitle {
                font-size: 16px;
            }

            .tab-button {
                font-size: 14px;
                padding: 12px 16px;
            }

            .button-group {
                flex-direction: column;
            }

            .progress-percentage {
                font-size: 36px;
            }

            .meter-score {
                font-size: 56px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation will be injected by main.css -->
    
    <div class="container">
        <!-- Input Section -->
        <div id="input-section">
            <div class="card">
                <div class="header">
                    <div class="header-icon">🎙️</div>
                    <h1 class="header-title">Transcript Fact Checker</h1>
                    <p class="header-subtitle">
                        AI-powered analysis of speeches, interviews, and YouTube videos
                    </p>
                </div>

                <!-- Tab Navigation -->
                <div class="tab-container">
                    <button class="tab-button active" onclick="switchTab('text')">
                        <i class="fas fa-file-text"></i>
                        Paste Text
                    </button>
                    <button class="tab-button" onclick="switchTab('youtube')">
                        <i class="fab fa-youtube"></i>
                        YouTube URL
                    </button>
                </div>

                <!-- Text Input Tab -->
                <div id="text-tab" class="tab-content active">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-microphone"></i>
                            Paste Transcript Text
                        </label>
                        <textarea 
                            id="text-input" 
                            class="form-input form-textarea" 
                            placeholder="Paste your transcript here...

Example formats:
• Speech transcript
• Interview transcript
• Podcast transcript
• Video captions
• Meeting notes"
                            oninput="updateCharCount('text-char-count', this.value)"
                        ></textarea>
                        <div id="text-char-count" class="char-counter">0 characters</div>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-primary" onclick="analyzeText()">
                            <i class="fas fa-search"></i>
                            Analyze Transcript
                        </button>
                        <button class="btn btn-secondary" onclick="clearText()">
                            <i class="fas fa-times"></i>
                            Clear
                        </button>
                    </div>
                </div>

                <!-- YouTube Input Tab -->
                <div id="youtube-tab" class="tab-content">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fab fa-youtube"></i>
                            YouTube Video URL
                        </label>
                        <input 
                            type="url" 
                            id="youtube-url" 
                            class="form-input" 
                            placeholder="https://www.youtube.com/watch?v=..."
                        >
                        <p class="helper-text">
                            <i class="fas fa-info-circle"></i>
                            Paste a YouTube URL to automatically extract and analyze the transcript
                        </p>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-primary" onclick="analyzeYouTube()">
                            <i class="fab fa-youtube"></i>
                            Analyze Video
                        </button>
                        <button class="btn btn-secondary" onclick="clearYouTube()">
                            <i class="fas fa-times"></i>
                            Clear
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Progress Section -->
        <div id="progress-section" class="progress-section">
            <!-- Time Estimate Banner -->
            <div class="time-estimate-banner">
                <i class="fas fa-clock"></i>
                <span>This analysis could take a couple of minutes...</span>
            </div>

            <!-- Sparkles -->
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>
            <div class="sparkle"></div>

            <!-- Spinner -->
            <div class="spinner-container">
                <div class="spinner-glow"></div>
                <div class="spinner"></div>
                <div class="spinner-dots">
                    <div class="spinner-dot"></div>
                    <div class="spinner-dot"></div>
                    <div class="spinner-dot"></div>
                    <div class="spinner-dot"></div>
                </div>
            </div>

            <!-- Emoji -->
            <div class="progress-emoji" id="progress-emoji">🔍</div>

            <!-- Title -->
            <h2 class="progress-title">Analyzing Transcript</h2>

            <!-- Progress Bar -->
            <div class="progress-bar-container">
                <div class="progress-bar-fill" id="progress-bar" style="width: 0%"></div>
            </div>

            <!-- Percentage -->
            <div class="progress-percentage" id="progress-percentage">0%</div>

            <!-- Claims Counter -->
            <div class="claims-analyzed" id="claims-counter">
                <i class="fas fa-check-circle"></i>
                <span id="claims-count">0 claims analyzed</span>
            </div>

            <!-- Fun Facts -->
            <div class="fun-facts-box">
                <div class="fun-fact-title">
                    💡 Did You Know?
                </div>
                <div class="fun-fact-content" id="fun-fact">
                    Preparing your analysis...
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results-section" class="results-section">
            <!-- Results will be dynamically inserted here -->
        </div>
    </div>

    <script>
        console.log('[TranscriptApp] Module loading - v6.2.0 with fixed progress bar cycling...');

        // ============================================================================
        // STATE MANAGEMENT
        // ============================================================================
        let currentJobId = null;
        let currentResults = null;
        let pollInterval = null;
        let funFactsInterval = null;
        let currentFactIndex = 0;

        // ============================================================================
        // INITIALIZATION
        // ============================================================================
        document.addEventListener('DOMContentLoaded', () => {
            console.log('[TranscriptApp] Initializing...');
            
            // Set default tab
            switchTab('text');
            
            console.log('[TranscriptApp] ✓ Initialized');
        });

        // ============================================================================
        // TAB SWITCHING
        // ============================================================================
        function switchTab(tab) {
            console.log('[TranscriptApp] Switching to tab:', tab);
            
            // Update buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event?.currentTarget?.classList.add('active');
            
            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            if (tab === 'text') {
                document.getElementById('text-tab').classList.add('active');
            } else if (tab === 'youtube') {
                document.getElementById('youtube-tab').classList.add('active');
            }
        }

        // ============================================================================
        // CHARACTER COUNTER
        // ============================================================================
        function updateCharCount(elementId, text) {
            const count = text.length;
            document.getElementById(elementId).textContent = `${count.toLocaleString()} characters`;
        }

        // ============================================================================
        // CLEAR FUNCTIONS
        // ============================================================================
        function clearText() {
            document.getElementById('text-input').value = '';
            updateCharCount('text-char-count', '');
        }

        function clearYouTube() {
            document.getElementById('youtube-url').value = '';
        }

        // ============================================================================
        // ANALYSIS FUNCTIONS
        // ============================================================================
        async function analyzeText() {
            const text = document.getElementById('text-input').value.trim();
            
            if (!text) {
                alert('Please paste some transcript text to analyze.');
                return;
            }

            console.log('[TranscriptApp] Starting analysis');
            console.log('[TranscriptApp] Source: text Length:', text.length);

            // Show progress section
            showProgressSection();
            
            // Hide input section
            document.getElementById('input-section').style.display = 'none';

            try {
                console.log('[TranscriptApp] Submitting analysis');
                
                const response = await fetch('/api/transcript/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        transcript: text,
                        source: 'text'
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Analysis failed');
                }

                const result = await response.json();
                currentJobId = result.job_id;
                
                console.log('[TranscriptApp] ✓ Job created:', currentJobId);
                
                // Start polling for results
                startPolling();
                
            } catch (error) {
                console.error('[TranscriptApp] Submission error:', error);
                hideProgressSection();
                document.getElementById('input-section').style.display = 'block';
                alert('Failed to start analysis: ' + error.message);
            }
        }

        async function analyzeYouTube() {
            const url = document.getElementById('youtube-url').value.trim();
            
            if (!url) {
                alert('Please enter a YouTube URL.');
                return;
            }

            if (!url.includes('youtube.com/watch') && !url.includes('youtu.be/')) {
                alert('Please enter a valid YouTube URL.');
                return;
            }

            console.log('[TranscriptApp] Starting analysis');
            console.log('[TranscriptApp] Processing YouTube URL:', url);

            // Show progress section
            showProgressSection();
            
            // Hide input section
            document.getElementById('input-section').style.display = 'none';

            try {
                console.log('[TranscriptApp] Calling /api/youtube/process...');
                
                const response = await fetch('/api/youtube/process', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        youtube_url: url
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'YouTube processing failed');
                }

                const result = await response.json();
                currentJobId = result.job_id;
                
                console.log('[TranscriptApp] ✓ Job created:', currentJobId);
                
                // Start polling for results
                startPolling();
                
            } catch (error) {
                console.error('[TranscriptApp] YouTube processing error:', error);
                hideProgressSection();
                document.getElementById('input-section').style.display = 'block';
                
                // Show user-friendly error message
                let errorMsg = error.message;
                if (errorMsg.includes('live stream')) {
                    errorMsg = '⚠️ This is a live stream. Please wait for the stream to end, then try again with the recorded version.';
                } else if (errorMsg.includes('no captions') || errorMsg.includes('transcript')) {
                    errorMsg = '⚠️ Could not extract transcript from this video. It may not have captions available.';
                } else if (errorMsg.includes('private') || errorMsg.includes('unavailable')) {
                    errorMsg = '⚠️ This video is private or unavailable.';
                }
                
                alert('YouTube Analysis Error:\n\n' + errorMsg);
            }
        }

        // ============================================================================
        // PROGRESS SECTION
        // ============================================================================
        function showProgressSection() {
            const section = document.getElementById('progress-section');
            section.classList.add('active');
            
            // Reset progress
            updateProgress(0, 0);
            
            // Start fun facts rotation
            startFunFactsRotation();
            
            // Scroll to progress section
            section.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function hideProgressSection() {
            document.getElementById('progress-section').classList.remove('active');
            stopFunFactsRotation();
        }

        // ============================================================================
        // FUN FACTS ROTATION - FIXED VERSION
        // ============================================================================
        function startFunFactsRotation() {
            const funFacts = [
                '🤖 AI models can process thousands of claims per minute!',
                '📊 We analyze over 15 different credibility factors',
                '🔍 Our system cross-references multiple fact-checking databases',
                '⚡ Most analyses complete in under 3 minutes',
                '🌍 We check claims against global news sources',
                '🎯 Accuracy improves with longer transcripts',
                '💡 Machine learning helps identify misleading statements',
                '🔬 We use NLP to understand context and nuance',
                '📈 Our database contains millions of verified facts',
                '🛡️ Bias detection uses multiple AI models',
                '🎓 The system learns from expert fact-checkers',
                '⚖️ We evaluate claims from multiple perspectives',
                '🚀 Processing gets faster as the system learns'
            ];
            
            currentFactIndex = 0;
            
            // Show first fact immediately
            document.getElementById('fun-fact').textContent = funFacts[0];
            
            // FIXED: Properly cycle through facts every 4 seconds
            funFactsInterval = setInterval(() => {
                currentFactIndex = (currentFactIndex + 1) % funFacts.length;
                const fact = funFacts[currentFactIndex];
                document.getElementById('fun-fact').textContent = fact;
                console.log('[FunFactsProgress] Showing fact', currentFactIndex + 1, '/', funFacts.length);
            }, 4000); // Cycle every 4 seconds
        }

        function stopFunFactsRotation() {
            if (funFactsInterval) {
                clearInterval(funFactsInterval);
                funFactsInterval = null;
            }
        }

        function updateProgress(percentage, claimsCount = 0) {
            // Update progress bar
            const progressBar = document.getElementById('progress-bar');
            progressBar.style.width = percentage + '%';
            
            // Update percentage text
            document.getElementById('progress-percentage').textContent = Math.round(percentage) + '%';
            
            // Update emoji based on progress
            const emoji = document.getElementById('progress-emoji');
            if (percentage < 25) {
                emoji.textContent = '🔍';
            } else if (percentage < 50) {
                emoji.textContent = '🎯';
            } else if (percentage < 75) {
                emoji.textContent = '🤔';
            } else {
                emoji.textContent = '🎉';
            }
            
            // Update claims counter
            if (claimsCount > 0) {
                document.getElementById('claims-count').textContent = `${claimsCount} claims analyzed`;
            }
        }

        // ============================================================================
        // POLLING FOR RESULTS
        // ============================================================================
        function startPolling() {
            console.log('[TranscriptApp] Starting polling for job:', currentJobId);
            
            let pollCount = 0;
            const maxPolls = 120; // 10 minutes max (120 * 5 seconds)
            
            pollInterval = setInterval(async () => {
                pollCount++;
                
                if (pollCount > maxPolls) {
                    console.error('[TranscriptApp] Polling timeout');
                    clearInterval(pollInterval);
                    hideProgressSection();
                    alert('Analysis is taking longer than expected. Please try again or contact support.');
                    document.getElementById('input-section').style.display = 'block';
                    return;
                }
                
                try {
                    const response = await fetch(`/api/transcript/status/${currentJobId}`);
                    
                    if (!response.ok) {
                        throw new Error('Failed to get status');
                    }
                    
                    const status = await response.json();
                    console.log('[TranscriptApp] Status:', status.status, 'Progress:', status.progress + '%');
                    
                    // Update progress
                    updateProgress(status.progress || 0, status.claims_processed || 0);
                    
                    if (status.status === 'completed') {
                        console.log('[TranscriptApp] ✓ Analysis complete');
                        clearInterval(pollInterval);
                        hideProgressSection();
                        displayResults(status.result);
                    } else if (status.status === 'failed') {
                        console.error('[TranscriptApp] Analysis failed:', status.error);
                        clearInterval(pollInterval);
                        hideProgressSection();
                        alert('Analysis failed: ' + (status.error || 'Unknown error'));
                        document.getElementById('input-section').style.display = 'block';
                    }
                    
                } catch (error) {
                    console.error('[TranscriptApp] Polling error:', error);
                }
            }, 5000); // Poll every 5 seconds
        }

        // ============================================================================
        // DISPLAY RESULTS
        // ============================================================================
        function displayResults(results) {
            console.log('[TranscriptApp] Displaying results');
            currentResults = results;
            
            const resultsSection = document.getElementById('results-section');
            resultsSection.classList.add('active');
            
            let html = `
                <div class="card">
                    <div class="header">
                        <div class="header-icon">✅</div>
                        <h1 class="header-title">Analysis Complete</h1>
                    </div>
                    
                    <div style="text-align: center; margin-bottom: 24px;">
                        <button class="btn btn-primary" onclick="startNewAnalysis()">
                            <i class="fas fa-plus"></i>
                            New Analysis
                        </button>
                    </div>
            `;
            
            // Credibility Score
            const scoreData = results.credibility_score || { score: 0, label: 'Unknown' };
            html += `
                <div class="credibility-card">
                    <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; opacity: 0.9;">
                        Overall Credibility Score
                    </h3>
                    <div class="meter-score">${scoreData.score}/100</div>
                    <div class="credibility-label">${scoreData.label}</div>
                </div>
            `;
            
            // Summary
            if (results.summary) {
                html += `
                    <div style="background: var(--gray-50); border-radius: 12px; padding: 24px; margin-bottom: 24px;">
                        <h3 style="font-size: 18px; font-weight: 700; color: var(--gray-900); margin-bottom: 12px;">
                            <i class="fas fa-info-circle" style="color: var(--primary-blue);"></i>
                            Summary
                        </h3>
                        <p style="color: var(--gray-700); line-height: 1.8;">${results.summary}</p>
                    </div>
                `;
            }
            
            // Export buttons
            html += `
                <div style="display: flex; gap: 12px; margin-bottom: 24px;">
                    <button onclick="exportResults('pdf')" style="flex: 1; padding: 12px; background: var(--error-red); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <i class="fas fa-file-pdf"></i>
                        Export as PDF
                    </button>
                    <button onclick="exportResults('json')" style="flex: 1; padding: 12px; background: var(--warning-orange); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <i class="fas fa-code"></i>
                        Export as JSON
                    </button>
                    <button onclick="exportResults('txt')" style="flex: 1; padding: 12px; background: var(--success-green); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <i class="fas fa-file-alt"></i>
                        Export as TXT
                    </button>
                </div>
            `;
            
            // Claims
            const factChecks = results.fact_checks || [];
            if (factChecks.length > 0) {
                html += `<h3 style="font-size: 20px; font-weight: 800; color: var(--gray-900); margin-bottom: 16px;">Fact-Checked Claims (${factChecks.length})</h3>`;
                
                factChecks.forEach((check, index) => {
                    const verdictColors = {
                        'true': '#10b981',
                        'mostly_true': '#34d399',
                        'mixed': '#f59e0b',
                        'partially_true': '#f59e0b',
                        'misleading': '#f97316',
                        'mostly_false': '#f87171',
                        'false': '#ef4444',
                        'unverifiable': '#9ca3af'
                    };
                    
                    const verdict = check.verdict || 'unverified';
                    const verdictColor = check.verdict_color || verdictColors[verdict] || '#9ca3af';
                    const verdictLabel = check.verdict_label || verdict.replace('_', ' ').toUpperCase();
                    
                    html += `
                        <div class="claim-card">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                                <div style="display: inline-block; width: 32px; height: 32px; background: var(--primary-blue); color: white; border-radius: 50%; text-align: center; line-height: 32px; font-weight: 700;">${index + 1}</div>
                                <div class="verdict-badge" style="background: ${verdictColor}20; color: ${verdictColor};">
                                    ${check.verdict_icon || '•'} ${verdictLabel}
                                </div>
                            </div>
                            
                            <p style="font-size: 16px; font-weight: 600; color: var(--gray-900); margin-bottom: 12px; line-height: 1.6;">
                                "${check.claim || 'Unknown claim'}"
                            </p>
                            
                            ${check.speaker ? `<p style="font-size: 14px; color: var(--gray-600); margin-bottom: 12px;"><i class="fas fa-user"></i> <strong>Speaker:</strong> ${check.speaker}</p>` : ''}
                            
                            <p style="font-size: 14px; color: var(--gray-700); line-height: 1.6; margin-bottom: 12px;">
                                <strong>Analysis:</strong> ${check.explanation || 'No explanation provided.'}
                            </p>
                            
                            ${check.evidence && check.evidence !== check.explanation ? `<p style="font-size: 13px; color: var(--gray-600); background: var(--gray-50); padding: 12px; border-radius: 8px; margin-bottom: 12px;"><strong>Evidence:</strong> ${check.evidence}</p>` : ''}
                            
                            ${check.confidence ? `<p style="font-size: 13px; color: var(--gray-600);"><i class="fas fa-chart-bar"></i> <strong>Confidence:</strong> ${check.confidence}%</p>` : ''}
                        </div>
                    `;
                });
            }
            
            document.getElementById('results-section').innerHTML = html;
            
            // Scroll to results
            document.getElementById('results-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // ============================================================================
        // EXPORT FUNCTIONS
        // ============================================================================
        async function exportResults(format) {
            if (!currentJobId) {
                alert('No analysis results to export.');
                return;
            }
            
            console.log('[TranscriptApp] Exporting:', format);
            
            try {
                const url = `/api/transcript/export/${currentJobId}/${format}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Export failed');
                }
                
                // Get filename from header or use default
                let filename = `transcript-analysis.${format}`;
                const contentDisposition = response.headers.get('Content-Disposition');
                if (contentDisposition) {
                    const match = contentDisposition.match(/filename="?(.+)"?/);
                    if (match) filename = match[1];
                }
                
                // Download the file
                const blob = await response.blob();
                const downloadUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = downloadUrl;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(downloadUrl);
                document.body.removeChild(a);
                
                console.log('[TranscriptApp] ✓ Exported:', filename);
                
            } catch (error) {
                console.error('[TranscriptApp] Export error:', error);
                alert('Failed to export: ' + error.message);
            }
        }

        // ============================================================================
        // UTILITIES
        // ============================================================================
        function startNewAnalysis() {
            currentJobId = null;
            currentResults = null;
            if (pollInterval) {
                clearInterval(pollInterval);
                pollInterval = null;
            }
            stopFunFactsRotation();
            
            document.getElementById('results-section').classList.remove('active');
            document.getElementById('input-section').style.display = 'block';
            
            // Reset inputs
            document.getElementById('text-input').value = '';
            document.getElementById('youtube-url').value = '';
            updateCharCount('text-char-count', '');
            
            // Scroll to top
            window.scrollTo({ behavior: 'smooth', top: 0 });
        }
    </script>

    <!-- I did no harm and this file is not truncated -->
</body>
</html>

<!-- I did no harm and this file is not truncated -->
