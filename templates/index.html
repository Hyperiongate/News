<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TruthLens - News Credibility Analyzer</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <style>
        /* Enhanced Source Rankings Styles */
        .source-rankings-container {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 16px;
            padding: 30px;
            margin-top: 35px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .source-rankings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255,255,255,0.3);
        }

        .source-rankings-title {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
        }

        .sources-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .source-item {
            display: flex;
            align-items: center;
            padding: 18px 20px;
            background: white;
            border-radius: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }

        .source-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .source-item.current {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .source-item.current .source-rank,
        .source-item.current .source-name,
        .source-item.current .source-domain {
            color: white !important;
        }

        .source-item.added-source {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            animation: pulseGlow 2s ease-in-out;
        }

        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 4px 15px rgba(253, 203, 110, 0.3); }
            50% { box-shadow: 0 8px 30px rgba(253, 203, 110, 0.6); }
        }

        .source-rank {
            font-size: 1.3rem;
            font-weight: 800;
            color: #6c757d;
            min-width: 45px;
            margin-right: 20px;
            text-align: center;
        }

        .source-logo {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            margin-right: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            color: white;
            font-size: 1.1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .source-info {
            flex: 0 0 200px;
            margin-right: 20px;
        }

        .source-name {
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 4px;
            font-size: 1.05rem;
        }

        .source-domain {
            font-size: 0.85rem;
            color: #95a5a6;
        }

        .source-score-container {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .source-trust-meter {
            flex: 1;
            height: 40px;
            background: #f0f3f7;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.08);
        }

        .source-trust-fill {
            height: 100%;
            border-radius: 20px;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
            color: white;
            font-size: 0.9rem;
            font-weight: 700;
            position: relative;
            overflow: hidden;
        }

        /* Animated gradient background for trust bars */
        .source-trust-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 200%;
            height: 100%;
            background: linear-gradient(90deg, 
                rgba(255,255,255,0) 0%, 
                rgba(255,255,255,0.3) 50%, 
                rgba(255,255,255,0) 100%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Colorful gradient fills for different trust levels */
        .trust-very-high {
            background: linear-gradient(135deg, #00b894, #00cec9);
        }

        .trust-high {
            background: linear-gradient(135deg, #0984e3, #74b9ff);
        }

        .trust-medium {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
        }

        .trust-low {
            background: linear-gradient(135deg, #fab1a0, #e17055);
        }

        .trust-very-low {
            background: linear-gradient(135deg, #ff7675, #d63031);
        }

        .source-score-badge {
            font-size: 1.4rem;
            font-weight: 800;
            min-width: 60px;
            text-align: center;
            padding: 8px 12px;
            border-radius: 10px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .score-very-high { 
            color: #00b894;
            background: linear-gradient(135deg, rgba(0,184,148,0.1), rgba(0,206,201,0.1));
        }
        
        .score-high { 
            color: #0984e3;
            background: linear-gradient(135deg, rgba(9,132,227,0.1), rgba(116,185,255,0.1));
        }
        
        .score-medium { 
            color: #e17055;
            background: linear-gradient(135deg, rgba(253,203,110,0.1), rgba(225,112,85,0.1));
        }
        
        .score-low { 
            color: #e17055;
            background: linear-gradient(135deg, rgba(250,177,160,0.1), rgba(225,112,85,0.1));
        }
        
        .score-very-low { 
            color: #d63031;
            background: linear-gradient(135deg, rgba(255,118,117,0.1), rgba(214,48,49,0.1));
        }

        .current-source-indicator {
            background: white;
            color: #667eea;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-left: 12px;
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .added-source-indicator {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-left: 12px;
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .source-filter-buttons {
            display: none; /* Hide filters for cleaner look */
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .source-rankings-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .source-info {
                flex: 0 0 140px;
            }

            .source-score-badge {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Keep all your existing HTML here -->
    <!-- This is just the updated source rankings section and the enhanced JavaScript -->
    
    <!-- Updated Source Rankings Section -->
    <div class="source-rankings-container" id="sourceRankings" style="display: none;">
        <div class="source-rankings-header">
            <h2 class="source-rankings-title">ðŸ“Š News Source Credibility Rankings</h2>
        </div>
        <div class="sources-grid" id="sourcesGrid">
            <!-- Populated by JavaScript -->
        </div>
    </div>

    <!-- Enhanced Source Rankings JavaScript -->
    <script>
        // Enhanced news sources database with vibrant colors
        const TOP_SOURCES = [
            { name: 'Reuters', domain: 'reuters.com', score: 85, color: '#FF6B00' },
            { name: 'Associated Press', domain: 'ap.org', score: 83, color: '#FF0000' },
            { name: 'BBC News', domain: 'bbc.com', score: 80, color: '#BB1919' },
            { name: 'NPR', domain: 'npr.org', score: 78, color: '#0066CC' },
            { name: 'The Guardian', domain: 'theguardian.com', score: 75, color: '#052962' },
            { name: 'USA Today', domain: 'usatoday.com', score: 71, color: '#009BFF' },
            { name: 'Forbes', domain: 'forbes.com', score: 69, color: '#231F20' },
            { name: 'CNN', domain: 'cnn.com', score: 65, color: '#CC0000' },
            { name: 'Fox News', domain: 'foxnews.com', score: 62, color: '#003366' },
            { name: 'MSNBC', domain: 'msnbc.com', score: 60, color: '#000000' }
        ];

        // Store the current analyzed source globally
        let currentAnalyzedSource = null;

        function getTrustClass(score) {
            if (score >= 80) return 'very-high';
            if (score >= 60) return 'high';
            if (score >= 40) return 'medium';
            if (score >= 20) return 'low';
            return 'very-low';
        }

        function displaySourceRankings(currentDomain = null, currentScore = null) {
            const container = document.getElementById('sourceRankings');
            const grid = document.getElementById('sourcesGrid');
            
            if (!container || !grid) return;
            
            container.style.display = 'block';
            grid.innerHTML = '';
            
            // Create a working copy of sources
            let displaySources = [...TOP_SOURCES];
            
            // If current source is not in the list, add it
            if (currentDomain && currentScore !== null) {
                const cleanDomain = currentDomain.toLowerCase().replace('www.', '');
                const existingSource = displaySources.find(s => s.domain === cleanDomain);
                
                if (!existingSource) {
                    // Add the new source with a distinct style
                    const sourceName = cleanDomain.split('.')[0];
                    const capitalizedName = sourceName.charAt(0).toUpperCase() + sourceName.slice(1);
                    
                    displaySources.push({
                        name: capitalizedName,
                        domain: cleanDomain,
                        score: currentScore,
                        color: '#9b59b6', // Purple for new sources
                        isNew: true
                    });
                } else {
                    // Mark existing source as current
                    existingSource.isCurrent = true;
                    existingSource.score = currentScore; // Update with actual analyzed score
                }
                
                // Store for reference
                currentAnalyzedSource = cleanDomain;
            }
            
            // Sort sources by score
            const sortedSources = displaySources.sort((a, b) => b.score - a.score);
            
            // Create source items with animation delay
            sortedSources.forEach((source, index) => {
                const trustClass = getTrustClass(source.score);
                const isCurrent = source.isCurrent || source.domain === currentAnalyzedSource;
                const isNew = source.isNew;
                
                const sourceItem = document.createElement('div');
                sourceItem.className = `source-item ${isCurrent ? 'current' : ''} ${isNew ? 'added-source' : ''}`;
                
                // Add animation delay for staggered appearance
                sourceItem.style.animation = `slideIn 0.5s ease-out ${index * 0.05}s forwards`;
                sourceItem.style.opacity = '0';
                
                sourceItem.innerHTML = `
                    <div class="source-rank">#${index + 1}</div>
                    <div class="source-logo" style="background: ${source.color};">
                        ${source.name.substring(0, 2).toUpperCase()}
                    </div>
                    <div class="source-info">
                        <div class="source-name">
                            ${source.name}
                            ${isCurrent && !isNew ? '<span class="current-source-indicator">CURRENT</span>' : ''}
                            ${isNew ? '<span class="added-source-indicator">NEW</span>' : ''}
                        </div>
                        <div class="source-domain">${source.domain}</div>
                    </div>
                    <div class="source-score-container">
                        <div class="source-trust-meter">
                            <div class="source-trust-fill trust-${trustClass}" 
                                 style="width: 0%;"
                                 data-target-width="${source.score}%">
                                ${source.score}%
                            </div>
                        </div>
                        <div class="source-score-badge score-${trustClass}">${source.score}</div>
                    </div>
                `;
                
                grid.appendChild(sourceItem);
                
                // Animate the trust bar fill after a short delay
                setTimeout(() => {
                    const trustFill = sourceItem.querySelector('.source-trust-fill');
                    if (trustFill) {
                        trustFill.style.width = trustFill.dataset.targetWidth;
                    }
                    sourceItem.style.opacity = '1';
                }, 100 + (index * 50));
            });
        }

        // Add slide-in animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateX(-30px);
                }
                to {
                    opacity: 1;
                    transform: translateX(0);
                }
            }
        `;
        document.head.appendChild(style);

        // Function to integrate with analysis results
        function integrateWithAnalysis(analysisResults) {
            if (analysisResults && analysisResults.source) {
                // Extract domain from source
                const domain = analysisResults.source.toLowerCase().replace('www.', '').replace('https://', '').replace('http://', '').split('/')[0];
                
                // Get the trust score
                const trustScore = analysisResults.trust_score || 
                                 analysisResults.detailed_analysis?.source_credibility?.score || 
                                 50; // Default to 50 if no score available
                
                // Display rankings with current source
                displaySourceRankings(domain, trustScore);
            }
        }

        // Function to be called after analysis completes
        function updateSourceRankings(analysisResults) {
            const container = document.getElementById('sourceRankings');
            if (container) {
                container.style.display = 'block';
            }
            
            if (analysisResults) {
                integrateWithAnalysis(analysisResults);
            } else {
                displaySourceRankings();
            }
        }
    </script>
</body>
</html>
