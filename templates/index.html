<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TruthLens - Professional News Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --dark: #1f2937;
            --light: #f9fafb;
            --border: #e5e7eb;
            --text-muted: #6b7280;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* Input Section */
        .input-section {
            background: white;
            margin: 2rem auto;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .input-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .url-input {
            flex: 1;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .url-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .analyze-btn {
            padding: 1rem 2.5rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .analyze-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .analyze-btn:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
            transform: none;
        }

        /* Progress Bar */
        .progress-section {
            display: none;
            background: white;
            margin: 2rem auto;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            width: 0%;
            transition: width 0.3s ease;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }

        /* Results Section */
        .results-section {
            display: none;
        }

        /* Summary Card (Free) */
        .summary-card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }

        .trust-score-container {
            text-align: center;
            margin-bottom: 2rem;
        }

        .trust-score-circle {
            width: 180px;
            height: 180px;
            margin: 0 auto 1rem;
            position: relative;
        }

        .trust-score-svg {
            transform: rotate(-90deg);
        }

        .trust-score-bg {
            fill: none;
            stroke: #e5e7eb;
            stroke-width: 12;
        }

        .trust-score-fill {
            fill: none;
            stroke-width: 12;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s ease;
        }

        .trust-score-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: 700;
        }

        .trust-label {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .trust-description {
            color: var(--text-muted);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Article Info */
        .article-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
            padding: 2rem 0;
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
        }

        .info-item h3 {
            font-size: 0.875rem;
            text-transform: uppercase;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .info-item p {
            font-size: 1.125rem;
            font-weight: 600;
        }

        /* Key Findings */
        .key-findings {
            margin-top: 2rem;
        }

        .key-findings h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .finding-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: var(--light);
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .finding-icon {
            font-size: 1.5rem;
            line-height: 1;
        }

        .finding-text {
            flex: 1;
        }

        /* Premium Section */
        .premium-section {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            margin: 2rem 0;
        }

        .premium-section h2 {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .premium-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
            text-align: left;
        }

        .premium-feature {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .unlock-btn {
            padding: 1rem 2.5rem;
            background: white;
            color: var(--warning);
            border: none;
            border-radius: 8px;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .unlock-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        /* Detailed Analysis (Premium) */
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .analysis-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .analysis-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        .card-header {
            padding: 1.5rem;
            background: var(--light);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-score {
            font-size: 1.125rem;
            font-weight: 700;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            background: var(--light);
        }

        .card-content {
            padding: 1.5rem;
        }

        /* Score Colors */
        .score-high { color: var(--success); background: rgba(16, 185, 129, 0.1) !important; }
        .score-medium { color: var(--warning); background: rgba(245, 158, 11, 0.1) !important; }
        .score-low { color: var(--danger); background: rgba(239, 68, 68, 0.1) !important; }

        /* Error State */
        .error-message {
            display: none;
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        /* Loading Animation */
        .loading-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: currentColor;
            border-radius: 50%;
            animation: loading 1.4s infinite ease-in-out both;
            margin: 0 2px;
        }

        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes loading {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .input-group { flex-direction: column; }
            .analyze-btn { width: 100%; justify-content: center; }
            .analysis-grid { grid-template-columns: 1fr; }
            .trust-score-circle { width: 150px; height: 150px; }
            .trust-score-text { font-size: 2.5rem; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <h1>TruthLens</h1>
            <p>Professional News Analysis & Credibility Assessment</p>
        </div>
    </header>

    <main class="container">
        <!-- Input Section -->
        <section class="input-section">
            <div class="input-group">
                <input type="url" id="urlInput" class="url-input" placeholder="Enter news article URL..." />
                <button id="analyzeBtn" class="analyze-btn" onclick="analyzeArticle()">
                    <span>üîç</span>
                    <span>Analyze</span>
                </button>
            </div>
            <div id="errorMessage" class="error-message"></div>
        </section>

        <!-- Progress Section -->
        <section id="progressSection" class="progress-section">
            <h2>Analyzing Article</h2>
            <p>Please wait while we perform comprehensive analysis...</p>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
            <p id="progressText">Extracting article content...</p>
        </section>

        <!-- Results Section -->
        <section id="resultsSection" class="results-section">
            <!-- Summary Card (Free) -->
            <div class="summary-card">
                <div class="trust-score-container">
                    <div class="trust-score-circle">
                        <svg width="180" height="180" class="trust-score-svg">
                            <circle cx="90" cy="90" r="78" class="trust-score-bg"></circle>
                            <circle cx="90" cy="90" r="78" id="trustScoreFill" class="trust-score-fill"></circle>
                        </svg>
                        <div id="trustScoreText" class="trust-score-text">0</div>
                    </div>
                    <h2 id="trustLabel" class="trust-label">Calculating...</h2>
                    <p id="trustDescription" class="trust-description"></p>
                </div>

                <div class="article-info">
                    <div class="info-item">
                        <h3>Source</h3>
                        <p id="sourceName">-</p>
                    </div>
                    <div class="info-item">
                        <h3>Author</h3>
                        <p id="authorName">-</p>
                    </div>
                    <div class="info-item">
                        <h3>Published</h3>
                        <p id="publishDate">-</p>
                    </div>
                </div>

                <div class="key-findings">
                    <h2>Summary & Key Findings</h2>
                    <div id="articleSummary" style="margin-bottom: 1.5rem; line-height: 1.8;"></div>
                    <div id="keyFindings"></div>
                </div>
            </div>

            <!-- Premium CTA -->
            <div class="premium-section" id="premiumCTA">
                <h2>üîì Unlock Detailed Analysis</h2>
                <p>Get comprehensive insights with our premium analysis</p>
                <div class="premium-features">
                    <div class="premium-feature">
                        <span>‚úì</span> Author Reputation & History
                    </div>
                    <div class="premium-feature">
                        <span>‚úì</span> Detailed Bias Detection
                    </div>
                    <div class="premium-feature">
                        <span>‚úì</span> Source Credibility Report
                    </div>
                    <div class="premium-feature">
                        <span>‚úì</span> Fact-Check Verification
                    </div>
                    <div class="premium-feature">
                        <span>‚úì</span> Manipulation Detection
                    </div>
                    <div class="premium-feature">
                        <span>‚úì</span> Comparative Analysis
                    </div>
                </div>
                <button class="unlock-btn" onclick="unlockPremium()">View Full Analysis</button>
            </div>

            <!-- Detailed Analysis Grid (Premium - Hidden by default) -->
            <div class="analysis-grid" id="analysisGrid" style="display: none;">
                <!-- Cards will be dynamically inserted here -->
            </div>
        </section>
    </main>

    <script>
        let currentAnalysis = null;
        const API_ENDPOINT = '/api/analyze';

        // Progress messages
        const progressMessages = [
            "Extracting article content...",
            "Analyzing author credibility...",
            "Checking for bias patterns...",
            "Verifying factual claims...",
            "Evaluating source reputation...",
            "Calculating trust score..."
        ];

        async function analyzeArticle() {
            const urlInput = document.getElementById('urlInput');
            const url = urlInput.value.trim();

            if (!url) {
                showError('Please enter a valid URL');
                return;
            }

            // Reset UI
            hideError();
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('analysisGrid').style.display = 'none';
            
            // Show progress
            const progressSection = document.getElementById('progressSection');
            progressSection.style.display = 'block';
            
            // Disable button
            const analyzeBtn = document.getElementById('analyzeBtn');
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<span class="loading-dot"></span><span class="loading-dot"></span><span class="loading-dot"></span>';

            // Animate progress
            animateProgress();

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url })
                });

                if (!response.ok) {
                    throw new Error('Analysis failed. Please try again.');
                }

                const data = await response.json();
                currentAnalysis = data;
                
                // Hide progress
                progressSection.style.display = 'none';
                
                // Show results
                displayResults(data);
                
            } catch (error) {
                showError(error.message || 'An error occurred during analysis');
                progressSection.style.display = 'none';
            } finally {
                // Re-enable button
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<span>üîç</span><span>Analyze</span>';
            }
        }

        function animateProgress() {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            let progress = 0;
            let messageIndex = 0;

            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 90) progress = 90;
                
                progressFill.style.width = progress + '%';
                
                // Update message
                if (progress > (messageIndex + 1) * (90 / progressMessages.length)) {
                    messageIndex++;
                    if (messageIndex < progressMessages.length) {
                        progressText.textContent = progressMessages[messageIndex];
                    }
                }
            }, 500);

            // Store interval ID to clear later
            window.progressInterval = interval;
        }

        function displayResults(data) {
            // Clear progress interval
            if (window.progressInterval) {
                clearInterval(window.progressInterval);
            }

            // Show results section
            document.getElementById('resultsSection').style.display = 'block';

            // Display Trust Score
            const trustScore = data.trust_score || 50;
            displayTrustScore(trustScore);

            // Display Article Info
            document.getElementById('sourceName').textContent = data.article?.domain || 'Unknown Source';
            document.getElementById('authorName').textContent = data.article?.author || 'Unknown Author';
            document.getElementById('publishDate').textContent = formatDate(data.article?.publish_date);

            // Display Summary
            const summary = data.article?.summary || data.content_analysis?.summary || 
                'This article discusses ' + (data.article?.title || 'current events') + '.';
            document.getElementById('articleSummary').textContent = summary;

            // Display Key Findings
            displayKeyFindings(data);
        }

        function displayTrustScore(score) {
            const scoreText = document.getElementById('trustScoreText');
            const label = document.getElementById('trustLabel');
            const description = document.getElementById('trustDescription');
            const fill = document.getElementById('trustScoreFill');

            // Animate score
            animateNumber(scoreText, 0, score, 1000);

            // Set color based on score
            let color, labelText, desc;
            if (score >= 80) {
                color = '#10b981';
                labelText = 'Highly Credible';
                desc = 'This article demonstrates strong credibility with verified information and reliable sourcing.';
            } else if (score >= 60) {
                color = '#3b82f6';
                labelText = 'Generally Credible';
                desc = 'This article is reasonably credible but may contain some unverified claims or minor bias.';
            } else if (score >= 40) {
                color = '#f59e0b';
                labelText = 'Questionable';
                desc = 'This article has credibility concerns. Verify important claims with additional sources.';
            } else {
                color = '#ef4444';
                labelText = 'Low Credibility';
                desc = 'This article has significant credibility issues. Exercise caution and seek alternative sources.';
            }

            fill.style.stroke = color;
            scoreText.style.color = color;
            label.textContent = labelText;
            description.textContent = desc;

            // Animate circle
            const circumference = 2 * Math.PI * 78;
            fill.style.strokeDasharray = circumference;
            fill.style.strokeDashoffset = circumference;
            
            setTimeout(() => {
                fill.style.strokeDashoffset = circumference - (score / 100) * circumference;
            }, 100);
        }

        function displayKeyFindings(data) {
            const findings = [];
            
            // Bias finding
            if (data.bias_analysis) {
                const bias = data.bias_analysis.overall_bias;
                if (bias && bias !== 'Neutral') {
                    findings.push({
                        icon: '‚öñÔ∏è',
                        text: `Shows ${bias.toLowerCase()} bias in presentation`,
                        type: 'warning'
                    });
                } else {
                    findings.push({
                        icon: '‚úÖ',
                        text: 'Maintains neutral perspective',
                        type: 'positive'
                    });
                }
            }

            // Source credibility
            if (data.source_credibility?.rating) {
                const rating = data.source_credibility.rating;
                if (rating === 'High') {
                    findings.push({
                        icon: 'üèÜ',
                        text: 'Published by highly credible source',
                        type: 'positive'
                    });
                } else if (rating === 'Low' || rating === 'Very Low') {
                    findings.push({
                        icon: '‚ö†Ô∏è',
                        text: 'Source has credibility concerns',
                        type: 'warning'
                    });
                }
            }

            // Author credibility
            if (data.author_analysis?.credibility_score) {
                const authorScore = data.author_analysis.credibility_score;
                if (authorScore >= 70) {
                    findings.push({
                        icon: 'üë§',
                        text: 'Written by credible author with expertise',
                        type: 'positive'
                    });
                }
            }

            // Fact checking
            if (data.fact_checks?.length > 0) {
                const verified = data.fact_checks.filter(f => f.verdict?.toLowerCase().includes('true')).length;
                const total = data.fact_checks.length;
                findings.push({
                    icon: 'üîç',
                    text: `${verified} of ${total} claims verified as accurate`,
                    type: verified > total/2 ? 'positive' : 'warning'
                });
            }

            // Display findings
            const container = document.getElementById('keyFindings');
            container.innerHTML = findings.map(f => `
                <div class="finding-item">
                    <span class="finding-icon">${f.icon}</span>
                    <div class="finding-text">${f.text}</div>
                </div>
            `).join('');
        }

        function unlockPremium() {
            if (!currentAnalysis) return;

            // Hide CTA
            document.getElementById('premiumCTA').style.display = 'none';
            
            // Show detailed analysis
            const grid = document.getElementById('analysisGrid');
            grid.style.display = 'grid';
            
            // Create analysis cards
            createAnalysisCards(currentAnalysis);
        }

        function createAnalysisCards(data) {
            const grid = document.getElementById('analysisGrid');
            grid.innerHTML = '';

            // Author Analysis Card
            if (data.author_analysis) {
                const authorCard = createCard(
                    'üë§ Author Analysis',
                    data.author_analysis.credibility_score || 50,
                    formatAuthorAnalysis(data.author_analysis)
                );
                grid.appendChild(authorCard);
            }

            // Bias Analysis Card
            if (data.bias_analysis) {
                const biasCard = createCard(
                    '‚öñÔ∏è Bias Detection',
                    100 - (Math.abs(data.bias_analysis.bias_score || 0) * 100),
                    formatBiasAnalysis(data.bias_analysis)
                );
                grid.appendChild(biasCard);
            }

            // Source Credibility Card
            if (data.source_credibility) {
                const sourceCard = createCard(
                    'üè¢ Source Credibility',
                    getCredibilityScore(data.source_credibility.rating),
                    formatSourceAnalysis(data.source_credibility)
                );
                grid.appendChild(sourceCard);
            }

            // Fact Checking Card
            if (data.fact_checks && data.fact_checks.length > 0) {
                const factCard = createCard(
                    'üîç Fact Verification',
                    calculateFactScore(data.fact_checks),
                    formatFactChecks(data.fact_checks)
                );
                grid.appendChild(factCard);
            }

            // Manipulation Detection Card
            if (data.manipulation_analysis) {
                const manipCard = createCard(
                    'üé≠ Manipulation Detection',
                    100 - (data.manipulation_analysis.score || 0),
                    formatManipulationAnalysis(data.manipulation_analysis)
                );
                grid.appendChild(manipCard);
            }

            // Transparency Card
            if (data.transparency_analysis) {
                const transCard = createCard(
                    'üîç Transparency',
                    data.transparency_analysis.transparency_score || 50,
                    formatTransparencyAnalysis(data.transparency_analysis)
                );
                grid.appendChild(transCard);
            }
        }

        function createCard(title, score, content) {
            const card = document.createElement('div');
            card.className = 'analysis-card';
            
            const scoreClass = score >= 70 ? 'score-high' : score >= 40 ? 'score-medium' : 'score-low';
            
            card.innerHTML = `
                <div class="card-header">
                    <h3>${title}</h3>
                    <span class="card-score ${scoreClass}">${Math.round(score)}/100</span>
                </div>
                <div class="card-content">
                    ${content}
                </div>
            `;
            
            return card;
        }

        // Formatting functions for different analysis types
        function formatAuthorAnalysis(analysis) {
            return `
                <p><strong>Name:</strong> ${analysis.name || 'Unknown'}</p>
                <p><strong>Bio:</strong> ${analysis.bio || 'No biographical information available'}</p>
                ${analysis.expertise ? `<p><strong>Expertise:</strong> ${analysis.expertise.join(', ')}</p>` : ''}
                ${analysis.previous_work ? `<p><strong>Track Record:</strong> ${analysis.previous_work.total_articles || 0} articles analyzed</p>` : ''}
                ${analysis.social_media ? `<p><strong>Verification:</strong> ${analysis.social_media.verified ? '‚úì Verified' : 'Not verified'}</p>` : ''}
            `;
        }

        function formatBiasAnalysis(analysis) {
            const biasTypes = [];
            if (analysis.political_lean !== 0) {
                const lean = analysis.political_lean > 0 ? 'right' : 'left';
                const strength = Math.abs(analysis.political_lean) > 0.5 ? 'strong' : 'slight';
                biasTypes.push(`${strength} ${lean}-leaning`);
            }
            
            return `
                <p><strong>Overall Bias:</strong> ${analysis.overall_bias || 'Neutral'}</p>
                ${biasTypes.length > 0 ? `<p><strong>Detected Patterns:</strong> ${biasTypes.join(', ')}</p>` : ''}
                <p><strong>Emotional Language:</strong> ${analysis.emotional_language_score ? Math.round(analysis.emotional_language_score * 100) + '%' : 'Minimal'}</p>
                ${analysis.bias_indicators ? `<p><strong>Key Indicators:</strong> ${analysis.bias_indicators.join(', ')}</p>` : ''}
            `;
        }

        function formatSourceAnalysis(analysis) {
            return `
                <p><strong>Domain:</strong> ${analysis.domain || 'Unknown'}</p>
                <p><strong>Credibility Rating:</strong> ${analysis.rating || 'Unknown'}</p>
                ${analysis.bias ? `<p><strong>Known Bias:</strong> ${analysis.bias}</p>` : ''}
                ${analysis.factual_reporting ? `<p><strong>Factual Reporting:</strong> ${analysis.factual_reporting}</p>` : ''}
                ${analysis.media_type ? `<p><strong>Media Type:</strong> ${analysis.media_type}</p>` : ''}
                ${analysis.notes ? `<p><strong>Notes:</strong> ${analysis.notes}</p>` : ''}
            `;
        }

        function formatFactChecks(factChecks) {
            return factChecks.slice(0, 5).map(check => `
                <div style="margin-bottom: 1rem; padding: 0.75rem; background: #f9fafb; border-radius: 6px;">
                    <p><strong>Claim:</strong> "${check.claim}"</p>
                    <p><strong>Verdict:</strong> ${check.verdict || 'Unverified'}</p>
                    ${check.source ? `<p><strong>Source:</strong> ${check.source}</p>` : ''}
                    ${check.confidence ? `<p><strong>Confidence:</strong> ${check.confidence}%</p>` : ''}
                </div>
            `).join('');
        }

        function formatManipulationAnalysis(analysis) {
            const tactics = analysis.tactics || [];
            return `
                <p><strong>Risk Level:</strong> ${analysis.score > 60 ? 'High' : analysis.score > 30 ? 'Medium' : 'Low'}</p>
                ${tactics.length > 0 ? `
                    <p><strong>Detected Tactics:</strong></p>
                    <ul>
                        ${tactics.map(t => `<li>${t.name} (Severity: ${t.severity})</li>`).join('')}
                    </ul>
                ` : '<p>No significant manipulation tactics detected.</p>'}
            `;
        }

        function formatTransparencyAnalysis(analysis) {
            return `
                <p><strong>Sources Cited:</strong> ${analysis.sources_cited ? 'Yes' : 'No'}</p>
                <p><strong>Author Disclosed:</strong> ${analysis.author_disclosed ? 'Yes' : 'No'}</p>
                <p><strong>Conflicts Disclosed:</strong> ${analysis.conflicts_disclosed ? 'Yes' : 'No'}</p>
                <p><strong>Methodology Clear:</strong> ${analysis.methodology_clear ? 'Yes' : 'No'}</p>
                ${analysis.funding_disclosed !== undefined ? `<p><strong>Funding Disclosed:</strong> ${analysis.funding_disclosed ? 'Yes' : 'No'}</p>` : ''}
            `;
        }

        // Utility functions
        function getCredibilityScore(rating) {
            const scores = {
                'High': 85,
                'Medium': 60,
                'Low': 35,
                'Very Low': 15,
                'Unknown': 50
            };
            return scores[rating] || 50;
        }

        function calculateFactScore(factChecks) {
            if (!factChecks.length) return 50;
            const verified = factChecks.filter(f => f.verdict?.toLowerCase().includes('true')).length;
            return Math.round((verified / factChecks.length) * 100);
        }

        function formatDate(dateStr) {
            if (!dateStr) return 'Unknown';
            try {
                const date = new Date(dateStr);
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            } catch {
                return dateStr;
            }
        }

        function animateNumber(element, start, end, duration) {
            const range = end - start;
            const startTime = Date.now();
            
            function update() {
                const now = Date.now();
                const progress = Math.min((now - startTime) / duration, 1);
                const value = Math.round(start + (range * progress));
                element.textContent = value;
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }
            
            update();
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }

        function hideError() {
            document.getElementById('errorMessage').style.display = 'none';
        }

        // Allow Enter key to submit
        document.getElementById('urlInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                analyzeArticle();
            }
        });
    </script>
</body>
</html>
