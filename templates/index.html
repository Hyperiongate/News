<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TruthLens - Unified AI-Powered Analysis</title>
    <meta name="description" content="AI-powered analysis for news credibility and transcript fact-checking.">
    
    <link rel="icon" type="image/png" href="/static/images/favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/main.css">
    
    <style>
        /* Extraction Blocked Message Styles */
        .extraction-blocked-message {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            display: none;
        }
        
        .extraction-blocked-message.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }
        
        .blocked-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .blocked-icon {
            width: 40px;
            height: 40px;
            background: #f59e0b;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }
        
        .blocked-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: #92400e;
            margin: 0;
        }
        
        .blocked-message {
            color: #78350f;
            line-height: 1.6;
            margin-bottom: 1rem;
            white-space: pre-line;
        }
        
        .blocked-action {
            background: white;
            border: 2px dashed #f59e0b;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .blocked-action-title {
            font-weight: 600;
            color: #92400e;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .blocked-action-text {
            color: #78350f;
            font-size: 0.9rem;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Highlight text area when prompted */
        .textarea-field.highlight {
            border-color: #f59e0b;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
            }
            50% {
                box-shadow: 0 0 0 6px rgba(245, 158, 11, 0.2);
            }
        }

        /* All other existing styles from your original file */
        .trust-score-visual {
            display: flex;
            gap: 3rem;
            padding: 2rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 16px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .score-circle-container {
            flex-shrink: 0;
        }

        .score-circle-bg {
            width: 180px;
            height: 180px;
            background: conic-gradient(
                from 0deg,
                #10b981 0deg 72deg,
                #3b82f6 72deg 144deg,
                #f59e0b 144deg 216deg,
                #ef4444 216deg 288deg,
                #6b7280 288deg 360deg
            );
            border-radius: 50%;
            padding: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .score-circle-inner {
            width: 164px;
            height: 164px;
            background: white;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: scoreReveal 0.5s ease-out;
            text-align: center;
            padding: 10px;
        }

        .trust-score-big {
            font-size: 2.75rem;
            font-weight: 800;
            line-height: 1;
            margin: 0;
            display: block;
        }

        .trust-score-big.high { color: #10b981; }
        .trust-score-big.medium { color: #3b82f6; }
        .trust-score-big.low { color: #ef4444; }

        .trust-score-max {
            font-size: 1.125rem;
            color: #6b7280;
            font-weight: 600;
            margin: 0.125rem 0 0.5rem 0;
            display: block;
        }

        .trust-label-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 20px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            white-space: nowrap;
            max-width: 140px;
            text-align: center;
        }

        .trust-label-badge.high {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }

        .trust-label-badge.medium {
            background: rgba(59, 130, 246, 0.1);
            color: #2563eb;
        }

        .trust-label-badge.low {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }
        
        /* Keep all your other existing styles... */
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="#" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-search-plus"></i>
                </div>
                <span class="logo-text">TruthLens</span>
            </a>
            
            <nav class="nav-links">
                <a href="#features" class="nav-link">Features</a>
                <a href="#pricing" class="nav-link">Pricing</a>
                <a href="#about" class="nav-link">About</a>
                <a href="#contact" class="nav-link">Contact</a>
                <a href="#upgrade" class="cta-button">Upgrade to Pro</a>
            </nav>
        </div>
    </header>

    <main class="main-container">
        <section class="analysis-section">
            <div class="section-header">
                <h1 class="main-title">
                    Unified AI-Powered <span class="gradient-text">Analysis Platform</span>
                </h1>
                <p class="subtitle">
                    Advanced AI analysis for news credibility evaluation and transcript fact-checking. 
                    Choose your analysis mode and get comprehensive insights.
                </p>
                
                <div class="trust-badges">
                    <div class="trust-badge">
                        <i class="fas fa-shield-alt"></i>
                        <span>Dual-Mode Analysis</span>
                    </div>
                    <div class="trust-badge">
                        <i class="fas fa-bolt"></i>
                        <span>Real-time Processing</span>
                    </div>
                    <div class="trust-badge">
                        <i class="fas fa-chart-line"></i>
                        <span>Multi-Factor Scoring</span>
                    </div>
                </div>
            </div>

            <div class="mode-selector">
                <button class="mode-tab active" data-mode="news" onclick="switchMode('news')">
                    <i class="fas fa-newspaper"></i>
                    <span>News Analysis</span>
                </button>
                <button class="mode-tab" data-mode="transcript" onclick="switchMode('transcript')">
                    <i class="fas fa-video"></i>
                    <span>Transcript Analysis</span>
                </button>
            </div>

            <!-- News Analysis Mode -->
            <div class="mode-content active" id="news-mode">
                <form class="input-form" id="newsForm">
                    <div class="input-group">
                        <label class="input-label" for="newsUrlInput">
                            <i class="fas fa-link"></i> Article URL
                        </label>
                        <input 
                            type="url" 
                            id="newsUrlInput" 
                            class="input-field" 
                            placeholder="https://example.com/news-article"
                        >
                    </div>

                    <!-- EXTRACTION BLOCKED MESSAGE -->
                    <div class="extraction-blocked-message" id="newsBlockedMessage">
                        <div class="blocked-header">
                            <div class="blocked-icon">
                                <i class="fas fa-lock"></i>
                            </div>
                            <h3 class="blocked-title">Website Blocking Extraction</h3>
                        </div>
                        <div class="blocked-message" id="newsBlockedText">
                            This website is blocking automated access.
                        </div>
                        <div class="blocked-action">
                            <div class="blocked-action-title">
                                <i class="fas fa-arrow-down"></i>
                                What to do:
                            </div>
                            <div class="blocked-action-text">
                                Copy the article text from your browser and paste it in the text box below, then click "Analyze Article" again.
                            </div>
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="newsTextInput">
                            <i class="fas fa-file-text"></i> Or Paste Article Text
                        </label>
                        <textarea 
                            id="newsTextInput" 
                            class="input-field textarea-field" 
                            placeholder="Paste the article text here for analysis..."
                        ></textarea>
                    </div>

                    <div class="button-container">
                        <button type="submit" class="analyze-button" id="newsAnalyzeBtn">
                            <div class="button-content">
                                <span class="button-text">
                                    <i class="fas fa-search"></i>
                                    Analyze Article
                                </span>
                            </div>
                        </button>
                        <button type="button" class="reset-button" onclick="resetForm('news')">
                            <i class="fas fa-redo"></i>
                            Reset
                        </button>
                    </div>
                </form>
            </div>

            <!-- Transcript Analysis Mode -->
            <div class="mode-content" id="transcript-mode">
                <form class="input-form" id="transcriptForm">
                    <div class="input-group">
                        <label class="input-label" for="youtubeUrlInput">
                            <i class="fab fa-youtube"></i> YouTube URL
                        </label>
                        <input 
                            type="url" 
                            id="youtubeUrlInput" 
                            class="input-field" 
                            placeholder="https://www.youtube.com/watch?v=..."
                        >
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="transcriptTextInput">
                            <i class="fas fa-microphone"></i> Or Paste Transcript Text
                        </label>
                        <textarea 
                            id="transcriptTextInput" 
                            class="input-field textarea-field" 
                            placeholder="Paste video transcript or spoken content here..."
                        ></textarea>
                    </div>

                    <div class="button-container">
                        <button type="submit" class="analyze-button" id="transcriptAnalyzeBtn">
                            <div class="button-content">
                                <span class="button-text">
                                    <i class="fas fa-video"></i>
                                    Analyze Transcript
                                </span>
                            </div>
                        </button>
                        <button type="button" class="reset-button" onclick="resetForm('transcript')">
                            <i class="fas fa-redo"></i>
                            Reset
                        </button>
                    </div>
                </form>
            </div>

            <!-- Progress Container -->
            <div class="progress-container" id="progressContainer" style="display: none;">
                <div class="progress-header">
                    <h3 class="progress-title">Analyzing Content...</h3>
                    <p class="progress-subtitle">Our AI is examining multiple factors</p>
                </div>
                
                <div class="progress-percentage" id="progressPercentage">0%</div>
                
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
            </div>

            <!-- Results Section -->
            <div class="results-section" id="resultsSection" style="display: none;">
                <div class="results-header">
                    <h2 class="results-title">Analysis Complete</h2>
                </div>

                <div class="enhanced-analysis-overview" id="enhancedAnalysisOverview">
                    <!-- Results will be populated here -->
                </div>

                <div id="serviceAnalysisContainer">
                    <!-- Service analysis will be populated here -->
                </div>
            </div>
        </section>
    </main>

    <script src="/static/js/service-templates.js"></script>
    <script src="/static/js/unified-app-core.js"></script>
    
    <script>
        let currentAnalysisMode = 'news';

        function switchMode(mode) {
            currentAnalysisMode = mode;
            
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.mode === mode);
            });
            
            document.querySelectorAll('.mode-content').forEach(content => {
                content.classList.toggle('active', content.id === `${mode}-mode`);
            });
            
            // Hide any blocked messages when switching modes
            hideBlockedMessage('news');
            hideBlockedMessage('transcript');
            
            console.log(`Switched to ${mode} mode`);
        }

        function resetForm(mode) {
            if (mode === 'news') {
                document.getElementById('newsForm').reset();
                hideBlockedMessage('news');
            } else {
                document.getElementById('transcriptForm').reset();
                hideBlockedMessage('transcript');
            }
            
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'none';
        }

        function showBlockedMessage(mode, message) {
            const blockedMsgId = mode === 'news' ? 'newsBlockedMessage' : 'transcriptBlockedMessage';
            const blockedTextId = mode === 'news' ? 'newsBlockedText' : 'transcriptBlockedText';
            const textareaId = mode === 'news' ? 'newsTextInput' : 'transcriptTextInput';
            
            const blockedMsg = document.getElementById(blockedMsgId);
            const blockedText = document.getElementById(blockedTextId);
            const textarea = document.getElementById(textareaId);
            
            if (blockedMsg && blockedText) {
                blockedText.textContent = message || 'This website is blocking automated access.';
                blockedMsg.classList.add('show');
            }
            
            if (textarea) {
                textarea.classList.add('highlight');
                textarea.focus();
                
                // Scroll to textarea
                setTimeout(() => {
                    textarea.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            }
        }

        function hideBlockedMessage(mode) {
            const blockedMsgId = mode === 'news' ? 'newsBlockedMessage' : 'transcriptBlockedMessage';
            const textareaId = mode === 'news' ? 'newsTextInput' : 'transcriptTextInput';
            
            const blockedMsg = document.getElementById(blockedMsgId);
            const textarea = document.getElementById(textareaId);
            
            if (blockedMsg) {
                blockedMsg.classList.remove('show');
            }
            
            if (textarea) {
                textarea.classList.remove('highlight');
            }
        }

        // Handle form submissions
        document.getElementById('newsForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            hideBlockedMessage('news');
            
            const url = document.getElementById('newsUrlInput').value.trim();
            const text = document.getElementById('newsTextInput').value.trim();
            
            if (!url && !text) {
                alert('Please provide a URL or paste article text');
                return;
            }
            
            const data = {};
            if (url) data.url = url;
            if (text) data.text = text;
            
            await analyzeContent(data, 'news');
        });

        document.getElementById('transcriptForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            hideBlockedMessage('transcript');
            
            const youtubeUrl = document.getElementById('youtubeUrlInput').value.trim();
            const text = document.getElementById('transcriptTextInput').value.trim();
            
            if (!youtubeUrl && !text) {
                alert('Please provide a YouTube URL or paste transcript text');
                return;
            }
            
            const data = {};
            if (youtubeUrl) data.url = youtubeUrl;
            if (text) data.text = text;
            
            await analyzeContent(data, 'transcript');
        });

        async function analyzeContent(data, mode) {
            // Show progress
            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'none';
            
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                // Hide progress
                document.getElementById('progressContainer').style.display = 'none';
                
                // CHECK FOR EXTRACTION BLOCKED
                if (result.prompt_for_text) {
                    console.log('Extraction blocked, prompting user for text');
                    showBlockedMessage(mode, result.user_message);
                    return;
                }
                
                // Check for success
                if (result.success) {
                    displayResults(result);
                } else {
                    // Generic error
                    alert(result.user_message || result.error || 'Analysis failed');
                }
                
            } catch (error) {
                console.error('Analysis error:', error);
                document.getElementById('progressContainer').style.display = 'none';
                alert('An error occurred during analysis. Please try again.');
            }
        }

        function displayResults(data) {
            // Show results section
            document.getElementById('resultsSection').style.display = 'block';
            
            // Populate results (use your existing display logic)
            const overview = document.getElementById('enhancedAnalysisOverview');
            if (overview) {
                overview.innerHTML = createResultsHTML(data);
            }
            
            // Scroll to results
            setTimeout(() => {
                document.getElementById('resultsSection').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 100);
        }

        function createResultsHTML(data) {
            const trustScore = data.trust_score || 0;
            let scoreClass = 'medium';
            let label = 'MODERATE';
            
            if (trustScore >= 80) {
                scoreClass = 'high';
                label = 'TRUSTWORTHY';
            } else if (trustScore >= 60) {
                label = 'RELIABLE';
            } else if (trustScore < 40) {
                scoreClass = 'low';
                label = 'UNRELIABLE';
            }

            return `
                <div class="trust-score-visual">
                    <div class="score-circle-container">
                        <div class="score-circle-bg">
                            <div class="score-circle-inner">
                                <div class="trust-score-big ${scoreClass}">${Math.round(trustScore)}</div>
                                <div class="trust-score-max">/100</div>
                                <div class="trust-label-badge ${scoreClass}">${label}</div>
                            </div>
                        </div>
                    </div>
                    <div class="score-details-section">
                        <h3>Analysis Complete</h3>
                        <p>Trust Score: ${Math.round(trustScore)}/100</p>
                        <p>Services Used: ${data.services_used || 0}</p>
                        <p>Processing Time: ${data.processing_time || 0}s</p>
                    </div>
                </div>
            `;
        }

        console.log('TruthLens with extraction blocking detection loaded');
    </script>
</body>
</html>
