<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TruthLens AI - Professional News Verification Platform</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
    
    <!-- Your CSS Files -->
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/animations.css">
    <link rel="stylesheet" href="/static/css/truthlens-enhanced.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="logo-text">
                        <h1>TruthLens AI</h1>
                        <p>Professional News Verification</p>
                    </div>
                </div>
                <span class="pro-badge">PRO</span>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">Advanced AI-Powered News Analysis</h1>
            <p class="hero-subtitle">
                Verify news articles with our comprehensive suite of 8 specialized AI services.
                Get detailed insights on credibility, bias, manipulation, and more.
            </p>
            
            <!-- Service Pills -->
            <div class="service-pills">
                <div class="service-pill">
                    <i class="fas fa-shield-alt"></i>
                    <span>Source Credibility</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-user-check"></i>
                    <span>Author Analysis</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-balance-scale"></i>
                    <span>Bias Detection</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-check-double"></i>
                    <span>Fact Verification</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-eye"></i>
                    <span>Transparency</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-mask"></i>
                    <span>Manipulation</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-file-alt"></i>
                    <span>Content Analysis</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-copy"></i>
                    <span>Plagiarism Check</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Input Section -->
    <section class="input-section">
        <div class="input-container">
            <!-- Input Mode Toggle -->
            <div class="input-mode-toggle">
                <button class="mode-btn active" data-mode="url">
                    <i class="fas fa-link"></i>
                    Analyze URL
                </button>
                <button class="mode-btn" data-mode="text">
                    <i class="fas fa-file-alt"></i>
                    Analyze Text
                </button>
            </div>

            <!-- URL Input -->
            <div id="urlInputWrapper" class="input-wrapper active">
                <div class="input-explanation" id="urlExplanation">
                    <p>Enter a news article URL to analyze its credibility and trustworthiness.</p>
                </div>
                
                <div class="input-group">
                    <input 
                        type="url" 
                        id="urlInput" 
                        placeholder="https://example.com/news-article" 
                        class="url-input"
                        autocomplete="url"
                    >
                    <button id="analyzeBtn" class="analyze-button">
                        <i class="fas fa-search"></i>
                        <span>Analyze Article</span>
                    </button>
                </div>

                <!-- Example URLs -->
                <div class="examples-section">
                    <p class="examples-label">Try an example:</p>
                    <div class="example-buttons">
                        <button class="example-btn" data-url="https://www.bbc.com/news/world-us-canada-68562045">
                            BBC News
                        </button>
                        <button class="example-btn" data-url="https://www.reuters.com/technology/artificial-intelligence/">
                            Reuters Tech
                        </button>
                        <button class="example-btn" data-url="https://apnews.com/article/climate-change-global-warming">
                            AP Climate
                        </button>
                    </div>
                </div>
            </div>

            <!-- Text Input -->
            <div id="textInputWrapper" class="input-wrapper">
                <div class="input-explanation" id="textExplanation">
                    <p>Paste article text directly for analysis (minimum 100 words).</p>
                </div>
                
                <div class="text-input-group">
                    <textarea 
                        id="textInput" 
                        placeholder="Paste your article text here..."
                        class="text-input"
                        rows="8"
                    ></textarea>
                    <div class="text-actions">
                        <span class="word-count" id="wordCount">0 words</span>
                        <button id="analyzeTextBtn" class="analyze-button">
                            <i class="fas fa-search"></i>
                            <span>Analyze Text</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Error Message -->
            <div class="error-message" id="errorMessage"></div>
        </div>
    </section>

    <!-- Results Section -->
    <section class="results-section" id="resultsSection" style="display: none;">
        <!-- Trust Score Summary -->
        <div class="trust-score-section">
            <div class="trust-score-content">
                <div class="trust-gauge-container">
                    <canvas id="trustScoreGauge"></canvas>
                    <div class="trust-score-label">
                        <span class="score-value" id="trustScoreValue">0</span>
                        <span class="score-suffix">%</span>
                    </div>
                </div>
                
                <div class="trust-details">
                    <h2 class="trust-title">Overall Trust Score</h2>
                    <p class="trust-level" id="trustLevel">Analyzing...</p>
                    <div class="trust-breakdown" id="trustBreakdown">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Key Findings -->
        <div class="key-findings-section" id="keyFindings">
            <!-- Populated by JavaScript -->
        </div>

        <!-- Article Metadata -->
        <div class="article-metadata" id="articleMetadata">
            <!-- Populated by JavaScript -->
        </div>

        <!-- Analysis Services -->
        <div class="analysis-services" id="analysisServices">
            <!-- Populated by JavaScript -->
        </div>

        <!-- Action Buttons -->
        <div class="results-actions">
            <button class="action-btn primary" id="downloadPdfBtn">
                <i class="fas fa-download"></i>
                Download Report
            </button>
            <button class="action-btn secondary" id="shareResultsBtn">
                <i class="fas fa-share"></i>
                Share Results
            </button>
        </div>
    </section>

    <!-- Premium Features -->
    <section class="premium-features">
        <div class="features-content">
            <h2>Why Choose TruthLens PRO?</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <i class="fas fa-bolt"></i>
                    <h3>Real-time Analysis</h3>
                    <p>Get instant results with our advanced AI processing</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-brain"></i>
                    <h3>8 AI Services</h3>
                    <p>Comprehensive analysis from multiple specialized models</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-chart-line"></i>
                    <h3>Detailed Reports</h3>
                    <p>Export professional PDF reports with all findings</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-database"></i>
                    <h3>Fact Database</h3>
                    <p>Cross-reference with trusted fact-checking sources</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2024 TruthLens AI. Professional news verification powered by advanced AI.</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // Application state
        let currentAnalysis = null;
        let isAnalyzing = false;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updateWordCount();
        });

        // Setup all event listeners
        function setupEventListeners() {
            // Analyze buttons
            const analyzeBtn = document.getElementById('analyzeBtn');
            const analyzeTextBtn = document.getElementById('analyzeTextBtn');
            
            if (analyzeBtn) {
                analyzeBtn.addEventListener('click', analyzeArticle);
            }
            
            if (analyzeTextBtn) {
                analyzeTextBtn.addEventListener('click', analyzeArticle);
            }

            // Enter key handling
            const urlInput = document.getElementById('urlInput');
            if (urlInput) {
                urlInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        analyzeArticle();
                    }
                });
            }

            // Mode toggle buttons
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    switchInputMode(this.getAttribute('data-mode'));
                });
            });

            // Example buttons
            document.querySelectorAll('.example-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const url = this.getAttribute('data-url');
                    document.getElementById('urlInput').value = url;
                    analyzeArticle();
                });
            });

            // Text input word count
            const textInput = document.getElementById('textInput');
            if (textInput) {
                textInput.addEventListener('input', updateWordCount);
            }

            // Download and share buttons
            const downloadBtn = document.getElementById('downloadPdfBtn');
            if (downloadBtn) {
                downloadBtn.addEventListener('click', downloadPDF);
            }

            const shareBtn = document.getElementById('shareResultsBtn');
            if (shareBtn) {
                shareBtn.addEventListener('click', shareResults);
            }
        }

        // Switch between URL and text input modes
        function switchInputMode(mode) {
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-mode') === mode);
            });

            const urlWrapper = document.getElementById('urlInputWrapper');
            const textWrapper = document.getElementById('textInputWrapper');

            if (mode === 'url') {
                urlWrapper.classList.add('active');
                textWrapper.classList.remove('active');
            } else {
                urlWrapper.classList.remove('active');
                textWrapper.classList.add('active');
            }
        }

        // Update word count for text input
        function updateWordCount() {
            const textInput = document.getElementById('textInput');
            const wordCount = document.getElementById('wordCount');
            
            if (textInput && wordCount) {
                const text = textInput.value.trim();
                const words = text ? text.split(/\s+/).length : 0;
                wordCount.textContent = `${words} words`;
            }
        }

        // Main analysis function
        async function analyzeArticle() {
            if (isAnalyzing) return;

            // Get current mode
            const isUrlMode = document.querySelector('.mode-btn[data-mode="url"]').classList.contains('active');
            
            // Get input value
            let input, payload;
            if (isUrlMode) {
                const urlInput = document.getElementById('urlInput');
                input = urlInput ? urlInput.value.trim() : '';
                
                // Validate URL
                if (!input) {
                    showError('Please enter a URL to analyze');
                    return;
                }
                
                if (!isValidUrl(input)) {
                    showError('Please enter a valid URL');
                    return;
                }
                
                payload = { url: input };
            } else {
                const textInput = document.getElementById('textInput');
                input = textInput ? textInput.value.trim() : '';
                
                // Validate text
                if (!input) {
                    showError('Please enter text to analyze');
                    return;
                }
                
                const wordCount = input.split(/\s+/).length;
                if (wordCount < 100) {
                    showError('Please enter at least 100 words for accurate analysis');
                    return;
                }
                
                payload = { text: input };
            }

            // Start analysis
            isAnalyzing = true;
            showLoading();
            hideError();

            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    currentAnalysis = data.data;
                    displayResults(data.data);
                } else {
                    showError(data.error || 'Analysis failed. Please try again.');
                }
            } catch (error) {
                console.error('Analysis error:', error);
                showError('Network error. Please check your connection and try again.');
            } finally {
                isAnalyzing = false;
                hideLoading();
            }
        }

        // Validate URL
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        // Display results
        function displayResults(data) {
            // Show results section
            document.getElementById('resultsSection').style.display = 'block';
            
            // Update trust score
            updateTrustScore(data.trust_score, data.trust_level);
            
            // Update key findings
            updateKeyFindings(data);
            
            // Update metadata
            updateMetadata(data.metadata);
            
            // Update service results
            updateServices(data.services);
            
            // Scroll to results
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Update trust score display
        function updateTrustScore(score, level) {
            // Update text values
            document.getElementById('trustScoreValue').textContent = score;
            document.getElementById('trustLevel').textContent = level;
            
            // Update gauge (placeholder - would use Chart.js)
            const gauge = document.getElementById('trustScoreGauge');
            if (gauge) {
                // This would be replaced with actual Chart.js implementation
                gauge.style.background = getScoreColor(score);
            }
            
            // Update breakdown
            const breakdown = document.getElementById('trustBreakdown');
            breakdown.innerHTML = `
                <div class="trust-indicator">
                    <i class="fas fa-info-circle"></i>
                    <span>Based on ${Object.keys(currentAnalysis.services).length} analysis services</span>
                </div>
            `;
        }

        // Get color based on score
        function getScoreColor(score) {
            if (score >= 80) return '#10B981';
            if (score >= 60) return '#3B82F6';
            if (score >= 40) return '#F59E0B';
            if (score >= 20) return '#EF4444';
            return '#991B1B';
        }

        // Update key findings
        function updateKeyFindings(data) {
            const findings = document.getElementById('keyFindings');
            
            // This would be populated based on service results
            findings.innerHTML = `
                <h3>Key Findings</h3>
                <div class="findings-grid">
                    <div class="finding-card positive">
                        <i class="fas fa-check-circle"></i>
                        <p>Credible source with established reputation</p>
                    </div>
                    <div class="finding-card warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Some bias detected in content presentation</p>
                    </div>
                </div>
            `;
        }

        // Update metadata
        function updateMetadata(metadata) {
            const metadataEl = document.getElementById('articleMetadata');
            
            if (metadata && metadata.title) {
                metadataEl.innerHTML = `
                    <h3>Article Information</h3>
                    <div class="metadata-grid">
                        <div class="metadata-item">
                            <span class="label">Title:</span>
                            <span class="value">${metadata.title || 'N/A'}</span>
                        </div>
                        <div class="metadata-item">
                            <span class="label">Publisher:</span>
                            <span class="value">${metadata.publisher || 'N/A'}</span>
                        </div>
                        <div class="metadata-item">
                            <span class="label">Date:</span>
                            <span class="value">${metadata.publish_date || 'N/A'}</span>
                        </div>
                    </div>
                `;
            }
        }

        // Update services
        function updateServices(services) {
            const servicesEl = document.getElementById('analysisServices');
            
            servicesEl.innerHTML = '<h3>Detailed Analysis</h3>';
            
            // Create service cards
            Object.entries(services).forEach(([serviceId, result]) => {
                const serviceCard = createServiceCard(serviceId, result);
                servicesEl.appendChild(serviceCard);
            });
        }

        // Create service card
        function createServiceCard(serviceId, result) {
            const card = document.createElement('div');
            card.className = 'service-card';
            
            const serviceName = serviceId.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            
            card.innerHTML = `
                <div class="service-header">
                    <h4>${serviceName}</h4>
                    <span class="service-score">${result.score || 0}/100</span>
                </div>
                <div class="service-content">
                    <p>${result.summary || 'Analysis complete'}</p>
                </div>
            `;
            
            return card;
        }

        // Show loading state
        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        // Hide loading state
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        // Show error message
        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.classList.add('active');
        }

        // Hide error message
        function hideError() {
            const errorEl = document.getElementById('errorMessage');
            errorEl.classList.remove('active');
        }

        // Download PDF report
        function downloadPDF() {
            if (!currentAnalysis) return;
            
            // This would be implemented with jsPDF
            alert('PDF download feature coming soon!');
        }

        // Share results
        function shareResults() {
            if (!currentAnalysis) return;
            
            // This would implement sharing functionality
            alert('Share feature coming soon!');
        }
    </script>
</body>
</html>
