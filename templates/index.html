<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TruthLens AI - Professional News Verification Platform</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
    
    <style>
        /* Modern Design System */
        :root {
            /* Premium Color Palette */
            --primary: #6366F1;
            --primary-dark: #4F46E5;
            --primary-light: #818CF8;
            --secondary: #EC4899;
            --accent: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --info: #3B82F6;
            
            /* Neutral Colors */
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
            
            /* Typography */
            --font-primary: 'Inter', -apple-system, sans-serif;
            --font-display: 'Space Grotesk', sans-serif;
            
            /* Spacing */
            --space-xs: 0.5rem;
            --space-sm: 1rem;
            --space-md: 1.5rem;
            --space-lg: 2rem;
            --space-xl: 3rem;
            --space-2xl: 4rem;
            
            /* Layout */
            --radius: 1rem;
            --radius-sm: 0.5rem;
            --radius-lg: 1.5rem;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            
            /* Gradients */
            --gradient-primary: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
            --gradient-premium: linear-gradient(135deg, #FFD93D 0%, #FFB344 100%);
            --gradient-dark: linear-gradient(180deg, #1F2937 0%, #111827 100%);
            --gradient-success: linear-gradient(135deg, #10B981 0%, #059669 100%);
            --gradient-warning: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            --gradient-danger: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            --gradient-info: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);
        }

        /* Global Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: var(--gray-50);
            color: var(--gray-900);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Premium Loading Animation */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            display: none;
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            position: relative;
        }

        .loading-spinner::before,
        .loading-spinner::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            border: 3px solid transparent;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }

        .loading-spinner::after {
            animation-delay: 0.3s;
            border-top-color: var(--secondary);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Premium Header */
        .header {
            background: white;
            border-bottom: 1px solid var(--gray-200);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-md) var(--space-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-primary);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .logo-text h1 {
            font-family: var(--font-display);
            font-size: 1.875rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-text p {
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        .pro-badge {
            background: var(--gradient-premium);
            color: var(--gray-900);
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Hero Section */
        .hero-section {
            background: white;
            padding: var(--space-2xl) 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .hero-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--space-lg);
            text-align: center;
        }

        .hero-title {
            font-family: var(--font-display);
            font-size: 3rem;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: var(--space-md);
            background: var(--gradient-dark);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero-subtitle {
            font-size: 1.25rem;
            color: var(--gray-600);
            margin-bottom: var(--space-xl);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Service Pills */
        .service-pills {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
            justify-content: center;
            margin-bottom: var(--space-xl);
        }

        .service-pill {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            padding: 0.5rem 1rem;
            background: var(--gray-100);
            border-radius: 999px;
            font-size: 0.875rem;
            color: var(--gray-700);
        }

        .service-pill i {
            color: var(--primary);
        }

        /* Input Section */
        .input-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            gap: var(--space-sm);
            align-items: center;
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-xs);
            transition: all 0.3s ease;
            box-shadow: var(--shadow-lg);
        }

        .input-wrapper:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1), var(--shadow-xl);
        }

        .url-input {
            flex: 1;
            padding: var(--space-md);
            border: none;
            font-size: 1rem;
            background: transparent;
            outline: none;
        }

        .analyze-button {
            padding: var(--space-md) var(--space-xl);
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            white-space: nowrap;
        }

        .analyze-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .analyze-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-xl) var(--space-lg);
        }

        /* Results Section */
        .results-section {
            display: none;
            animation: fadeInUp 0.6s ease;
        }

        .results-section.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Enhanced Trust Score Section */
        .trust-score-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .trust-score-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-lg);
        }

        .trust-score-content {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: var(--space-xl);
            align-items: start;
        }

        .trust-gauge-container {
            position: relative;
            width: 280px;
            height: 280px;
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow) inset;
        }

        .trust-gauge-visual {
            position: relative;
            width: 100%;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .trust-score-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .trust-score-number {
            font-size: 4rem;
            font-weight: 700;
            line-height: 1;
            display: block;
        }

        .trust-score-label {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-top: 0.5rem;
        }

        .trust-level-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            background: var(--gray-50);
            border-radius: var(--radius);
            margin-top: var(--space-md);
            justify-content: center;
        }

        .trust-level-icon {
            font-size: 1.25rem;
        }

        .trust-level-text {
            font-weight: 600;
            font-size: 1.125rem;
        }

        .trust-score-details {
            flex: 1;
        }

        .trust-score-details h2 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--space-md);
        }

        .trust-summary {
            color: var(--gray-600);
            line-height: 1.8;
            margin-bottom: var(--space-lg);
            font-size: 1.125rem;
        }

        .what-we-analyzed {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .what-we-analyzed-title {
            font-weight: 600;
            margin-bottom: var(--space-sm);
            color: var(--gray-700);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .what-we-analyzed-title i {
            color: var(--primary);
        }

        .what-we-analyzed-content {
            color: var(--gray-600);
            line-height: 1.6;
        }

        .trust-breakdown {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
        }

        .breakdown-item {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-md);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .breakdown-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .breakdown-item:hover {
            background: white;
            box-shadow: var(--shadow-md);
        }

        .breakdown-item:hover::before {
            transform: scaleX(1);
        }

        .breakdown-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-sm);
        }

        .breakdown-label {
            font-weight: 600;
            color: var(--gray-700);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .breakdown-icon {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .breakdown-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .breakdown-explanation {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-top: var(--space-xs);
        }

        .breakdown-bar {
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            margin-top: var(--space-sm);
            overflow: hidden;
            position: relative;
        }

        .breakdown-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease-out;
            position: relative;
            overflow: hidden;
        }

        .breakdown-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.3) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        .breakdown-positive { background: rgba(16, 185, 129, 0.1); }
        .breakdown-positive .breakdown-icon { background: rgba(16, 185, 129, 0.2); color: var(--accent); }
        .breakdown-positive .breakdown-fill { background: var(--gradient-success); }

        .breakdown-warning { background: rgba(245, 158, 11, 0.1); }
        .breakdown-warning .breakdown-icon { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .breakdown-warning .breakdown-fill { background: var(--gradient-warning); }

        .breakdown-negative { background: rgba(239, 68, 68, 0.1); }
        .breakdown-negative .breakdown-icon { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        .breakdown-negative .breakdown-fill { background: var(--gradient-danger); }

        .breakdown-neutral { background: rgba(59, 130, 246, 0.1); }
        .breakdown-neutral .breakdown-icon { background: rgba(59, 130, 246, 0.2); color: var(--info); }
        .breakdown-neutral .breakdown-fill { background: var(--gradient-info); }

        .download-section {
            display: flex;
            gap: var(--space-sm);
        }

        .download-button {
            padding: var(--space-sm) var(--space-md);
            background: white;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius);
            color: var(--gray-700);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .download-button:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: var(--gray-50);
        }

        /* Article Info Section */
        .article-info-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
            box-shadow: var(--shadow-md);
        }

        .article-header {
            margin-bottom: var(--space-lg);
        }

        .article-title {
            font-size: 1.875rem;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: var(--space-md);
        }

        .article-meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-lg);
            color: var(--gray-600);
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .meta-item i {
            color: var(--primary);
        }

        /* Key Findings */
        .key-findings {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-lg);
            border-left: 4px solid var(--primary);
        }

        .key-findings-header {
            font-weight: 600;
            margin-bottom: var(--space-md);
            color: var(--primary);
        }

        .finding-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-sm);
            margin-bottom: var(--space-sm);
            line-height: 1.6;
        }

        .finding-item i {
            margin-top: 0.25rem;
            flex-shrink: 0;
        }

        .finding-positive i { color: var(--accent); }
        .finding-warning i { color: var(--warning); }
        .finding-negative i { color: var(--danger); }

        /* Accordion Service Container */
        .services-accordion {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        /* Service Accordion Item */
        .service-accordion-item {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .service-accordion-item:hover {
            box-shadow: var(--shadow-lg);
        }

        .service-accordion-item.active {
            box-shadow: var(--shadow-xl);
        }

        .service-accordion-header {
            padding: var(--space-lg);
            cursor: pointer;
            user-select: none;
            transition: all 0.3s ease;
            background: white;
            position: relative;
        }

        .service-accordion-header:hover {
            background: var(--gray-50);
        }

        .service-accordion-item.active .service-accordion-header {
            background: var(--gray-50);
            border-bottom: 1px solid var(--gray-200);
        }

        .service-header-content {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .service-icon-wrapper {
            width: 56px;
            height: 56px;
            background: var(--gradient-primary);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .service-accordion-item.active .service-icon-wrapper {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
        }

        .service-info {
            flex: 1;
        }

        .service-name {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            color: var(--gray-900);
        }

        .service-description {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-bottom: var(--space-sm);
        }

        .service-preview {
            display: flex;
            gap: var(--space-lg);
            align-items: center;
            margin-top: var(--space-sm);
        }

        .preview-item {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            font-size: 0.875rem;
        }

        .preview-label {
            color: var(--gray-500);
        }

        .preview-value {
            font-weight: 600;
            color: var(--gray-900);
        }

        .service-expand-icon {
            position: absolute;
            right: var(--space-lg);
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.25rem;
            color: var(--gray-400);
            transition: all 0.3s ease;
        }

        .service-accordion-item.active .service-expand-icon {
            transform: translateY(-50%) rotate(180deg);
            color: var(--primary);
        }

        .pro-lock-badge {
            position: absolute;
            top: var(--space-md);
            right: calc(var(--space-lg) + 40px);
            background: var(--gradient-premium);
            color: var(--gray-900);
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .service-accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: all 0.5s ease;
        }

        .service-accordion-item.active .service-accordion-content {
            max-height: 2000px;
        }

        .service-content-inner {
            padding: var(--space-xl);
            padding-top: 0;
        }

        /* Service Content Sections */
        .service-section {
            margin-bottom: var(--space-lg);
        }

        .service-section:last-child {
            margin-bottom: 0;
        }

        .section-title {
            font-weight: 600;
            margin-bottom: var(--space-sm);
            color: var(--gray-700);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .section-title i {
            color: var(--primary);
            font-size: 0.875rem;
        }

        .service-results {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-md);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-sm) 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 500;
            color: var(--gray-700);
        }

        .result-value {
            font-weight: 600;
            color: var(--gray-900);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-high { background: rgba(16, 185, 129, 0.1); color: var(--accent); }
        .status-medium { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .status-low { background: rgba(239, 68, 68, 0.1); color: var(--danger); }

        /* Progress Bar */
        .progress-bar {
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            margin: var(--space-md) 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* Dimension Bars */
        .dimension-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .dimension-item {
            background: white;
            padding: var(--space-md);
            border-radius: var(--radius);
            border: 1px solid var(--gray-200);
            transition: all 0.3s ease;
        }

        .dimension-item:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .dimension-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--space-xs);
        }

        .dimension-name {
            font-weight: 500;
            color: var(--gray-700);
        }

        .dimension-score {
            font-weight: 600;
            color: var(--gray-900);
        }

        .dimension-bar {
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
        }

        .dimension-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.6s ease;
        }

        /* Claim List */
        .claims-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .claim-item {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            padding: var(--space-md);
            transition: all 0.3s ease;
        }

        .claim-item:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .claim-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-sm);
        }

        .claim-text {
            flex: 1;
            font-weight: 500;
            color: var(--gray-900);
            line-height: 1.5;
        }

        .claim-status {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .claim-verified { background: rgba(16, 185, 129, 0.1); color: var(--accent); }
        .claim-unverified { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .claim-false { background: rgba(239, 68, 68, 0.1); color: var(--danger); }

        .claim-details {
            margin-top: var(--space-sm);
            padding-top: var(--space-sm);
            border-top: 1px solid var(--gray-100);
            font-size: 0.875rem;
            color: var(--gray-600);
            line-height: 1.6;
        }

        /* Technique List */
        .techniques-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-md);
        }

        .technique-card {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-md);
            border: 1px solid transparent;
            transition: all 0.3s ease;
        }

        .technique-card:hover {
            border-color: var(--primary);
            background: white;
            box-shadow: var(--shadow-sm);
        }

        .technique-name {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-xs);
        }

        .technique-description {
            font-size: 0.875rem;
            color: var(--gray-600);
            line-height: 1.5;
        }

        .technique-severity {
            display: inline-block;
            margin-top: var(--space-sm);
            padding: 0.125rem 0.5rem;
            background: var(--gray-200);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
        }

        .severity-high { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .severity-medium { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .severity-low { background: rgba(59, 130, 246, 0.1); color: var(--info); }

        /* Info Box */
        .info-box {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-md);
            margin-top: var(--space-md);
            border-left: 4px solid var(--info);
        }

        .info-box-title {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-xs);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .info-box-title i {
            color: var(--info);
        }

        .info-box-content {
            color: var(--gray-600);
            line-height: 1.6;
        }

        /* Visualization Container */
        .service-visualization {
            margin: var(--space-lg) 0;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-lg);
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2rem;
            }

            .trust-score-content {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .trust-gauge-container {
                margin: 0 auto;
            }

            .trust-breakdown {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-direction: column;
                gap: var(--space-md);
            }

            .input-wrapper {
                flex-direction: column;
                padding: var(--space-md);
            }

            .analyze-button {
                width: 100%;
                justify-content: center;
            }

            .techniques-grid {
                grid-template-columns: 1fr;
            }

            .service-preview {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-sm);
            }
        }

        /* Error State */
        .error-message {
            background: #FEE2E2;
            border: 1px solid #FCA5A5;
            color: #991B1B;
            padding: var(--space-md);
            border-radius: var(--radius);
            margin-top: var(--space-md);
            display: none;
            animation: shake 0.5s ease;
            font-weight: 500;
            text-align: center;
        }

        .error-message.active {
            display: block;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: var(--space-xl);
            color: var(--gray-500);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: var(--space-md);
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 1.125rem;
            margin-bottom: var(--space-sm);
        }

        .empty-state-subtext {
            font-size: 0.875rem;
            color: var(--gray-400);
        }

        /* CRITICAL FIX: Ensure content is always visible */
        .card-content {
            display: block !important;
        }

        .analysis-card {
            display: block !important;
            opacity: 1 !important;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="logo-text">
                        <h1>TruthLens AI</h1>
                        <p>Professional News Verification</p>
                    </div>
                </div>
                <span class="pro-badge">PRO</span>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">Advanced AI-Powered News Analysis</h1>
            <p class="hero-subtitle">
                Verify news articles with our comprehensive suite of 8 specialized AI services.
                Get detailed insights on credibility, bias, manipulation, and more.
            </p>

            <!-- Service Pills -->
            <div class="service-pills">
                <div class="service-pill">
                    <i class="fas fa-shield-alt"></i>
                    <span>Source Credibility</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-user-check"></i>
                    <span>Author Analysis</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-balance-scale"></i>
                    <span>Bias Detection</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-check-double"></i>
                    <span>Fact Checking</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-eye"></i>
                    <span>Transparency Analysis</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-mask"></i>
                    <span>Manipulation Detection</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-file-alt"></i>
                    <span>Content Analysis</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-copy"></i>
                    <span>Plagiarism Detection</span>
                </div>
            </div>

            <!-- Input Section -->
            <div class="input-container">
                <div class="input-wrapper">
                    <input 
                        type="url" 
                        id="urlInput" 
                        class="url-input" 
                        placeholder="Enter a news article URL to analyze..."
                        autocomplete="off"
                    >
                    <button id="analyzeBtn" class="analyze-button" onclick="analyzeArticle()">
                        <i class="fas fa-search"></i>
                        Analyze Article
                    </button>
                </div>
                <div id="errorMessage" class="error-message"></div>
                
                <!-- Example URLs for testing -->
                <div style="margin-top: 1.5rem; padding: 1rem; background: var(--gray-100); border-radius: var(--radius); text-align: center;">
                    <p style="color: var(--gray-700); font-size: 0.875rem; margin-bottom: 0.5rem;">
                        <strong>Note:</strong> Some sites like Washington Post block automated analysis. Try these instead:
                    </p>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center; margin-top: 0.5rem;">
                        <button onclick="tryExample('https://www.cnn.com')" style="padding: 0.25rem 0.75rem; background: white; border: 1px solid var(--gray-300); border-radius: var(--radius-sm); font-size: 0.813rem; cursor: pointer; transition: all 0.2s;">CNN</button>
                        <button onclick="tryExample('https://www.bbc.com/news')" style="padding: 0.25rem 0.75rem; background: white; border: 1px solid var(--gray-300); border-radius: var(--radius-sm); font-size: 0.813rem; cursor: pointer; transition: all 0.2s;">BBC News</button>
                        <button onclick="tryExample('https://www.reuters.com')" style="padding: 0.25rem 0.75rem; background: white; border: 1px solid var(--gray-300); border-radius: var(--radius-sm); font-size: 0.813rem; cursor: pointer; transition: all 0.2s;">Reuters</button>
                        <button onclick="tryExample('https://www.npr.org')" style="padding: 0.25rem 0.75rem; background: white; border: 1px solid var(--gray-300); border-radius: var(--radius-sm); font-size: 0.813rem; cursor: pointer; transition: all 0.2s;">NPR</button>
                        <button onclick="tryExample('https://www.theguardian.com')" style="padding: 0.25rem 0.75rem; background: white; border: 1px solid var(--gray-300); border-radius: var(--radius-sm); font-size: 0.813rem; cursor: pointer; transition: all 0.2s;">The Guardian</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Results Section -->
        <div id="resultsSection" class="results-section">
            <!-- Enhanced Trust Score Section -->
            <div class="trust-score-section">
                <div class="trust-score-header">
                    <div>
                        <h2>Overall Trust Score Analysis</h2>
                    </div>
                    <div class="download-section">
                        <button class="download-button" onclick="downloadPDF()">
                            <i class="fas fa-file-pdf"></i>
                            Download Report
                        </button>
                        <button class="download-button" onclick="shareResults()">
                            <i class="fas fa-share-alt"></i>
                            Share
                        </button>
                    </div>
                </div>
                <div class="trust-score-content">
                    <div class="trust-gauge-container">
                        <div class="trust-gauge-visual">
                            <canvas id="trustGauge"></canvas>
                            <div class="trust-score-value">
                                <span id="trustScoreNumber" class="trust-score-number">0</span>
                                <span class="trust-score-label">out of 100</span>
                            </div>
                        </div>
                        <div id="trustLevelIndicator" class="trust-level-indicator">
                            <i id="trustLevelIcon" class="fas fa-circle trust-level-icon"></i>
                            <span id="trustLevelText" class="trust-level-text">Analyzing...</span>
                        </div>
                    </div>
                    <div class="trust-score-details">
                        <h2>What This Score Means</h2>
                        <p id="trustSummary" class="trust-summary"></p>
                        
                        <div class="what-we-analyzed">
                            <div class="what-we-analyzed-title">
                                <i class="fas fa-search"></i>
                                What We Analyzed
                            </div>
                            <div class="what-we-analyzed-content">
                                We examined 8 critical dimensions of this article including the credibility of the source and author, 
                                potential biases, factual accuracy, transparency of information, manipulation techniques, 
                                content quality, and originality. Each component contributes to the overall trust score.
                            </div>
                        </div>

                        <div id="trustBreakdown" class="trust-breakdown"></div>
                    </div>
                </div>
            </div>

            <!-- Article Info Section -->
            <div class="article-info-section">
                <div class="article-header">
                    <h3 id="articleTitle" class="article-title"></h3>
                    <div id="articleMeta" class="article-meta"></div>
                </div>
                <div id="keyFindings" class="key-findings"></div>
            </div>

            <!-- Services Accordion -->
            <div id="servicesAccordion" class="services-accordion"></div>
        </div>
    </main>

    <script>
        // Global state
        let currentAnalysis = null;
        let isAnalyzing = false;
        let charts = {};
        let isPro = true; // For development, keep pro features open

        // Service definitions
        const services = [
            {
                id: 'source_credibility',
                name: 'Source Credibility',
                icon: 'fa-shield-alt',
                description: 'Evaluates the reliability and trustworthiness of the news source',
                isPro: false
            },
            {
                id: 'author_analyzer',
                name: 'Author Analysis',
                icon: 'fa-user-check',
                description: 'Analyzes author credentials and publishing history',
                isPro: false
            },
            {
                id: 'bias_detector',
                name: 'Bias Detection',
                icon: 'fa-balance-scale',
                description: 'Identifies political, ideological, and narrative biases',
                isPro: true
            },
            {
                id: 'fact_checker',
                name: 'Fact Verification',
                icon: 'fa-check-double',
                description: 'Verifies claims against trusted fact-checking databases',
                isPro: true
            },
            {
                id: 'transparency_analyzer',
                name: 'Transparency Analysis',
                icon: 'fa-eye',
                description: 'Evaluates source disclosure and funding transparency',
                isPro: true
            },
            {
                id: 'manipulation_detector',
                name: 'Manipulation Detection',
                icon: 'fa-mask',
                description: 'Detects emotional manipulation and propaganda techniques',
                isPro: true
            },
            {
                id: 'content_analyzer',
                name: 'Content Analysis',
                icon: 'fa-file-alt',
                description: 'Analyzes writing quality, structure, and coherence',
                isPro: true
            },
            {
                id: 'plagiarism_detector',
                name: 'Plagiarism Check',
                icon: 'fa-copy',
                description: 'Checks for copied content and proper attribution',
                isPro: true
            }
        ];

        // Initialize on DOM load
        document.addEventListener('DOMContentLoaded', function() {
            const urlInput = document.getElementById('urlInput');
            urlInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    analyzeArticle();
                }
            });
        });

        // Try example URL
        function tryExample(url) {
            document.getElementById('urlInput').value = url;
            document.getElementById('urlInput').focus();
        }

        // Main analysis function
        async function analyzeArticle() {
            const urlInput = document.getElementById('urlInput');
            const url = urlInput.value.trim();
            
            if (!url) {
                showError('Please enter a URL');
                return;
            }
            
            if (!isValidUrl(url)) {
                showError('Please enter a valid URL');
                return;
            }
            
            if (isAnalyzing) return;
            
            isAnalyzing = true;
            hideError();
            hideResults();
            showLoading();
            
            const analyzeBtn = document.getElementById('analyzeBtn');
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
            
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || error.error || 'Analysis failed');
                }
                
                const responseData = await response.json();
                console.log('Raw API response:', responseData);
                
                // Extract data from response
                let data = responseData;
                if (responseData.success && responseData.data) {
                    data = responseData.data;
                }
                
                currentAnalysis = data;
                displayResults(data);
                
            } catch (error) {
                showError(error.message || 'Failed to analyze article');
            } finally {
                isAnalyzing = false;
                hideLoading();
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<i class="fas fa-search"></i> Analyze Article';
            }
        }

        // Display results with enhanced trust score section
        function displayResults(data) {
            console.log('displayResults called with:', data);
            
            if (!data) {
                console.error('No data provided to displayResults');
                showError('No analysis data received');
                return;
            }
            
            const resultsSection = document.getElementById('resultsSection');
            resultsSection.classList.add('active');
            
            // Display each component
            try {
                displayEnhancedTrustScore(data.analysis, data);
            } catch (e) {
                console.error('Error displaying trust score:', e);
            }
            
            try {
                displayArticleInfo(data.article, data.analysis);
            } catch (e) {
                console.error('Error displaying article info:', e);
            }
            
            try {
                displayServiceAccordion(data);
            } catch (e) {
                console.error('Error displaying service accordion:', e);
            }
            
            // Scroll to results
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Enhanced trust score display with explanations
        function displayEnhancedTrustScore(analysis, fullData) {
            if (!analysis) {
                console.error('No analysis data provided to displayEnhancedTrustScore');
                return;
            }
            
            const score = analysis.trust_score || 0;
            const level = analysis.trust_level || 'Unknown';
            
            // Update score number with animation
            animateTrustScore(score);
            
            // Update level indicator
            updateTrustLevelIndicator(score, level);
            
            // Update summary with contextual explanation
            const summaryEl = document.getElementById('trustSummary');
            summaryEl.textContent = getTrustSummaryExplanation(score, level, analysis);
            
            // Create detailed breakdown with explanations
            const detailedAnalysis = fullData.detailed_analysis || {};
            const breakdownData = [
                {
                    id: 'source_credibility',
                    icon: 'fa-shield-alt',
                    label: 'Source Credibility',
                    value: detailedAnalysis.source_credibility?.credibility_score || 0,
                    explanation: getSourceCredibilityExplanation(detailedAnalysis.source_credibility)
                },
                {
                    id: 'author_credibility',
                    icon: 'fa-user-check',
                    label: 'Author Credibility',
                    value: detailedAnalysis.author_analyzer?.credibility_score || 0,
                    explanation: getAuthorCredibilityExplanation(detailedAnalysis.author_analyzer)
                },
                {
                    id: 'objectivity',
                    icon: 'fa-balance-scale',
                    label: 'Objectivity Score',
                    value: 100 - (detailedAnalysis.bias_detector?.overall_bias_score || 0),
                    explanation: getObjectivityExplanation(detailedAnalysis.bias_detector)
                },
                {
                    id: 'fact_accuracy',
                    icon: 'fa-check-double',
                    label: 'Fact Accuracy',
                    value: calculateFactAccuracy(detailedAnalysis.fact_checker),
                    explanation: getFactAccuracyExplanation(detailedAnalysis.fact_checker)
                }
            ];
            
            let breakdownHtml = '';
            breakdownData.forEach(item => {
                const type = getBreakdownType(item.value);
                breakdownHtml += `
                    <div class="breakdown-item breakdown-${type}">
                        <div class="breakdown-header">
                            <div class="breakdown-label">
                                <div class="breakdown-icon">
                                    <i class="fas ${item.icon}"></i>
                                </div>
                                <span>${item.label}</span>
                            </div>
                            <div class="breakdown-value">${item.value}%</div>
                        </div>
                        <div class="breakdown-explanation">${item.explanation}</div>
                        <div class="breakdown-bar">
                            <div class="breakdown-fill" style="width: 0%;" data-target="${item.value}"></div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('trustBreakdown').innerHTML = breakdownHtml;
            
            // Animate breakdown bars after DOM update
            setTimeout(() => {
                document.querySelectorAll('.breakdown-fill').forEach(bar => {
                    const target = bar.getAttribute('data-target');
                    bar.style.width = target + '%';
                });
            }, 100);
            
            // Create enhanced gauge chart
            createEnhancedTrustGauge(score);
        }

        // Get contextual trust summary explanation
        function getTrustSummaryExplanation(score, level, analysis) {
            if (score >= 80) {
                return "This article demonstrates high credibility across all dimensions. The source is well-established, the author has verified credentials, minimal bias was detected, and factual claims have been verified. You can generally trust the information presented.";
            } else if (score >= 60) {
                return "This article shows moderate credibility. While some trust indicators are positive, there are areas of concern such as limited source transparency, some detected bias, or unverified claims. Read with a critical eye and cross-reference important information.";
            } else if (score >= 40) {
                return "This article has low credibility. Significant issues were found including questionable source reliability, strong bias indicators, or multiple unverified claims. Be cautious about accepting information at face value and seek additional sources.";
            } else {
                return "This article shows very low credibility. Major red flags include unverifiable sources, extreme bias, false claims, or manipulation techniques. The information presented should not be trusted without extensive verification from reliable sources.";
            }
        }

        // Get explanation for source credibility
        function getSourceCredibilityExplanation(data) {
            if (!data) return "Unable to verify source credibility";
            
            const score = data.credibility_score || 0;
            const sourceName = data.source_name || "Unknown source";
            
            if (score >= 80) {
                return `${sourceName} is an established, reputable news source with strong editorial standards and fact-checking processes.`;
            } else if (score >= 60) {
                return `${sourceName} is a moderately credible source with some concerns about consistency or transparency.`;
            } else if (score >= 40) {
                return `${sourceName} has questionable credibility with known issues in reporting accuracy or bias.`;
            } else if (score > 0) {
                return `${sourceName} is not a reliable news source and has a poor track record for accuracy.`;
            } else {
                return "Source could not be verified or is not in our database of known news sources.";
            }
        }

        // Get explanation for author credibility
        function getAuthorCredibilityExplanation(data) {
            if (!data) return "Author information not available";
            
            const score = data.credibility_score || 0;
            const authorName = data.author_name || data.name || "Unknown author";
            
            if (score >= 80) {
                return `${authorName} is a verified journalist with established credentials and expertise in this topic area.`;
            } else if (score >= 60) {
                return `${authorName} has some journalistic experience but limited verification or expertise in this specific area.`;
            } else if (score >= 40) {
                return `Limited information available about ${authorName}'s credentials or journalistic background.`;
            } else if (score > 0) {
                return `${authorName} has no verifiable journalistic credentials or has credibility concerns.`;
            } else {
                return "No author information provided or author could not be verified.";
            }
        }

        // Get explanation for objectivity
        function getObjectivityExplanation(data) {
            if (!data) return "Bias analysis not available";
            
            const biasScore = data.overall_bias_score || 0;
            const objectivityScore = 100 - biasScore;
            
            if (objectivityScore >= 80) {
                return "Minimal bias detected. The article presents information objectively with balanced viewpoints.";
            } else if (objectivityScore >= 60) {
                return "Some bias detected in language or framing, but generally maintains journalistic standards.";
            } else if (objectivityScore >= 40) {
                return "Significant bias present through selective facts, loaded language, or one-sided arguments.";
            } else {
                return "Extreme bias detected. The article heavily favors one perspective without balance.";
            }
        }

        // Get explanation for fact accuracy
        function getFactAccuracyExplanation(factCheckerData) {
            if (!factCheckerData) return "Fact checking not performed";
            
            const total = factCheckerData.total_claims || 0;
            const verified = factCheckerData.verified_claims || 0;
            
            if (total === 0) {
                return "No factual claims found to verify in this article.";
            }
            
            const accuracy = Math.round((verified / total) * 100);
            
            if (accuracy >= 80) {
                return `${verified} of ${total} factual claims verified as accurate through trusted fact-checking sources.`;
            } else if (accuracy >= 60) {
                return `${verified} of ${total} claims verified. Some claims could not be confirmed or contain inaccuracies.`;
            } else if (accuracy >= 40) {
                return `Only ${verified} of ${total} claims could be verified. Multiple unverified or disputed claims present.`;
            } else {
                return `Major factual issues: only ${verified} of ${total} claims are accurate. Contains false or misleading information.`;
            }
        }

        // Calculate fact accuracy percentage
        function calculateFactAccuracy(factCheckerData) {
            if (!factCheckerData) return 0;
            
            const total = factCheckerData.total_claims || 0;
            const verified = factCheckerData.verified_claims || 0;
            
            if (total === 0) return 0;
            return Math.round((verified / total) * 100);
        }

        // Animate trust score number
        function animateTrustScore(targetScore) {
            const scoreEl = document.getElementById('trustScoreNumber');
            let currentScore = 0;
            const increment = targetScore / 50;
            const interval = setInterval(() => {
                currentScore += increment;
                if (currentScore >= targetScore) {
                    currentScore = targetScore;
                    clearInterval(interval);
                }
                scoreEl.textContent = Math.round(currentScore);
                scoreEl.style.color = getScoreColor(currentScore);
            }, 20);
        }

        // Update trust level indicator
        function updateTrustLevelIndicator(score, level) {
            const iconEl = document.getElementById('trustLevelIcon');
            const textEl = document.getElementById('trustLevelText');
            const indicatorEl = document.getElementById('trustLevelIndicator');
            
            // Set text
            textEl.textContent = level;
            
            // Set color and icon based on score
            if (score >= 80) {
                iconEl.className = 'fas fa-check-circle trust-level-icon';
                iconEl.style.color = 'var(--accent)';
                indicatorEl.style.background = 'rgba(16, 185, 129, 0.1)';
                indicatorEl.style.border = '2px solid var(--accent)';
            } else if (score >= 60) {
                iconEl.className = 'fas fa-exclamation-circle trust-level-icon';
                iconEl.style.color = 'var(--info)';
                indicatorEl.style.background = 'rgba(59, 130, 246, 0.1)';
                indicatorEl.style.border = '2px solid var(--info)';
            } else if (score >= 40) {
                iconEl.className = 'fas fa-exclamation-triangle trust-level-icon';
                iconEl.style.color = 'var(--warning)';
                indicatorEl.style.background = 'rgba(245, 158, 11, 0.1)';
                indicatorEl.style.border = '2px solid var(--warning)';
            } else {
                iconEl.className = 'fas fa-times-circle trust-level-icon';
                iconEl.style.color = 'var(--danger)';
                indicatorEl.style.background = 'rgba(239, 68, 68, 0.1)';
                indicatorEl.style.border = '2px solid var(--danger)';
            }
        }

        // Create enhanced trust gauge
        function createEnhancedTrustGauge(score) {
            const ctx = document.getElementById('trustGauge').getContext('2d');
            
            if (charts.trustGauge) {
                charts.trustGauge.destroy();
            }
            
            // Create gradient based on score
            const gradient = ctx.createLinearGradient(0, 0, 300, 0);
            if (score >= 80) {
                gradient.addColorStop(0, '#10b981');
                gradient.addColorStop(1, '#059669');
            } else if (score >= 60) {
                gradient.addColorStop(0, '#3b82f6');
                gradient.addColorStop(1, '#2563eb');
            } else if (score >= 40) {
                gradient.addColorStop(0, '#f59e0b');
                gradient.addColorStop(1, '#d97706');
            } else {
                gradient.addColorStop(0, '#ef4444');
                gradient.addColorStop(1, '#dc2626');
            }
            
            charts.trustGauge = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [score, 100 - score],
                        backgroundColor: [gradient, '#E5E7EB'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    circumference: 180,
                    rotation: -90,
                    cutout: '85%',
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    }
                }
            });
        }

        // Get breakdown type based on score
        function getBreakdownType(score) {
            if (score >= 80) return 'positive';
            if (score >= 60) return 'neutral';
            if (score >= 40) return 'warning';
            return 'negative';
        }

        // Display article info
        function displayArticleInfo(article, analysis) {
            document.getElementById('articleTitle').textContent = article?.title || 'Untitled Article';
            
            const metaHtml = `
                <div class="meta-item">
                    <i class="fas fa-user"></i>
                    <span>${article?.author || 'Unknown Author'}</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-globe"></i>
                    <span>${article?.domain || 'Unknown Source'}</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-calendar"></i>
                    <span>${formatDate(article?.publish_date)}</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-clock"></i>
                    <span>${Math.ceil((article?.word_count || 0) / 200)} min read</span>
                </div>
            `;
            document.getElementById('articleMeta').innerHTML = metaHtml;
            
            // Display key findings
            const findings = analysis?.key_findings || [];
            
            if (findings.length > 0) {
                let findingsHtml = '<h4 class="key-findings-header">Key Findings</h4>';
                findings.forEach(finding => {
                    const type = finding.severity === 'positive' ? 'positive' : 
                               finding.severity === 'high' ? 'negative' : 'warning';
                    const icon = type === 'positive' ? 'fa-check-circle' : 
                               type === 'negative' ? 'fa-times-circle' : 'fa-exclamation-circle';
                    
                    findingsHtml += `
                        <div class="finding-item finding-${type}">
                            <i class="fas ${icon}"></i>
                            <span>${escapeHtml(finding.text || finding.finding)}</span>
                        </div>
                    `;
                });
                document.getElementById('keyFindings').innerHTML = findingsHtml;
            } else {
                document.getElementById('keyFindings').innerHTML = `
                    <div class="info-box">
                        <div class="info-box-title">
                            <i class="fas fa-info-circle"></i>
                            Analysis Summary
                        </div>
                        <div class="info-box-content">
                            The detailed analysis of this article is complete. Review the individual service results below for specific insights about credibility, bias, factual accuracy, and more.
                        </div>
                    </div>
                `;
            }
        }

        // Display service accordion
        function displayServiceAccordion(data) {
            const container = document.getElementById('servicesAccordion');
            container.innerHTML = '';
            
            const detailedAnalysis = data.detailed_analysis || {};
            
            services.forEach((service, index) => {
                const serviceData = detailedAnalysis[service.id] || {};
                const accordionItem = createServiceAccordionItem(service, serviceData, index);
                container.appendChild(accordionItem);
            });
        }

        // Create service accordion item
        function createServiceAccordionItem(service, serviceData, index) {
            const item = document.createElement('div');
            item.className = 'service-accordion-item';
            item.id = `service-${service.id}`;
            
            // Extract preview data
            const previewData = getServicePreviewData(service.id, serviceData);
            
            item.innerHTML = `
                <div class="service-accordion-header" onclick="toggleAccordion('${service.id}')">
                    <div class="service-header-content">
                        <div class="service-icon-wrapper">
                            <i class="fas ${service.icon}"></i>
                        </div>
                        <div class="service-info">
                            <h3 class="service-name">${service.name}</h3>
                            <p class="service-description">${service.description}</p>
                            <div class="service-preview">
                                ${previewData.map(preview => `
                                    <div class="preview-item">
                                        <span class="preview-label">${preview.label}:</span>
                                        <span class="preview-value" style="color: ${preview.color || 'inherit'}">
                                            ${preview.value}
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    ${service.isPro && !isPro ? '<div class="pro-lock-badge"><i class="fas fa-lock"></i> PRO</div>' : ''}
                    <i class="fas fa-chevron-down service-expand-icon"></i>
                </div>
                <div class="service-accordion-content">
                    <div class="service-content-inner">
                        ${renderServiceContent(service, serviceData)}
                    </div>
                </div>
            `;
            
            return item;
        }

        // Get service preview data
        function getServicePreviewData(serviceId, data) {
            switch (serviceId) {
                case 'source_credibility':
                    const sourceScore = data.credibility_score || 0;
                    return [
                        { label: 'Score', value: `${sourceScore}/100`, color: getScoreColor(sourceScore) },
                        { label: 'Level', value: data.credibility_level || 'Unknown' }
                    ];
                    
                case 'author_analyzer':
                    const authorScore = data.credibility_score || 0;
                    return [
                        { label: 'Score', value: `${authorScore}/100`, color: getScoreColor(authorScore) },
                        { label: 'Status', value: data.verification_status?.verified ? 'Verified' : 'Unverified' }
                    ];
                    
                case 'bias_detector':
                    const biasScore = data.overall_bias_score || 0;
                    return [
                        { label: 'Bias Level', value: data.bias_level || 'Unknown' },
                        { label: 'Objectivity', value: `${100 - biasScore}%`, color: getScoreColor(100 - biasScore) }
                    ];
                    
                case 'fact_checker':
                    const verified = data.verified_claims || 0;
                    const total = data.total_claims || 0;
                    const accuracy = total > 0 ? Math.round((verified / total) * 100) : 0;
                    return [
                        { label: 'Claims Checked', value: total },
                        { label: 'Accuracy', value: `${accuracy}%`, color: getScoreColor(accuracy) }
                    ];
                    
                case 'transparency_analyzer':
                    const transparencyScore = data.transparency_score || 0;
                    return [
                        { label: 'Score', value: `${transparencyScore}%`, color: getScoreColor(transparencyScore) },
                        { label: 'Level', value: data.transparency_level || 'Unknown' }
                    ];
                    
                case 'manipulation_detector':
                    return [
                        { label: 'Risk Level', value: data.manipulation_level || 'Unknown' },
                        { label: 'Techniques', value: data.techniques_count || 0 }
                    ];
                    
                case 'content_analyzer':
                    const qualityScore = data.quality_score || 0;
                    return [
                        { label: 'Quality', value: `${qualityScore}/100`, color: getScoreColor(qualityScore) },
                        { label: 'Readability', value: data.readability?.level || 'Unknown' }
                    ];
                    
                case 'plagiarism_detector':
                    const originalityScore = data.originality_score || (100 - (data.similarity_score || 0));
                    return [
                        { label: 'Originality', value: `${originalityScore}%`, color: getScoreColor(originalityScore) },
                        { label: 'Status', value: originalityScore >= 80 ? 'Original' : 'Issues Found' }
                    ];
                    
                default:
                    return [{ label: 'Status', value: 'Analysis Complete' }];
            }
        }

        // Toggle accordion
        function toggleAccordion(serviceId) {
            const item = document.getElementById(`service-${serviceId}`);
            const isActive = item.classList.contains('active');
            
            // Close all other items
            document.querySelectorAll('.service-accordion-item').forEach(el => {
                if (el.id !== `service-${serviceId}`) {
                    el.classList.remove('active');
                }
            });
            
            // Toggle current item
            item.classList.toggle('active');
            
            // If opening, create/update visualizations after animation
            if (!isActive) {
                setTimeout(() => {
                    updateServiceVisualizations(serviceId);
                }, 300);
            }
        }

        // Update service visualizations
        function updateServiceVisualizations(serviceId) {
            const serviceData = currentAnalysis?.detailed_analysis?.[serviceId] || {};
            if (!serviceData || Object.keys(serviceData).length === 0) return;
            
            // Find all canvases in this service section
            const canvases = document.querySelectorAll(`#service-${serviceId} canvas`);
            canvases.forEach(canvas => {
                const chartType = canvas.getAttribute('data-chart-type');
                const chartData = canvas.getAttribute('data-chart-data');
                if (chartType && chartData) {
                    createServiceChart(canvas, chartType, JSON.parse(chartData));
                }
            });
        }

        // Create service chart
        function createServiceChart(canvas, type, data) {
            const ctx = canvas.getContext('2d');
            const chartId = canvas.id;
            
            // Destroy existing chart
            if (charts[chartId]) {
                charts[chartId].destroy();
            }
            
            // Create new chart based on type
            let config;
            switch (type) {
                case 'radar':
                    config = createRadarChartConfig(data);
                    break;
                case 'polarArea':
                    config = createPolarAreaChartConfig(data);
                    break;
                case 'bar':
                    config = createBarChartConfig(data);
                    break;
                default:
                    return;
            }
            
            charts[chartId] = new Chart(ctx, config);
        }

        // Render service content
        function renderServiceContent(service, data) {
            console.log(`Rendering content for ${service.id}:`, data);
            
            // Check if data exists
            if (!data || Object.keys(data).length === 0) {
                return `
                    <div class="empty-state">
                        <i class="fas fa-info-circle"></i>
                        <p class="empty-state-text">No data available</p>
                        <p class="empty-state-subtext">This analysis could not be completed</p>
                    </div>
                `;
            }
            
            // Check if service is locked
            if (service.isPro && !isPro) {
                return `
                    <div class="empty-state">
                        <i class="fas fa-lock"></i>
                        <p class="empty-state-text">Pro Feature</p>
                        <p class="empty-state-subtext">Upgrade to access ${service.name}</p>
                    </div>
                `;
            }
            
            switch (service.id) {
                case 'source_credibility':
                    return renderSourceCredibility(data);
                case 'author_analyzer':
                    return renderAuthorAnalysis(data);
                case 'bias_detector':
                    return renderBiasDetection(data);
                case 'fact_checker':
                    return renderFactChecker(data);
                case 'transparency_analyzer':
                    return renderTransparency(data);
                case 'manipulation_detector':
                    return renderManipulation(data);
                case 'content_analyzer':
                    return renderContentAnalysis(data);
                case 'plagiarism_detector':
                    return renderPlagiarism(data);
                default:
                    return '<p>Analysis complete</p>';
            }
        }

        // Service renderers
        function renderSourceCredibility(data) {
            const score = data.credibility_score || 0;
            const level = data.credibility_level || 'Unknown';
            const sourceName = data.source_name || 'Unknown Source';
            
            let content = `
                <div class="service-section">
                    <h4 class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Credibility Assessment
                    </h4>
                    <div class="service-results">
                        <div class="result-item">
                            <span class="result-label">Overall Score</span>
                            <span class="result-value">${score}/100</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Credibility Level</span>
                            <span class="status-badge status-${score >= 70 ? 'high' : score >= 40 ? 'medium' : 'low'}">
                                ${level}
                            </span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Source Name</span>
                            <span class="result-value">${sourceName}</span>
                        </div>
                    </div>
                </div>
            `;
            
            // Source details
            if (data.source_details) {
                const details = data.source_details;
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-building"></i>
                            Source Information
                        </h4>
                        <div class="service-results">
                            ${details.type ? `
                                <div class="result-item">
                                    <span class="result-label">Source Type</span>
                                    <span class="result-value">${details.type}</span>
                                </div>
                            ` : ''}
                            ${details.established ? `
                                <div class="result-item">
                                    <span class="result-label">Established</span>
                                    <span class="result-value">${details.established}</span>
                                </div>
                            ` : ''}
                            ${details.ownership ? `
                                <div class="result-item">
                                    <span class="result-label">Ownership</span>
                                    <span class="result-value">${details.ownership}</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            // Credibility factors
            if (data.factors || data.credibility_factors) {
                const factors = data.factors || data.credibility_factors;
                const chartId = `credibility-chart-${Date.now()}`;
                const chartData = {
                    labels: Object.keys(factors).map(k => formatFactorName(k)),
                    values: Object.values(factors).map(v => typeof v === 'number' ? v : (v.score || 0))
                };
                
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-list-check"></i>
                            Credibility Breakdown
                        </h4>
                        <div class="dimension-list">
                `;
                
                Object.entries(factors).forEach(([factor, value]) => {
                    const factorScore = typeof value === 'number' ? value : (value.score || 0);
                    content += `
                        <div class="dimension-item">
                            <div class="dimension-header">
                                <span class="dimension-name">${formatFactorName(factor)}</span>
                                <span class="dimension-score">${factorScore}%</span>
                            </div>
                            <div class="dimension-bar">
                                <div class="dimension-fill" style="width: ${factorScore}%; background: ${getDimensionColor(factorScore)};"></div>
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                    <div class="service-visualization">
                        <div class="chart-container">
                            <canvas id="${chartId}" data-chart-type="radar" data-chart-data='${JSON.stringify(chartData)}'></canvas>
                        </div>
                    </div>
                `;
            }
            
            // Summary
            if (data.summary || data.analysis_summary) {
                content += `
                    <div class="info-box">
                        <div class="info-box-title">
                            <i class="fas fa-lightbulb"></i>
                            Analysis Summary
                        </div>
                        <div class="info-box-content">
                            ${data.summary || data.analysis_summary}
                        </div>
                    </div>
                `;
            }
            
            return content;
        }

        function renderAuthorAnalysis(data) {
            const authorName = data.author_name || data.name || 'Unknown Author';
            const score = data.credibility_score || 0;
            const level = data.credibility_level || 'Unknown';
            
            let content = `
                <div class="service-section">
                    <h4 class="section-title">
                        <i class="fas fa-id-card"></i>
                        Author Information
                    </h4>
                    <div class="service-results">
                        <div class="result-item">
                            <span class="result-label">Name</span>
                            <span class="result-value">${authorName}</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Credibility Score</span>
                            <span class="result-value">${score}/100</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Credibility Level</span>
                            <span class="status-badge status-${score >= 70 ? 'high' : score >= 40 ? 'medium' : 'low'}">
                                ${level}
                            </span>
                        </div>
                    </div>
                </div>
            `;
            
            // Author details
            if (data.author_info) {
                const info = data.author_info;
                
                if (info.position || info.bio || info.expertise_areas?.length > 0) {
                    content += `
                        <div class="service-section">
                            <h4 class="section-title">
                                <i class="fas fa-graduation-cap"></i>
                                Professional Background
                            </h4>
                            <div class="service-results">
                    `;
                    
                    if (info.position) {
                        content += `
                            <div class="result-item">
                                <span class="result-label">Position</span>
                                <span class="result-value">${info.position}</span>
                            </div>
                        `;
                    }
                    
                    if (info.expertise_areas && info.expertise_areas.length > 0) {
                        content += `
                            <div class="result-item">
                                <span class="result-label">Areas of Expertise</span>
                                <span class="result-value">${info.expertise_areas.join(', ')}</span>
                            </div>
                        `;
                    }
                    
                    content += `
                            </div>
                        </div>
                    `;
                }
            }
            
            // Verification status
            if (data.verification_status) {
                const verStatus = data.verification_status;
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-check-circle"></i>
                            Verification Status
                        </h4>
                        <div class="service-results">
                            <div class="result-item">
                                <span class="result-label">Verification Level</span>
                                <span class="status-badge status-${verStatus.verified ? 'high' : 'low'}">
                                    ${verStatus.verified ? 'Verified' : 'Unverified'}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            return content;
        }

        function renderBiasDetection(data) {
            const overallBias = data.overall_bias_score || 0;
            const biasLevel = data.bias_level || 'Unknown';
            const objectivityScore = 100 - overallBias;
            
            let content = `
                <div class="service-section">
                    <h4 class="section-title">
                        <i class="fas fa-balance-scale"></i>
                        Overall Bias Assessment
                    </h4>
                    <div class="service-results">
                        <div class="result-item">
                            <span class="result-label">Bias Score</span>
                            <span class="result-value">${overallBias}/100</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Bias Level</span>
                            <span class="status-badge status-${overallBias <= 20 ? 'high' : overallBias <= 50 ? 'medium' : 'low'}">
                                ${biasLevel}
                            </span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Objectivity Score</span>
                            <span class="result-value">${objectivityScore}%</span>
                        </div>
                    </div>
                </div>
            `;
            
            // Bias dimensions
            if (data.dimensions || data.bias_dimensions) {
                const dimensions = data.dimensions || data.bias_dimensions;
                const chartId = `bias-chart-${Date.now()}`;
                const chartData = {
                    labels: [],
                    values: []
                };
                
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-chart-bar"></i>
                            Bias Dimensions Analysis
                        </h4>
                        <div class="dimension-list">
                `;
                
                Object.entries(dimensions).forEach(([dimension, dimData]) => {
                    let score, label;
                    
                    if (typeof dimData === 'object') {
                        score = Math.abs(dimData.score || 0) * 100;
                        label = dimData.label || dimension;
                    } else {
                        score = dimData;
                        label = formatDimensionName(dimension);
                    }
                    
                    chartData.labels.push(label);
                    chartData.values.push(score);
                    
                    content += `
                        <div class="dimension-item">
                            <div class="dimension-header">
                                <span class="dimension-name">${label}</span>
                                <span class="dimension-score">${score.toFixed(0)}%</span>
                            </div>
                            <div class="dimension-bar">
                                <div class="dimension-fill" style="width: ${score}%; background: ${getBiasColor(score)};"></div>
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                    <div class="service-visualization">
                        <div class="chart-container">
                            <canvas id="${chartId}" data-chart-type="polarArea" data-chart-data='${JSON.stringify(chartData)}'></canvas>
                        </div>
                    </div>
                `;
            }
            
            return content;
        }

        function renderFactChecker(data) {
            const verified = data.verified_claims || 0;
            const total = data.total_claims || 0;
            const accuracy = total > 0 ? Math.round((verified / total) * 100) : 0;
            
            let content = `
                <div class="service-section">
                    <h4 class="section-title">
                        <i class="fas fa-check-circle"></i>
                        Fact Checking Summary
                    </h4>
                    <div class="service-results">
                        <div class="result-item">
                            <span class="result-label">Claims Analyzed</span>
                            <span class="result-value">${total}</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Verified Claims</span>
                            <span class="result-value">${verified}</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Accuracy Rate</span>
                            <span class="result-value">${accuracy}%</span>
                        </div>
                    </div>
                    ${total > 0 ? `
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${accuracy}%"></div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            // Individual claims
            if (data.claims && data.claims.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-list"></i>
                            Individual Claims Analysis
                        </h4>
                        <div class="claims-list">
                `;
                
                data.claims.forEach(claim => {
                    const status = claim.verification_status || 'unverified';
                    const statusClass = status === 'verified' ? 'verified' : 
                                      status === 'false' ? 'false' : 'unverified';
                    const statusIcon = status === 'verified' ? 'fa-check' : 
                                     status === 'false' ? 'fa-times' : 'fa-question';
                    
                    content += `
                        <div class="claim-item">
                            <div class="claim-header">
                                <div class="claim-text">"${escapeHtml(claim.claim_text || claim.text)}"</div>
                                <div class="claim-status claim-${statusClass}">
                                    <i class="fas ${statusIcon}"></i>
                                    ${formatStatus(status)}
                                </div>
                            </div>
                            ${claim.fact_check_result || claim.verification_details ? `
                                <div class="claim-details">
                                    ${claim.fact_check_result || claim.verification_details}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            return content;
        }

        function renderTransparency(data) {
            const score = data.transparency_score || 0;
            const level = data.transparency_level || getTransparencyLevel(score);
            
            let content = `
                <div class="service-section">
                    <h4 class="section-title">
                        <i class="fas fa-eye"></i>
                        Transparency Assessment
                    </h4>
                    <div class="service-results">
                        <div class="result-item">
                            <span class="result-label">Transparency Score</span>
                            <span class="result-value">${score}%</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Transparency Level</span>
                            <span class="status-badge status-${score >= 70 ? 'high' : score >= 40 ? 'medium' : 'low'}">
                                ${level}
                            </span>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${score}%"></div>
                    </div>
                </div>
            `;
            
            // Transparency factors
            if (data.factors || data.transparency_factors) {
                const factors = data.factors || data.transparency_factors;
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-list-check"></i>
                            Transparency Checklist
                        </h4>
                        <div class="service-results">
                `;
                
                Object.entries(factors).forEach(([factor, value]) => {
                    const present = typeof value === 'boolean' ? value : (value.present || value.found || false);
                    
                    content += `
                        <div class="result-item">
                            <span class="result-label">${formatFactorName(factor)}</span>
                            <span class="result-value">
                                ${present ? 
                                    '<i class="fas fa-check" style="color: var(--accent);"></i> Present' : 
                                    '<i class="fas fa-times" style="color: var(--danger);"></i> Missing'}
                            </span>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            return content;
        }

        function renderManipulation(data) {
            const level = data.manipulation_level || 'Unknown';
            const score = data.manipulation_score || 0;
            const techniquesCount = data.techniques_count || 0;
            
            let content = `
                <div class="service-section">
                    <h4 class="section-title">
                        <i class="fas fa-mask"></i>
                        Manipulation Assessment
                    </h4>
                    <div class="service-results">
                        <div class="result-item">
                            <span class="result-label">Manipulation Level</span>
                            <span class="status-badge status-${level.toLowerCase() === 'low' || level.toLowerCase() === 'minimal' ? 'high' : level.toLowerCase() === 'moderate' ? 'medium' : 'low'}">
                                ${level}
                            </span>
                        </div>
                        ${techniquesCount !== undefined ? `
                            <div class="result-item">
                                <span class="result-label">Techniques Detected</span>
                                <span class="result-value">${techniquesCount}</span>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            // Manipulation techniques
            if (data.techniques && data.techniques.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-brain"></i>
                            Detected Manipulation Techniques
                        </h4>
                        <div class="techniques-grid">
                `;
                
                data.techniques.forEach(technique => {
                    content += `
                        <div class="technique-card">
                            <div class="technique-name">${technique.name || technique.type}</div>
                            <div class="technique-description">
                                ${technique.description || technique.details || technique.evidence}
                                ${technique.severity ? 
                                    `<span class="technique-severity severity-${technique.severity.toLowerCase()}">${technique.severity} severity</span>` : ''}
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            return content;
        }

        function renderContentAnalysis(data) {
            let content = `
                <div class="service-section">
                    <h4 class="section-title">
                        <i class="fas fa-file-alt"></i>
                        Content Quality Metrics
                    </h4>
                    <div class="service-results">
            `;
            
            if (data.quality_score !== undefined) {
                content += `
                    <div class="result-item">
                        <span class="result-label">Overall Quality</span>
                        <span class="result-value">${data.quality_score}/100</span>
                    </div>
                `;
            }
            
            if (data.readability) {
                if (data.readability.score !== undefined) {
                    content += `
                        <div class="result-item">
                            <span class="result-label">Readability Score</span>
                            <span class="result-value">${data.readability.score}/100</span>
                        </div>
                    `;
                }
                if (data.readability.level) {
                    content += `
                        <div class="result-item">
                            <span class="result-label">Reading Level</span>
                            <span class="result-value">${data.readability.level}</span>
                        </div>
                    `;
                }
            }
            
            content += `
                    </div>
                </div>
            `;
            
            return content;
        }

        function renderPlagiarism(data) {
            const similarity = data.similarity_score || 0;
            const originality = data.originality_score !== undefined ? data.originality_score : (100 - similarity);
            const status = originality >= 80 ? 'Original' : originality >= 60 ? 'Mostly Original' : 'Potential Issues';
            
            let content = `
                <div class="service-section">
                    <h4 class="section-title">
                        <i class="fas fa-copy"></i>
                        Plagiarism Check Results
                    </h4>
                    <div class="service-results">
                        <div class="result-item">
                            <span class="result-label">Originality Score</span>
                            <span class="result-value">${originality}%</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Similarity Score</span>
                            <span class="result-value">${similarity}%</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Status</span>
                            <span class="status-badge status-${originality >= 80 ? 'high' : originality >= 60 ? 'medium' : 'low'}">
                                ${status}
                            </span>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${originality}%; background: var(--accent);"></div>
                    </div>
                </div>
            `;
            
            // Matched sources
            if (data.matches && data.matches.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-link"></i>
                            Matched Sources
                        </h4>
                        <div class="claims-list">
                `;
                
                data.matches.forEach(match => {
                    const matchPercentage = match.similarity || match.match_percentage || 0;
                    content += `
                        <div class="claim-item">
                            <div class="claim-header">
                                <div class="claim-text">${match.source || match.url || 'Unknown source'}</div>
                                <div class="claim-status">
                                    ${matchPercentage}% match
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            return content;
        }

        // Chart configuration functions
        function createRadarChartConfig(data) {
            return {
                type: 'radar',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.values,
                        backgroundColor: 'rgba(99, 102, 241, 0.2)',
                        borderColor: 'rgba(99, 102, 241, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(99, 102, 241, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(99, 102, 241, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    }
                }
            };
        }

        function createPolarAreaChartConfig(data) {
            return {
                type: 'polarArea',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.values,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.5)',
                            'rgba(54, 162, 235, 0.5)',
                            'rgba(255, 206, 86, 0.5)',
                            'rgba(75, 192, 192, 0.5)',
                            'rgba(153, 102, 255, 0.5)',
                            'rgba(255, 159, 64, 0.5)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            };
        }

        function createBarChartConfig(data) {
            return {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.values,
                        backgroundColor: 'rgba(99, 102, 241, 0.5)',
                        borderColor: 'rgba(99, 102, 241, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            };
        }

        // Utility functions
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            
            // Make error messages more user-friendly
            let displayMessage = message;
            
            if (message.includes('timed out') || message.includes('timeout')) {
                displayMessage = 'The website took too long to respond. This might be due to the site blocking automated requests. Try a different article.';
            } else if (message.includes('extraction methods failed')) {
                displayMessage = 'Unable to extract article content. The website may be blocking our service or the URL might be invalid.';
            } else if (message.includes('Invalid URL')) {
                displayMessage = 'Please enter a valid news article URL starting with http:// or https://';
            } else if (message.includes('Analysis failed')) {
                displayMessage = 'Unable to analyze the article. Please try a different URL or check your internet connection.';
            }
            
            errorEl.textContent = displayMessage;
            errorEl.classList.add('active');
            
            setTimeout(() => {
                hideError();
            }, 10000);
        }

        function hideError() {
            const errorEl = document.getElementById('errorMessage');
            errorEl.classList.remove('active');
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        function hideResults() {
            document.getElementById('resultsSection').classList.remove('active');
        }

        function getScoreColor(score) {
            if (score >= 80) return '#10B981';
            if (score >= 60) return '#3B82F6';
            if (score >= 40) return '#F59E0B';
            return '#EF4444';
        }

        function getDimensionColor(score) {
            if (score >= 80) return 'var(--accent)';
            if (score >= 60) return 'var(--info)';
            if (score >= 40) return 'var(--warning)';
            return 'var(--danger)';
        }

        function getBiasColor(score) {
            // Lower bias score is better
            if (score <= 20) return 'var(--accent)';
            if (score <= 50) return 'var(--warning)';
            return 'var(--danger)';
        }

        function formatDate(dateString) {
            if (!dateString) return 'Unknown';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function formatFactorName(factor) {
            return factor
                .replace(/_/g, ' ')
                .replace(/\b\w/g, l => l.toUpperCase());
        }

        function formatDimensionName(dimension) {
            const dimensionNames = {
                'political': 'Political Bias',
                'ideological': 'Ideological Bias',
                'commercial': 'Commercial Bias',
                'sensational': 'Sensationalism',
                'cultural': 'Cultural Bias',
                'confirmation': 'Confirmation Bias'
            };
            return dimensionNames[dimension.toLowerCase()] || formatFactorName(dimension);
        }

        function formatStatus(status) {
            const statusNames = {
                'verified': 'Verified',
                'false': 'False',
                'unverified': 'Unverified',
                'partially_true': 'Partially True',
                'misleading': 'Misleading'
            };
            return statusNames[status.toLowerCase()] || status;
        }

        function getTransparencyLevel(score) {
            if (score >= 80) return 'Highly Transparent';
            if (score >= 60) return 'Transparent';
            if (score >= 40) return 'Partially Transparent';
            return 'Low Transparency';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Enhanced PDF download
        async function downloadPDF() {
            if (!currentAnalysis || !currentAnalysis.analysis || !currentAnalysis.article) {
                showError('No analysis available to download');
                return;
            }
            
            showLoading();
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                let yPosition = 20;
                const lineHeight = 7;
                const pageHeight = doc.internal.pageSize.height;
                const pageWidth = doc.internal.pageSize.width;
                const margin = 20;
                const contentWidth = pageWidth - (2 * margin);
                
                // Helper function to add text with page break check
                function addText(text, fontSize = 12, fontStyle = 'normal', indent = 0) {
                    doc.setFontSize(fontSize);
                    doc.setFont(undefined, fontStyle);
                    
                    const lines = doc.splitTextToSize(text, contentWidth - indent);
                    
                    lines.forEach(line => {
                        if (yPosition > pageHeight - 30) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        doc.text(line, margin + indent, yPosition);
                        yPosition += fontSize === 12 ? lineHeight : lineHeight + 2;
                    });
                }
                
                // Title Page
                doc.setFillColor(99, 102, 241);
                doc.rect(0, 0, pageWidth, 60, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(24);
                doc.setFont(undefined, 'bold');
                doc.text('TruthLens AI Analysis Report', pageWidth / 2, 30, { align: 'center' });
                
                doc.setFontSize(14);
                doc.setFont(undefined, 'normal');
                doc.text('Professional News Verification', pageWidth / 2, 45, { align: 'center' });
                
                doc.setTextColor(0, 0, 0);
                yPosition = 80;
                
                // Executive Summary
                addText('EXECUTIVE SUMMARY', 18, 'bold');
                yPosition += 5;
                
                addText(`URL: ${document.getElementById('urlInput').value}`, 12);
                addText(`Analysis Date: ${new Date().toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                })}`, 12);
                
                yPosition += 10;
                
                // Trust Score Box
                doc.setFillColor(240, 240, 240);
                doc.rect(margin, yPosition, contentWidth, 40, 'F');
                
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text(`Overall Trust Score: ${currentAnalysis.analysis.trust_score}/100`, margin + 10, yPosition + 15);
                
                doc.setFontSize(14);
                doc.text(`Trust Level: ${currentAnalysis.analysis.trust_level}`, margin + 10, yPosition + 30);
                
                yPosition += 50;
                
                // Article Information
                addText('ARTICLE INFORMATION', 16, 'bold');
                yPosition += 5;
                
                addText(`Title: ${currentAnalysis.article.title || 'Unknown'}`, 12);
                addText(`Author: ${currentAnalysis.article.author || 'Unknown'}`, 12);
                addText(`Source: ${currentAnalysis.article.domain || 'Unknown'}`, 12);
                addText(`Publication Date: ${formatDate(currentAnalysis.article.publish_date)}`, 12);
                addText(`Word Count: ${currentAnalysis.article.word_count || 'Unknown'}`, 12);
                
                yPosition += 10;
                
                // Trust Score Analysis
                addText('TRUST SCORE ANALYSIS', 16, 'bold');
                yPosition += 5;
                addText(getTrustSummaryExplanation(currentAnalysis.analysis.trust_score, currentAnalysis.analysis.trust_level, currentAnalysis.analysis), 12);
                
                yPosition += 10;
                
                // Component Scores
                addText('TRUST COMPONENTS', 16, 'bold');
                yPosition += 5;
                
                const detailedAnalysis = currentAnalysis.detailed_analysis || {};
                const components = [
                    {
                        name: 'Source Credibility',
                        score: detailedAnalysis.source_credibility?.credibility_score || 0,
                        explanation: getSourceCredibilityExplanation(detailedAnalysis.source_credibility)
                    },
                    {
                        name: 'Author Credibility',
                        score: detailedAnalysis.author_analyzer?.credibility_score || 0,
                        explanation: getAuthorCredibilityExplanation(detailedAnalysis.author_analyzer)
                    },
                    {
                        name: 'Objectivity Score',
                        score: 100 - (detailedAnalysis.bias_detector?.overall_bias_score || 0),
                        explanation: getObjectivityExplanation(detailedAnalysis.bias_detector)
                    },
                    {
                        name: 'Fact Accuracy',
                        score: calculateFactAccuracy(detailedAnalysis.fact_checker),
                        explanation: getFactAccuracyExplanation(detailedAnalysis.fact_checker)
                    }
                ];
                
                components.forEach(comp => {
                    addText(`${comp.name}: ${comp.score}%`, 12, 'bold');
                    addText(comp.explanation, 11, 'normal', 5);
                    yPosition += 3;
                });
                
                // Key Findings
                if (currentAnalysis.analysis.key_findings && currentAnalysis.analysis.key_findings.length > 0) {
                    yPosition += 10;
                    addText('KEY FINDINGS', 16, 'bold');
                    yPosition += 5;
                    
                    currentAnalysis.analysis.key_findings.forEach((finding, index) => {
                        const findingText = `${index + 1}. ${finding.text || finding.finding}`;
                        const severity = finding.severity === 'positive' ? '' : 
                                       finding.severity === 'high' ? '' : '';
                        addText(`${severity} ${findingText}`, 12, 'normal', 5);
                    });
                }
                
                // New page for detailed analysis
                doc.addPage();
                yPosition = 20;
                
                addText('DETAILED ANALYSIS', 18, 'bold');
                yPosition += 10;
                
                // Process each service
                services.forEach(service => {
                    const serviceData = detailedAnalysis[service.id];
                    if (!serviceData || Object.keys(serviceData).length === 0) return;
                    
                    // Add page break if needed
                    if (yPosition > pageHeight - 80) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    // Service header
                    doc.setFillColor(245, 245, 245);
                    doc.rect(margin, yPosition, contentWidth, 10, 'F');
                    addText(service.name.toUpperCase(), 14, 'bold');
                    yPosition += 5;
                    
                    // Service-specific content
                    const previewData = getServicePreviewData(service.id, serviceData);
                    previewData.forEach(item => {
                        addText(`${item.label}: ${item.value}`, 12);
                    });
                    
                    // Add service summary if available
                    if (serviceData.summary) {
                        yPosition += 3;
                        addText('Summary:', 12, 'bold');
                        addText(serviceData.summary, 11, 'normal', 5);
                    }
                    
                    yPosition += 10;
                });
                
                // Footer
                doc.setFontSize(10);
                doc.setTextColor(128, 128, 128);
                const totalPages = doc.internal.getNumberOfPages();
                
                for (let i = 1; i <= totalPages; i++) {
                    doc.setPage(i);
                    doc.text(
                        `Page ${i} of ${totalPages} | Generated by TruthLens AI | ${new Date().toLocaleDateString()}`,
                        pageWidth / 2,
                        pageHeight - 10,
                        { align: 'center' }
                    );
                }
                
                // Save the PDF
                const fileName = `truthlens-analysis-${Date.now()}.pdf`;
                doc.save(fileName);
                
            } catch (error) {
                console.error('PDF generation error:', error);
                showError('Failed to generate PDF report. Please try again.');
            } finally {
                hideLoading();
            }
        }

        // Share results
        function shareResults() {
            if (!currentAnalysis || !currentAnalysis.analysis) {
                showError('No analysis available to share');
                return;
            }
            
            const trustScore = currentAnalysis.analysis.trust_score || 0;
            const articleTitle = currentAnalysis.article.title || 'Article';
            
            const shareText = `TruthLens AI Analysis: "${articleTitle}" scored ${trustScore}/100 for trustworthiness. Check out the detailed analysis:`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'TruthLens AI Analysis',
                    text: shareText,
                    url: window.location.href
                }).catch(err => {
                    console.log('Share cancelled:', err);
                });
            } else {
                // Fallback: Copy link to clipboard
                const url = window.location.href;
                navigator.clipboard.writeText(`${shareText} ${url}`).then(() => {
                    showError('Analysis link copied to clipboard!');
                    setTimeout(hideError, 3000);
                }).catch(() => {
                    showError('Sharing is not supported on this device');
                });
            }
        }
    </script>
</body>
</html>
