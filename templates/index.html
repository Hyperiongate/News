<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TruthLens AI - Professional News Verification Platform</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
    
    <style>
        /* Modern Design System */
        :root {
            /* Premium Color Palette */
            --primary: #6366F1;
            --primary-dark: #4F46E5;
            --primary-light: #818CF8;
            --secondary: #EC4899;
            --accent: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --info: #3B82F6;
            
            /* Gradient variations for trust scores */
            --gradient-excellent: linear-gradient(135deg, #10B981 0%, #34D399 100%);
            --gradient-good: linear-gradient(135deg, #3B82F6 0%, #60A5FA 100%);
            --gradient-fair: linear-gradient(135deg, #F59E0B 0%, #FBBF24 100%);
            --gradient-poor: linear-gradient(135deg, #EF4444 0%, #F87171 100%);
            
            /* Neutral Colors */
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-400: #9CA3AF;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-800: #1F2937;
            --gray-900: #111827;
            
            /* Typography */
            --font-primary: 'Inter', -apple-system, sans-serif;
            --font-display: 'Space Grotesk', sans-serif;
            
            /* Spacing */
            --space-xs: 0.5rem;
            --space-sm: 1rem;
            --space-md: 1.5rem;
            --space-lg: 2rem;
            --space-xl: 3rem;
            --space-2xl: 4rem;
            
            /* Layout */
            --radius: 1rem;
            --radius-sm: 0.5rem;
            --radius-lg: 1.5rem;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            
            /* Gradients */
            --gradient-primary: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
            --gradient-premium: linear-gradient(135deg, #FFD93D 0%, #FFB344 100%);
            --gradient-dark: linear-gradient(180deg, #1F2937 0%, #111827 100%);
        }

        /* Global Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: var(--gray-50);
            color: var(--gray-900);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Premium Loading Animation */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            display: none;
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            position: relative;
        }

        .loading-spinner::before,
        .loading-spinner::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            border: 3px solid transparent;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }

        .loading-spinner::after {
            animation-delay: 0.3s;
            border-top-color: var(--secondary);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Premium Header */
        .header {
            background: white;
            border-bottom: 1px solid var(--gray-200);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-md) var(--space-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-primary);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .logo-text h1 {
            font-family: var(--font-display);
            font-size: 1.875rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-text p {
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        .pro-badge {
            background: var(--gradient-premium);
            color: var(--gray-900);
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Hero Section */
        .hero-section {
            background: white;
            padding: var(--space-2xl) 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .hero-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--space-lg);
            text-align: center;
        }

        .hero-title {
            font-family: var(--font-display);
            font-size: 3rem;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: var(--space-md);
            background: var(--gradient-dark);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero-subtitle {
            font-size: 1.25rem;
            color: var(--gray-600);
            margin-bottom: var(--space-xl);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Service Pills */
        .service-pills {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
            justify-content: center;
            margin-bottom: var(--space-xl);
        }

        .service-pill {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            padding: 0.5rem 1rem;
            background: var(--gray-100);
            border-radius: 999px;
            font-size: 0.875rem;
            color: var(--gray-700);
        }

        .service-pill i {
            color: var(--primary);
        }

        /* Input Section */
        .input-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            gap: var(--space-sm);
            align-items: center;
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-xs);
            transition: all 0.3s ease;
            box-shadow: var(--shadow-lg);
        }

        .input-wrapper:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1), var(--shadow-xl);
        }

        .url-input {
            flex: 1;
            padding: var(--space-md);
            border: none;
            font-size: 1rem;
            background: transparent;
            outline: none;
        }

        .analyze-button {
            padding: var(--space-md) var(--space-xl);
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            white-space: nowrap;
        }

        .analyze-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .analyze-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-xl) var(--space-lg);
        }

        /* Results Section */
        .results-section {
            display: none;
            animation: fadeInUp 0.6s ease;
        }

        .results-section.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Enhanced Trust Score Section */
        .trust-score-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .trust-score-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-lg);
        }

        .trust-score-content {
            display: grid;
            grid-template-columns: 240px 1fr;
            gap: var(--space-xl);
            align-items: center;
        }

        /* Enhanced Gauge Container */
        .trust-gauge-container {
            position: relative;
            width: 240px;
            height: 240px;
        }

        .trust-gauge-visual {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .gauge-background {
            position: absolute;
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background: var(--gray-100);
        }

        .gauge-fill {
            position: absolute;
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background: conic-gradient(
                from 180deg,
                transparent 0deg,
                var(--gauge-color, var(--primary)) var(--gauge-angle, 0deg),
                transparent var(--gauge-angle, 0deg)
            );
            mask: radial-gradient(circle at center, transparent 65%, black 65%);
            -webkit-mask: radial-gradient(circle at center, transparent 65%, black 65%);
            transition: all 0.8s ease;
        }

        .gauge-center {
            position: relative;
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: white;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2;
        }

        .gauge-score {
            font-size: 3rem;
            font-weight: 700;
            line-height: 1;
            margin-bottom: 0.25rem;
            background: var(--gauge-gradient, var(--gradient-primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .gauge-label {
            font-size: 0.875rem;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Trust Score Details */
        .trust-score-details h2 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: var(--space-sm);
        }

        .trust-level {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .trust-level-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .trust-level-excellent { 
            color: var(--accent); 
            background: rgba(16, 185, 129, 0.1);
        }
        .trust-level-good { 
            color: var(--info); 
            background: rgba(59, 130, 246, 0.1);
        }
        .trust-level-fair { 
            color: var(--warning); 
            background: rgba(245, 158, 11, 0.1);
        }
        .trust-level-poor { 
            color: var(--danger); 
            background: rgba(239, 68, 68, 0.1);
        }

        .trust-summary {
            color: var(--gray-700);
            line-height: 1.8;
            margin-bottom: var(--space-lg);
            font-size: 1.125rem;
        }

        /* What We Analyzed Section */
        .analysis-overview {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-lg);
            margin-bottom: var(--space-lg);
        }

        .analysis-overview-title {
            font-weight: 600;
            margin-bottom: var(--space-md);
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .analysis-overview-title i {
            color: var(--primary);
        }

        .analysis-dimensions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-sm);
        }

        .dimension-check {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            color: var(--gray-700);
        }

        .dimension-check i {
            color: var(--accent);
            font-size: 0.875rem;
        }

        /* Enhanced Trust Breakdown */
        .trust-breakdown {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-lg);
            margin-top: var(--space-lg);
            padding-top: var(--space-lg);
            border-top: 2px solid var(--gray-100);
        }

        .breakdown-item {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-md);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .breakdown-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--gray-200);
        }

        .breakdown-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-sm);
        }

        .breakdown-title {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-weight: 600;
            color: var(--gray-900);
        }

        .breakdown-icon {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .breakdown-positive { background: rgba(16, 185, 129, 0.1); color: var(--accent); }
        .breakdown-warning { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .breakdown-negative { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .breakdown-neutral { background: rgba(59, 130, 246, 0.1); color: var(--info); }

        .breakdown-score {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .breakdown-description {
            color: var(--gray-600);
            font-size: 0.875rem;
            line-height: 1.5;
            margin-bottom: var(--space-sm);
        }

        .breakdown-bar {
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .breakdown-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease;
            position: relative;
            overflow: hidden;
        }

        .breakdown-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                transparent 0%,
                rgba(255, 255, 255, 0.3) 50%,
                transparent 100%
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Download Section */
        .download-section {
            display: flex;
            gap: var(--space-sm);
        }

        .download-button {
            padding: var(--space-sm) var(--space-md);
            background: white;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius);
            color: var(--gray-700);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .download-button:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: var(--gray-50);
        }

        /* Article Info Section */
        .article-info-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
            box-shadow: var(--shadow-md);
        }

        .article-header {
            margin-bottom: var(--space-lg);
        }

        .article-title {
            font-size: 1.875rem;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: var(--space-md);
        }

        .article-meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-lg);
            color: var(--gray-600);
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .meta-item i {
            color: var(--primary);
        }

        /* Key Findings */
        .key-findings {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-lg);
            border-left: 4px solid var(--primary);
        }

        .key-findings-header {
            font-weight: 600;
            margin-bottom: var(--space-md);
            color: var(--primary);
        }

        .finding-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-sm);
            margin-bottom: var(--space-sm);
            line-height: 1.6;
        }

        .finding-item i {
            margin-top: 0.25rem;
            flex-shrink: 0;
        }

        .finding-positive i { color: var(--accent); }
        .finding-warning i { color: var(--warning); }
        .finding-negative i { color: var(--danger); }

        /* Service Cards Grid */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }

        /* Service Card */
        .service-card {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .service-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .service-card.locked {
            opacity: 0.8;
        }

        .service-header {
            padding: var(--space-lg);
            background: var(--gray-50);
            border-bottom: 1px solid var(--gray-200);
            position: relative;
        }

        .service-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-primary);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            margin-bottom: var(--space-sm);
        }

        .service-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: var(--space-xs);
        }

        .service-description {
            color: var(--gray-600);
            font-size: 0.875rem;
        }

        .pro-lock {
            position: absolute;
            top: var(--space-md);
            right: var(--space-md);
            background: var(--gradient-premium);
            color: var(--gray-900);
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .service-content {
            padding: var(--space-lg);
        }

        .service-visualization {
            margin-bottom: var(--space-lg);
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
        }

        .service-section {
            margin-bottom: var(--space-lg);
        }

        .service-section:last-child {
            margin-bottom: 0;
        }

        .section-title {
            font-weight: 600;
            margin-bottom: var(--space-sm);
            color: var(--gray-700);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .section-title i {
            color: var(--primary);
            font-size: 0.875rem;
        }

        .service-results {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-md);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-sm) 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 500;
            color: var(--gray-700);
        }

        .result-value {
            font-weight: 600;
            color: var(--gray-900);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-high { background: rgba(16, 185, 129, 0.1); color: var(--accent); }
        .status-medium { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .status-low { background: rgba(239, 68, 68, 0.1); color: var(--danger); }

        /* Progress Bar */
        .progress-bar {
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            margin: var(--space-md) 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* Dimension Bars */
        .dimension-item {
            margin-bottom: var(--space-md);
        }

        .dimension-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--space-xs);
        }

        .dimension-name {
            font-weight: 500;
            color: var(--gray-700);
        }

        .dimension-score {
            font-weight: 600;
            color: var(--gray-900);
        }

        .dimension-bar {
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
        }

        .dimension-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.6s ease;
        }

        .dimension-list {
            margin-top: var(--space-md);
        }

        /* Claim List */
        .claims-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .claim-item {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius);
            padding: var(--space-md);
            transition: all 0.3s ease;
        }

        .claim-item:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .claim-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-sm);
        }

        .claim-text {
            flex: 1;
            font-weight: 500;
            color: var(--gray-900);
            line-height: 1.5;
        }

        .claim-status {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .claim-verified { background: rgba(16, 185, 129, 0.1); color: var(--accent); }
        .claim-unverified { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .claim-false { background: rgba(239, 68, 68, 0.1); color: var(--danger); }

        .claim-details {
            margin-top: var(--space-sm);
            padding-top: var(--space-sm);
            border-top: 1px solid var(--gray-100);
            font-size: 0.875rem;
            color: var(--gray-600);
            line-height: 1.6;
        }

        /* Technique List */
        .techniques-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-md);
        }

        .technique-card {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-md);
            border: 1px solid transparent;
            transition: all 0.3s ease;
        }

        .technique-card:hover {
            border-color: var(--primary);
            background: white;
            box-shadow: var(--shadow-sm);
        }

        .technique-name {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-xs);
        }

        .technique-description {
            font-size: 0.875rem;
            color: var(--gray-600);
            line-height: 1.5;
        }

        .technique-severity {
            display: inline-block;
            margin-top: var(--space-sm);
            padding: 0.125rem 0.5rem;
            background: var(--gray-200);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
        }

        .severity-high { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .severity-medium { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .severity-low { background: rgba(59, 130, 246, 0.1); color: var(--info); }

        /* Info Box */
        .info-box {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: var(--space-md);
            margin-top: var(--space-md);
            border-left: 4px solid var(--info);
        }

        .info-box-title {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-xs);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .info-box-title i {
            color: var(--info);
        }

        .info-box-content {
            color: var(--gray-600);
            line-height: 1.6;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2rem;
            }

            .services-grid {
                grid-template-columns: 1fr;
            }

            .trust-score-content {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .trust-gauge-container {
                margin: 0 auto;
            }

            .trust-breakdown {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-direction: column;
                gap: var(--space-md);
            }

            .input-wrapper {
                flex-direction: column;
                padding: var(--space-md);
            }

            .analyze-button {
                width: 100%;
                justify-content: center;
            }

            .techniques-grid {
                grid-template-columns: 1fr;
            }

            .analysis-dimensions {
                grid-template-columns: 1fr;
            }
        }

        /* Error State */
        .error-message {
            background: #FEE2E2;
            border: 1px solid #FCA5A5;
            color: #991B1B;
            padding: var(--space-md);
            border-radius: var(--radius);
            margin-top: var(--space-md);
            display: none;
            animation: shake 0.5s ease;
            font-weight: 500;
            text-align: center;
        }

        .error-message.active {
            display: block;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Locked Content Overlay */
        .locked-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-lg);
        }

        .locked-content {
            text-align: center;
            padding: var(--space-lg);
        }

        .locked-icon {
            font-size: 3rem;
            color: var(--gray-400);
            margin-bottom: var(--space-md);
        }

        .locked-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: var(--space-sm);
        }

        .locked-description {
            color: var(--gray-600);
            margin-bottom: var(--space-lg);
        }

        .upgrade-button {
            padding: var(--space-sm) var(--space-lg);
            background: var(--gradient-premium);
            color: var(--gray-900);
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upgrade-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: var(--space-xl);
            color: var(--gray-500);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: var(--space-md);
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 1.125rem;
            margin-bottom: var(--space-sm);
        }

        .empty-state-subtext {
            font-size: 0.875rem;
            color: var(--gray-400);
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="logo-text">
                        <h1>TruthLens AI</h1>
                        <p>Professional News Verification</p>
                    </div>
                </div>
                <span class="pro-badge">PRO</span>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">Advanced AI-Powered News Analysis</h1>
            <p class="hero-subtitle">
                Verify news articles with our comprehensive suite of 9 specialized AI services.
                Get detailed insights on credibility, bias, manipulation, and more.
            </p>

            <!-- Service Pills -->
            <div class="service-pills">
                <div class="service-pill">
                    <i class="fas fa-newspaper"></i>
                    <span>Article Extraction</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-shield-alt"></i>
                    <span>Source Credibility</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-user-check"></i>
                    <span>Author Analysis</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-balance-scale"></i>
                    <span>Bias Detection</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-check-double"></i>
                    <span>Fact Checking</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-eye"></i>
                    <span>Transparency Analysis</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-mask"></i>
                    <span>Manipulation Detection</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-file-alt"></i>
                    <span>Content Analysis</span>
                </div>
                <div class="service-pill">
                    <i class="fas fa-copy"></i>
                    <span>Plagiarism Detection</span>
                </div>
            </div>

            <!-- Input Section -->
            <div class="input-container">
                <div class="input-wrapper">
                    <input 
                        type="url" 
                        id="urlInput" 
                        class="url-input" 
                        placeholder="Enter a news article URL to analyze..."
                        autocomplete="off"
                    >
                    <button id="analyzeBtn" class="analyze-button" onclick="analyzeArticle()">
                        <i class="fas fa-search"></i>
                        Analyze Article
                    </button>
                </div>
                <div id="errorMessage" class="error-message"></div>
                
                <!-- Example URLs for testing -->
                <div style="margin-top: 1.5rem; padding: 1rem; background: var(--gray-100); border-radius: var(--radius); text-align: center;">
                    <p style="color: var(--gray-700); font-size: 0.875rem; margin-bottom: 0.5rem;">
                        <strong>Note:</strong> Some sites like Washington Post block automated analysis. Try these instead:
                    </p>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center; margin-top: 0.5rem;">
                        <button onclick="tryExample('https://www.cnn.com')" style="padding: 0.25rem 0.75rem; background: white; border: 1px solid var(--gray-300); border-radius: var(--radius-sm); font-size: 0.813rem; cursor: pointer; transition: all 0.2s;">CNN</button>
                        <button onclick="tryExample('https://www.bbc.com/news')" style="padding: 0.25rem 0.75rem; background: white; border: 1px solid var(--gray-300); border-radius: var(--radius-sm); font-size: 0.813rem; cursor: pointer; transition: all 0.2s;">BBC News</button>
                        <button onclick="tryExample('https://www.reuters.com')" style="padding: 0.25rem 0.75rem; background: white; border: 1px solid var(--gray-300); border-radius: var(--radius-sm); font-size: 0.813rem; cursor: pointer; transition: all 0.2s;">Reuters</button>
                        <button onclick="tryExample('https://www.npr.org')" style="padding: 0.25rem 0.75rem; background: white; border: 1px solid var(--gray-300); border-radius: var(--radius-sm); font-size: 0.813rem; cursor: pointer; transition: all 0.2s;">NPR</button>
                        <button onclick="tryExample('https://www.theguardian.com')" style="padding: 0.25rem 0.75rem; background: white; border: 1px solid var(--gray-300); border-radius: var(--radius-sm); font-size: 0.813rem; cursor: pointer; transition: all 0.2s;">The Guardian</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Results Section -->
        <div id="resultsSection" class="results-section">
            <!-- Trust Score Section -->
            <div class="trust-score-section">
                <div class="trust-score-header">
                    <div>
                        <h2>Overall Trust Score</h2>
                    </div>
                    <div class="download-section">
                        <button class="download-button" onclick="downloadPDF()">
                            <i class="fas fa-file-pdf"></i>
                            Download Report
                        </button>
                        <button class="download-button" onclick="shareResults()">
                            <i class="fas fa-share-alt"></i>
                            Share
                        </button>
                    </div>
                </div>
                <div class="trust-score-content">
                    <div class="trust-gauge-container">
                        <div class="trust-gauge-visual">
                            <div class="gauge-background"></div>
                            <div class="gauge-fill" id="gaugeFill"></div>
                            <div class="gauge-center">
                                <div class="gauge-score" id="gaugeScore">0</div>
                                <div class="gauge-label">Trust Score</div>
                            </div>
                        </div>
                    </div>
                    <div class="trust-score-details">
                        <div id="trustLevel" class="trust-level"></div>
                        <p id="trustSummary" class="trust-summary"></p>
                        
                        <!-- What We Analyzed -->
                        <div class="analysis-overview">
                            <div class="analysis-overview-title">
                                <i class="fas fa-magnifying-glass-chart"></i>
                                What We Analyzed
                            </div>
                            <div class="analysis-dimensions">
                                <div class="dimension-check">
                                    <i class="fas fa-check"></i>
                                    <span>Source reputation & history</span>
                                </div>
                                <div class="dimension-check">
                                    <i class="fas fa-check"></i>
                                    <span>Author credentials & expertise</span>
                                </div>
                                <div class="dimension-check">
                                    <i class="fas fa-check"></i>
                                    <span>Political & ideological bias</span>
                                </div>
                                <div class="dimension-check">
                                    <i class="fas fa-check"></i>
                                    <span>Factual accuracy of claims</span>
                                </div>
                                <div class="dimension-check">
                                    <i class="fas fa-check"></i>
                                    <span>Transparency & disclosures</span>
                                </div>
                                <div class="dimension-check">
                                    <i class="fas fa-check"></i>
                                    <span>Manipulation tactics</span>
                                </div>
                                <div class="dimension-check">
                                    <i class="fas fa-check"></i>
                                    <span>Writing quality & structure</span>
                                </div>
                                <div class="dimension-check">
                                    <i class="fas fa-check"></i>
                                    <span>Original vs copied content</span>
                                </div>
                            </div>
                        </div>
                        
                        <div id="trustBreakdown" class="trust-breakdown"></div>
                    </div>
                </div>
            </div>

            <!-- Article Info Section -->
            <div class="article-info-section">
                <div class="article-header">
                    <h3 id="articleTitle" class="article-title"></h3>
                    <div id="articleMeta" class="article-meta"></div>
                </div>
                <div id="keyFindings" class="key-findings"></div>
            </div>

            <!-- Services Grid -->
            <div id="servicesGrid" class="services-grid"></div>
        </div>
    </main>

    <script>
        // Global state
        let currentAnalysis = null;
        let isAnalyzing = false;
        let charts = {};
        let isPro = true; // For development, keep pro features open

        // Service definitions - FIXED to match backend service names
        const services = [
            {
                id: 'source_credibility',
                name: 'Source Credibility',
                icon: 'fa-shield-alt',
                description: 'Evaluates the reliability and trustworthiness of the news source',
                isPro: false
            },
            {
                id: 'author_analyzer',
                name: 'Author Analysis',
                icon: 'fa-user-check',
                description: 'Analyzes author credentials and publishing history',
                isPro: false
            },
            {
                id: 'bias_detector',
                name: 'Bias Detection',
                icon: 'fa-balance-scale',
                description: 'Identifies political, ideological, and narrative biases',
                isPro: true
            },
            {
                id: 'fact_checker',
                name: 'Fact Verification',
                icon: 'fa-check-double',
                description: 'Verifies claims against trusted fact-checking databases',
                isPro: true
            },
            {
                id: 'transparency_analyzer',
                name: 'Transparency Analysis',
                icon: 'fa-eye',
                description: 'Evaluates source disclosure and funding transparency',
                isPro: true
            },
            {
                id: 'manipulation_detector',
                name: 'Manipulation Detection',
                icon: 'fa-mask',
                description: 'Detects emotional manipulation and propaganda techniques',
                isPro: true
            },
            {
                id: 'content_analyzer',
                name: 'Content Analysis',
                icon: 'fa-file-alt',
                description: 'Analyzes writing quality, structure, and coherence',
                isPro: true
            },
            {
                id: 'plagiarism_detector',
                name: 'Plagiarism Check',
                icon: 'fa-copy',
                description: 'Checks for copied content and proper attribution',
                isPro: true
            }
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            const urlInput = document.getElementById('urlInput');
            urlInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    analyzeArticle();
                }
            });
        });

        // Try example URL
        function tryExample(url) {
            document.getElementById('urlInput').value = url;
            document.getElementById('urlInput').focus();
        }

        // Main analysis function
        async function analyzeArticle() {
            const urlInput = document.getElementById('urlInput');
            const url = urlInput.value.trim();
            
            if (!url) {
                showError('Please enter a URL');
                return;
            }
            
            if (!isValidUrl(url)) {
                showError('Please enter a valid URL');
                return;
            }
            
            if (isAnalyzing) return;
            
            isAnalyzing = true;
            hideError();
            hideResults();
            showLoading();
            
            const analyzeBtn = document.getElementById('analyzeBtn');
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
            
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Analysis failed');
                }
                
                const data = await response.json();
                currentAnalysis = data;
                displayResults(data);
                
            } catch (error) {
                showError(error.message || 'Failed to analyze article');
            } finally {
                isAnalyzing = false;
                hideLoading();
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<i class="fas fa-search"></i> Analyze Article';
            }
        }

        // Display results
        function displayResults(data) {
            console.log('displayResults called with:', data);
            
            // Validate data structure
            if (!data) {
                console.error('No data provided to displayResults');
                showError('No analysis data received');
                return;
            }
            
            // Check if data is wrapped in another data object
            let analysisData = data;
            if (data.data && (data.data.analysis || data.data.article)) {
                analysisData = data.data;
            }
            
            // Ensure we have the expected structure
            const normalizedData = {
                analysis: analysisData.analysis || {
                    trust_score: 0,
                    trust_level: 'Unknown',
                    summary: 'Analysis incomplete',
                    key_findings: []
                },
                article: analysisData.article || {
                    title: 'Unknown Article',
                    author: 'Unknown',
                    domain: 'Unknown',
                    publish_date: null,
                    word_count: 0
                },
                detailed_analysis: analysisData.detailed_analysis || {}
            };
            
            console.log('Normalized analysis data:', normalizedData);
            console.log('=== DETAILED ANALYSIS CONTENT ===');
            console.log('Full detailed_analysis object:', JSON.stringify(normalizedData.detailed_analysis, null, 2));
            
            const resultsSection = document.getElementById('resultsSection');
            resultsSection.classList.add('active');
            
            // Display each component with error handling
            try {
                displayTrustScore(normalizedData.analysis, normalizedData.detailed_analysis);
            } catch (e) {
                console.error('Error displaying trust score:', e);
            }
            
            try {
                displayArticleInfo(normalizedData.article, normalizedData.analysis);
            } catch (e) {
                console.error('Error displaying article info:', e);
            }
            
            try {
                displayServiceCards(normalizedData);
            } catch (e) {
                console.error('Error displaying service cards:', e);
            }
            
            // Update currentAnalysis to the normalized data
            currentAnalysis = normalizedData;
            
            // Scroll to results
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Enhanced display trust score with better visuals and explanations
        function displayTrustScore(analysis, detailedAnalysis) {
            if (!analysis) {
                console.error('No analysis data provided to displayTrustScore');
                return;
            }
            
            const score = analysis.trust_score || 0;
            const level = analysis.trust_level || getTrustLevel(score);
            
            // Animate the gauge
            const gaugeFill = document.getElementById('gaugeFill');
            const gaugeScore = document.getElementById('gaugeScore');
            
            // Set colors based on score
            let gaugeColor, gaugeGradient, levelClass, levelIcon, levelText;
            if (score >= 80) {
                gaugeColor = '#10B981';
                gaugeGradient = 'var(--gradient-excellent)';
                levelClass = 'trust-level-excellent';
                levelIcon = 'fa-circle-check';
                levelText = 'Highly Trustworthy';
            } else if (score >= 60) {
                gaugeColor = '#3B82F6';
                gaugeGradient = 'var(--gradient-good)';
                levelClass = 'trust-level-good';
                levelIcon = 'fa-thumbs-up';
                levelText = 'Moderately Trustworthy';
            } else if (score >= 40) {
                gaugeColor = '#F59E0B';
                gaugeGradient = 'var(--gradient-fair)';
                levelClass = 'trust-level-fair';
                levelIcon = 'fa-exclamation-triangle';
                levelText = 'Low Trust - Be Cautious';
            } else {
                gaugeColor = '#EF4444';
                gaugeGradient = 'var(--gradient-poor)';
                levelClass = 'trust-level-poor';
                levelIcon = 'fa-circle-xmark';
                levelText = 'Very Low Trust - High Risk';
            }
            
            // Set CSS variables for gauge
            gaugeFill.style.setProperty('--gauge-color', gaugeColor);
            gaugeFill.style.setProperty('--gauge-angle', `${(score / 100) * 180}deg`);
            gaugeScore.style.setProperty('--gauge-gradient', gaugeGradient);
            
            // Animate score counter
            let currentScore = 0;
            const increment = score / 30;
            const timer = setInterval(() => {
                currentScore += increment;
                if (currentScore >= score) {
                    currentScore = score;
                    clearInterval(timer);
                }
                gaugeScore.textContent = Math.round(currentScore);
            }, 50);
            
            // Update trust level with icon
            document.getElementById('trustLevel').innerHTML = `
                <div class="trust-level-icon ${levelClass}">
                    <i class="fas ${levelIcon}"></i>
                </div>
                <span>${levelText}</span>
            `;
            
            // Enhanced summary based on score
            let summaryText = analysis.summary || '';
            if (!summaryText) {
                if (score >= 80) {
                    summaryText = "Great news! This article comes from a reputable source with strong journalistic standards. The content shows minimal bias and the facts have been verified. You can trust this information with high confidence.";
                } else if (score >= 60) {
                    summaryText = "This article is generally trustworthy but has some areas of concern. The source is established but may have slight biases. We recommend cross-checking key facts with other sources.";
                } else if (score >= 40) {
                    summaryText = "Caution advised. This article shows significant issues with credibility, bias, or factual accuracy. The source may have a history of misleading content. Please verify important claims independently.";
                } else {
                    summaryText = "Warning: This article has serious credibility issues. We detected major problems with the source reliability, high bias, and potential misinformation. We strongly recommend finding alternative sources for this topic.";
                }
            }
            document.getElementById('trustSummary').textContent = summaryText;
            
            // Create enhanced trust breakdown with explanations
            const breakdownData = [
                {
                    icon: 'fa-shield-alt',
                    title: 'Source Credibility',
                    score: detailedAnalysis?.source_credibility?.data?.credibility_score || 0,
                    description: getSourceCredibilityDescription(detailedAnalysis?.source_credibility?.data?.credibility_score || 0),
                    type: getBreakdownType(detailedAnalysis?.source_credibility?.data?.credibility_score || 0)
                },
                {
                    icon: 'fa-user-check',
                    title: 'Author Credibility',
                    score: detailedAnalysis?.author_analyzer?.data?.credibility_score || 0,
                    description: getAuthorCredibilityDescription(
                        detailedAnalysis?.author_analyzer?.data?.credibility_score || 0,
                        detailedAnalysis?.author_analyzer?.data?.author_name
                    ),
                    type: getBreakdownType(detailedAnalysis?.author_analyzer?.data?.credibility_score || 0)
                },
                {
                    icon: 'fa-balance-scale',
                    title: 'Objectivity Score',
                    score: 100 - (detailedAnalysis?.bias_detector?.data?.overall_bias_score || 0),
                    description: getBiasDescription(detailedAnalysis?.bias_detector?.data?.overall_bias_score || 0),
                    type: getBreakdownType(100 - (detailedAnalysis?.bias_detector?.data?.overall_bias_score || 0))
                },
                {
                    icon: 'fa-check-double',
                    title: 'Fact Accuracy',
                    score: calculateFactAccuracy(detailedAnalysis?.fact_checker?.data),
                    description: getFactAccuracyDescription(detailedAnalysis?.fact_checker?.data),
                    type: getBreakdownType(calculateFactAccuracy(detailedAnalysis?.fact_checker?.data))
                }
            ];
            
            let breakdownHtml = '';
            breakdownData.forEach(item => {
                const fillColor = item.type === 'positive' ? 'var(--gradient-excellent)' : 
                                item.type === 'neutral' ? 'var(--gradient-good)' :
                                item.type === 'warning' ? 'var(--gradient-fair)' : 'var(--gradient-poor)';
                
                breakdownHtml += `
                    <div class="breakdown-item">
                        <div class="breakdown-header">
                            <div class="breakdown-title">
                                <div class="breakdown-icon breakdown-${item.type}">
                                    <i class="fas ${item.icon}"></i>
                                </div>
                                <span>${item.title}</span>
                            </div>
                            <div class="breakdown-score">${item.score}%</div>
                        </div>
                        <div class="breakdown-description">${item.description}</div>
                        <div class="breakdown-bar">
                            <div class="breakdown-fill" style="width: 0%; background: ${fillColor};"></div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('trustBreakdown').innerHTML = breakdownHtml;
            
            // Animate the breakdown bars after a short delay
            setTimeout(() => {
                const bars = document.querySelectorAll('.breakdown-fill');
                bars.forEach((bar, index) => {
                    setTimeout(() => {
                        bar.style.width = `${breakdownData[index].score}%`;
                    }, index * 100);
                });
            }, 500);
        }

        // Helper functions for descriptions
        function getTrustLevel(score) {
            if (score >= 80) return 'Excellent';
            if (score >= 60) return 'Good';
            if (score >= 40) return 'Fair';
            return 'Poor';
        }

        function getSourceCredibilityDescription(score) {
            if (score === 0) {
                return "Unable to verify source. This may be a new or unrecognized website without established credibility.";
            } else if (score >= 80) {
                return "Established, reputable news source with strong editorial standards and fact-checking processes.";
            } else if (score >= 60) {
                return "Generally reliable source with good reputation, though may have occasional accuracy issues.";
            } else if (score >= 40) {
                return "Source has mixed credibility record. Known for some reliable reporting but also bias or errors.";
            } else {
                return "Source has poor credibility record with history of misinformation or strong bias.";
            }
        }

        function getAuthorCredibilityDescription(score, authorName) {
            const name = authorName || "the author";
            if (score === 0) {
                return "Author information not available. Unable to verify credentials or expertise.";
            } else if (score >= 80) {
                return `${name} is a verified journalist with strong credentials and expertise in this topic area.`;
            } else if (score >= 60) {
                return `${name} has some verified credentials but limited track record in this specific topic.`;
            } else if (score >= 40) {
                return `${name} has minimal verifiable credentials or mixed reputation for accuracy.`;
            } else {
                return `Unable to verify ${name}'s credentials or found concerning issues with past reporting.`;
            }
        }

        function getBiasDescription(biasScore) {
            const objectivity = 100 - biasScore;
            if (biasScore <= 20) {
                return "Excellent objectivity. The article presents facts with minimal bias or opinion.";
            } else if (biasScore <= 40) {
                return "Generally objective with slight bias detected in language or source selection.";
            } else if (biasScore <= 60) {
                return "Moderate bias present. The article shows clear perspective that may affect objectivity.";
            } else {
                return "Significant bias detected. The article heavily favors one perspective over others.";
            }
        }

        function getFactAccuracyDescription(factData) {
            if (!factData || !factData.total_claims || factData.total_claims === 0) {
                return "No factual claims found to verify. This may be an opinion piece or breaking news.";
            }
            const accuracy = calculateFactAccuracy(factData);
            const verified = factData.verified_claims || 0;
            const total = factData.total_claims;
            
            if (accuracy >= 80) {
                return `Excellent fact accuracy. ${verified} of ${total} claims verified as accurate.`;
            } else if (accuracy >= 60) {
                return `Good factual accuracy. ${verified} of ${total} claims verified, some unverifiable.`;
            } else if (accuracy >= 40) {
                return `Mixed factual accuracy. Only ${verified} of ${total} claims could be verified.`;
            } else {
                return `Poor factual accuracy. Only ${verified} of ${total} claims verified as accurate.`;
            }
        }

        // Calculate fact accuracy percentage
        function calculateFactAccuracy(factData) {
            if (!factData || !factData.total_claims || factData.total_claims === 0) {
                return 0;
            }
            const verified = factData.verified_claims || 0;
            const total = factData.total_claims;
            return Math.round((verified / total) * 100);
        }

        // Get breakdown type based on score
        function getBreakdownType(score) {
            if (score >= 80) return 'positive';
            if (score >= 60) return 'neutral';
            if (score >= 40) return 'warning';
            return 'negative';
        }

        // Display article info
        function displayArticleInfo(article, analysis) {
            console.log('=== ARTICLE INFO DEBUG ===');
            console.log('Article:', article);
            console.log('Analysis:', analysis);
            
            document.getElementById('articleTitle').textContent = article.title || 'Untitled Article';
            
            const metaHtml = `
                <div class="meta-item">
                    <i class="fas fa-user"></i>
                    <span>${article.author || 'Unknown Author'}</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-globe"></i>
                    <span>${article.domain || 'Unknown Source'}</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-calendar"></i>
                    <span>${formatDate(article.publish_date)}</span>
                </div>
                <div class="meta-item">
                    <i class="fas fa-clock"></i>
                    <span>${Math.ceil((article.word_count || 0) / 200)} min read</span>
                </div>
            `;
            document.getElementById('articleMeta').innerHTML = metaHtml;
            
            // Display key findings
            const findings = analysis.key_findings || [];
            console.log('Key findings:', findings);
            
            if (findings.length > 0) {
                let findingsHtml = '<h4 class="key-findings-header">Key Findings</h4>';
                findings.forEach(finding => {
                    const type = finding.severity === 'positive' ? 'positive' : 
                               finding.severity === 'high' ? 'negative' : 'warning';
                    const icon = type === 'positive' ? 'fa-check-circle' : 
                               type === 'negative' ? 'fa-times-circle' : 'fa-exclamation-circle';
                    
                    findingsHtml += `
                        <div class="finding-item finding-${type}">
                            <i class="fas ${icon}"></i>
                            <span>${escapeHtml(finding.text || finding.finding)}</span>
                        </div>
                    `;
                });
                document.getElementById('keyFindings').innerHTML = findingsHtml;
            } else {
                document.getElementById('keyFindings').innerHTML = `
                    <div class="info-box">
                        <div class="info-box-title">
                            <i class="fas fa-info-circle"></i>
                            Analysis Summary
                        </div>
                        <div class="info-box-content">
                            The detailed analysis of this article is complete. Review the individual service cards below for specific insights about credibility, bias, factual accuracy, and more.
                        </div>
                    </div>
                `;
            }
        }

        // Display service cards with full data
        function displayServiceCards(data) {
            const grid = document.getElementById('servicesGrid');
            grid.innerHTML = '';
            
            const detailedAnalysis = data.detailed_analysis || {};
            
            console.log('=== SERVICE CARDS DEBUG ===');
            console.log('Detailed analysis:', detailedAnalysis);
            console.log('Detailed analysis keys:', Object.keys(detailedAnalysis));
            
            services.forEach(service => {
                console.log(`Creating card for ${service.id}:`, detailedAnalysis[service.id]);
                
                // Handle service name mismatches
                let serviceData = detailedAnalysis[service.id];
                
                // Check for alternate names
                if (!serviceData) {
                    const alternateNames = {
                        'author_analyzer': 'author_analysis',
                        'author_analysis': 'author_analyzer',
                        'bias_detector': 'bias_analysis',
                        'bias_analysis': 'bias_detector',
                        'fact_checker': 'fact_verification',
                        'fact_verification': 'fact_checker'
                    };
                    
                    const alternateName = alternateNames[service.id];
                    if (alternateName && detailedAnalysis[alternateName]) {
                        serviceData = detailedAnalysis[alternateName];
                        console.log(`Using alternate name ${alternateName} for ${service.id}`);
                    }
                }
                
                const card = createServiceCard(service, data, serviceData);
                grid.appendChild(card);
            });
        }

        // Create service card with full content
        function createServiceCard(service, data, serviceData) {
            const card = document.createElement('div');
            card.className = 'service-card';
            if (service.isPro && !isPro) {
                card.classList.add('locked');
            }
            
            console.log(`Service ${service.id} raw data:`, serviceData);
            
            // Handle nested data structure - services return { success: true, data: {...} }
            let actualServiceData = serviceData || {};
            if (serviceData && serviceData.success && serviceData.data) {
                console.log(`Service ${service.id} has nested data structure`);
                actualServiceData = serviceData.data;
            }
            
            console.log(`Service ${service.id} actual data:`, actualServiceData);
            
            card.innerHTML = `
                <div class="service-header">
                    <div class="service-icon">
                        <i class="fas ${service.icon}"></i>
                    </div>
                    <h3 class="service-title">${service.name}</h3>
                    <p class="service-description">${service.description}</p>
                    ${service.isPro && !isPro ? '<div class="pro-lock"><i class="fas fa-lock"></i> PRO</div>' : ''}
                </div>
                <div class="service-content">
                    ${renderServiceContent(service, actualServiceData)}
                </div>
            `;
            
            // Add locked overlay if needed
            if (service.isPro && !isPro) {
                const overlay = document.createElement('div');
                overlay.className = 'locked-overlay';
                overlay.innerHTML = `
                    <div class="locked-content">
                        <i class="fas fa-lock locked-icon"></i>
                        <h4 class="locked-title">Pro Feature</h4>
                        <p class="locked-description">
                            Upgrade to Pro to access ${service.name} and unlock all advanced features
                        </p>
                        <button class="upgrade-button" onclick="showUpgradeModal()">
                            Upgrade to Pro
                        </button>
                    </div>
                `;
                card.appendChild(overlay);
            }
            
            return card;
        }

        // Render service-specific content with full data display
        function renderServiceContent(service, data) {
            console.log(`Rendering content for ${service.id}:`, data);
            
            // Check if data exists and has content
            if (!data || (Object.keys(data).length === 0 && !data.score && !data.level)) {
                return `
                    <div class="empty-state">
                        <i class="fas fa-info-circle"></i>
                        <p class="empty-state-text">No data available</p>
                        <p class="empty-state-subtext">This analysis could not be completed</p>
                    </div>
                `;
            }
            
            switch (service.id) {
                case 'source_credibility':
                    return renderSourceCredibility(data);
                case 'author_analyzer':
                    return renderAuthorAnalysis(data);
                case 'bias_detector':
                    return renderBiasDetection(data);
                case 'fact_checker':
                    return renderFactChecker(data);
                case 'transparency_analyzer':
                    return renderTransparency(data);
                case 'manipulation_detector':
                    return renderManipulation(data);
                case 'content_analyzer':
                    return renderContentAnalysis(data);
                case 'plagiarism_detector':
                    return renderPlagiarism(data);
                default:
                    return '<p>Analysis complete</p>';
            }
        }

        // Enhanced service renderers with full data display
        function renderSourceCredibility(data) {
            console.log('renderSourceCredibility data:', data);
            
            // Extract the score and level from various possible locations
            const score = data.credibility_score || data.score || data.source_credibility?.score || 0;
            const level = data.credibility_level || data.level || data.source_credibility?.level || 'Unknown';
            const sourceName = data.source_name || data.source?.name || data.name || 'Unknown Source';
            
            let content = '';
            
            // Main metrics
            content += `
                <div class="service-section">
                    <h4 class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Credibility Assessment
                    </h4>
                    <div class="service-results">
                        <div class="result-item">
                            <span class="result-label">Overall Score</span>
                            <span class="result-value">${score}/100</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Credibility Level</span>
                            <span class="status-badge status-${score >= 70 ? 'high' : score >= 40 ? 'medium' : 'low'}">
                                ${level}
                            </span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Source Name</span>
                            <span class="result-value">${sourceName}</span>
                        </div>
                    </div>
                </div>
            `;
            
            // Source details
            if (data.source_details || data.source) {
                const details = data.source_details || data.source;
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-building"></i>
                            Source Information
                        </h4>
                        <div class="service-results">
                            ${details.type ? `
                                <div class="result-item">
                                    <span class="result-label">Source Type</span>
                                    <span class="result-value">${details.type}</span>
                                </div>
                            ` : ''}
                            ${details.established || data.domain_age ? `
                                <div class="result-item">
                                    <span class="result-label">Established</span>
                                    <span class="result-value">${details.established || data.domain_age}</span>
                                </div>
                            ` : ''}
                            ${details.ownership ? `
                                <div class="result-item">
                                    <span class="result-label">Ownership</span>
                                    <span class="result-value">${details.ownership}</span>
                                </div>
                            ` : ''}
                            ${details.reach ? `
                                <div class="result-item">
                                    <span class="result-label">Reach</span>
                                    <span class="result-value">${details.reach}</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            // Credibility factors with visualization
            if (data.factors || data.credibility_factors) {
                const factors = data.factors || data.credibility_factors;
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-list-check"></i>
                            Credibility Breakdown
                        </h4>
                        <div class="dimension-list">
                `;
                
                Object.entries(factors).forEach(([factor, value]) => {
                    const factorScore = typeof value === 'number' ? value : (value.score || 0);
                    const factorLabel = formatFactorName(factor);
                    content += `
                        </div>
                    </div>
                `;
            }
            
            // Rhetorical devices
            if (data.rhetorical_devices && data.rhetorical_devices.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-comments"></i>
                            Rhetorical Devices Used
                        </h4>
                        <div class="techniques-grid">
                `;
                
                data.rhetorical_devices.forEach(device => {
                    content += `
                        <div class="technique-card">
                            <div class="technique-name">${device.name || device.type}</div>
                            <div class="technique-description">
                                ${device.purpose || device.effect || 'Used in article'}
                                ${device.example ? `<br><small>"${device.example}"</small>` : ''}
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            // Manipulation categories
            if (data.categories) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-layer-group"></i>
                            Manipulation Categories
                        </h4>
                        <div class="dimension-list">
                `;
                
                Object.entries(data.categories).forEach(([category, details]) => {
                    const score = typeof details === 'number' ? details : (details.score || details.count || 0);
                    const maxScore = typeof details === 'object' && details.max ? details.max : 100;
                    const percentage = maxScore > 0 ? (score / maxScore) * 100 : score;
                    
                    content += `
                        <div class="dimension-item">
                            <div class="dimension-header">
                                <span class="dimension-name">${formatFactorName(category)}</span>
                                <span class="dimension-score">${score}${typeof details === 'object' && details.max ? `/${details.max}` : '%'}</span>
                            </div>
                            <div class="dimension-bar">
                                <div class="dimension-fill" style="width: ${percentage}%; background: ${getDimensionColor(100 - percentage)};"></div>
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            // Summary
            if (data.summary) {
                content += `
                    <div class="info-box">
                        <div class="info-box-title">
                            <i class="fas fa-lightbulb"></i>
                            Analysis Summary
                        </div>
                        <div class="info-box-content">
                            ${data.summary}
                        </div>
                    </div>
                `;
            }
            
            return content;
        }

        function renderContentAnalysis(data) {
            console.log('renderContentAnalysis data:', data);
            
            let content = '';
            
            // Main quality metrics
            content += `
                <div class="service-section">
                    <h4 class="section-title">
                        <i class="fas fa-file-alt"></i>
                        Content Quality Metrics
                    </h4>
                    <div class="service-results">
            `;
            
            // Quality score
            if (data.quality_score !== undefined || data.overall_quality !== undefined) {
                const qualityScore = data.quality_score || data.overall_quality;
                content += `
                    <div class="result-item">
                        <span class="result-label">Overall Quality</span>
                        <span class="result-value">${qualityScore}/100</span>
                    </div>
                `;
            }
            
            // Readability
            if (data.readability) {
                const readability = data.readability;
                if (readability.score !== undefined) {
                    content += `
                        <div class="result-item">
                            <span class="result-label">Readability Score</span>
                            <span class="result-value">${readability.score}/100</span>
                        </div>
                    `;
                }
                if (readability.level) {
                    content += `
                        <div class="result-item">
                            <span class="result-label">Reading Level</span>
                            <span class="result-value">${readability.level}</span>
                        </div>
                    `;
                }
                if (readability.grade_level) {
                    content += `
                        <div class="result-item">
                            <span class="result-label">Grade Level</span>
                            <span class="result-value">Grade ${readability.grade_level}</span>
                        </div>
                    `;
                }
            }
            
            // Structure
            if (data.structure) {
                const structure = data.structure;
                if (structure.quality) {
                    content += `
                        <div class="result-item">
                            <span class="result-label">Structure Quality</span>
                            <span class="status-badge status-${structure.quality.toLowerCase() === 'excellent' || structure.quality.toLowerCase() === 'good' ? 'high' : 'medium'}">
                                ${structure.quality}
                            </span>
                        </div>
                    `;
                }
                if (structure.score !== undefined) {
                    content += `
                        <div class="result-item">
                            <span class="result-label">Structure Score</span>
                            <span class="result-value">${structure.score}/100</span>
                        </div>
                    `;
                }
            }
            
            // Grammar score
            if (data.grammar_score !== undefined) {
                content += `
                    <div class="result-item">
                        <span class="result-label">Grammar Score</span>
                        <span class="result-value">${data.grammar_score}/100</span>
                    </div>
                `;
            }
            
            content += `
                    </div>
                </div>
            `;
            
            // Content metrics breakdown
            if (data.metrics) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-chart-line"></i>
                            Detailed Metrics
                        </h4>
                        <div class="dimension-list">
                `;
                
                Object.entries(data.metrics).forEach(([metric, value]) => {
                    if (typeof value === 'number') {
                        content += `
                            <div class="dimension-item">
                                <div class="dimension-header">
                                    <span class="dimension-name">${formatMetricName(metric)}</span>
                                    <span class="dimension-score">${value}${metric.includes('score') || metric.includes('percentage') ? '%' : ''}</span>
                                </div>
                                <div class="dimension-bar">
                                    <div class="dimension-fill" style="width: ${metric.includes('score') || metric.includes('percentage') ? value : Math.min(value, 100)}%; background: ${getDimensionColor(value)};"></div>
                                </div>
                            </div>
                        `;
                    }
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            // Style analysis
            if (data.style_analysis || data.writing_style) {
                const style = data.style_analysis || data.writing_style;
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-pen-fancy"></i>
                            Writing Style Analysis
                        </h4>
                        <div class="service-results">
                            ${style.tone ? `
                                <div class="result-item">
                                    <span class="result-label">Tone</span>
                                    <span class="result-value">${style.tone}</span>
                                </div>
                            ` : ''}
                            ${style.voice ? `
                                <div class="result-item">
                                    <span class="result-label">Voice</span>
                                    <span class="result-value">${style.voice}</span>
                                </div>
                            ` : ''}
                            ${style.style || style.type ? `
                                <div class="result-item">
                                    <span class="result-label">Style</span>
                                    <span class="result-value">${style.style || style.type}</span>
                                </div>
                            ` : ''}
                            ${style.clarity ? `
                                <div class="result-item">
                                    <span class="result-label">Clarity</span>
                                    <span class="result-value">${style.clarity}</span>
                                </div>
                            ` : ''}
                            ${style.formality ? `
                                <div class="result-item">
                                    <span class="result-label">Formality</span>
                                    <span class="result-value">${style.formality}</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            // Text statistics
            if (data.text_statistics) {
                const stats = data.text_statistics;
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-calculator"></i>
                            Text Statistics
                        </h4>
                        <div class="service-results">
                            ${stats.sentence_count !== undefined ? `
                                <div class="result-item">
                                    <span class="result-label">Sentences</span>
                                    <span class="result-value">${stats.sentence_count}</span>
                                </div>
                            ` : ''}
                            ${stats.paragraph_count !== undefined ? `
                                <div class="result-item">
                                    <span class="result-label">Paragraphs</span>
                                    <span class="result-value">${stats.paragraph_count}</span>
                                </div>
                            ` : ''}
                            ${stats.avg_sentence_length !== undefined ? `
                                <div class="result-item">
                                    <span class="result-label">Avg. Sentence Length</span>
                                    <span class="result-value">${stats.avg_sentence_length.toFixed(1)} words</span>
                                </div>
                            ` : ''}
                            ${stats.complex_words_percentage !== undefined ? `
                                <div class="result-item">
                                    <span class="result-label">Complex Words</span>
                                    <span class="result-value">${stats.complex_words_percentage.toFixed(1)}%</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            // Issues found
            if (data.issues && data.issues.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Content Issues
                        </h4>
                        <div class="techniques-grid">
                `;
                
                data.issues.forEach(issue => {
                    content += `
                        <div class="technique-card">
                            <div class="technique-name">${issue.type || issue.category || 'Issue'}</div>
                            <div class="technique-description">
                                ${issue.description || issue.details}
                                ${issue.severity ? `<span class="technique-severity severity-${issue.severity.toLowerCase()}">${issue.severity}</span>` : ''}
                                ${issue.location ? `<br><small>Location: ${issue.location}</small>` : ''}
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            // Strengths and weaknesses
            if ((data.strengths && data.strengths.length > 0) || (data.weaknesses && data.weaknesses.length > 0)) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-clipboard-check"></i>
                            Content Assessment
                        </h4>
                `;
                
                if (data.strengths && data.strengths.length > 0) {
                    content += `
                        <div style="margin-bottom: 1rem;">
                            <h5 style="color: var(--accent); margin-bottom: 0.5rem;">
                                <i class="fas fa-thumbs-up"></i> Strengths
                            </h5>
                            <ul style="margin-left: 1.5rem; color: var(--gray-700);">
                                ${data.strengths.map(s => `<li>${s}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                if (data.weaknesses && data.weaknesses.length > 0) {
                    content += `
                        <div>
                            <h5 style="color: var(--warning); margin-bottom: 0.5rem;">
                                <i class="fas fa-thumbs-down"></i> Areas for Improvement
                            </h5>
                            <ul style="margin-left: 1.5rem; color: var(--gray-700);">
                                ${data.weaknesses.map(w => `<li>${w}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                content += `
                    </div>
                `;
            }
            
            // Summary
            if (data.summary) {
                content += `
                    <div class="info-box">
                        <div class="info-box-title">
                            <i class="fas fa-lightbulb"></i>
                            Analysis Summary
                        </div>
                        <div class="info-box-content">
                            ${data.summary}
                        </div>
                    </div>
                `;
            }
            
            return content;
        }

        function renderPlagiarism(data) {
            console.log('renderPlagiarism data:', data);
            
            // Handle empty data case
            if (!data || Object.keys(data).length === 0) {
                return `
                    <div class="empty-state">
                        <i class="fas fa-copy"></i>
                        <p class="empty-state-text">Plagiarism check not available</p>
                        <p class="empty-state-subtext">This service requires Pro access</p>
                    </div>
                `;
            }
            
            const similarity = data.similarity_score || data.plagiarism_score || data.similarity_percentage || 0;
            const originality = data.originality_score !== undefined ? data.originality_score : (100 - similarity);
            const status = data.status || (originality >= 80 ? 'Original' : originality >= 60 ? 'Mostly Original' : 'Potential Issues');
            
            let content = `
                <div class="service-section">
                    <h4 class="section-title">
                        <i class="fas fa-copy"></i>
                        Plagiarism Check Results
                    </h4>
                    <div class="service-results">
                        <div class="result-item">
                            <span class="result-label">Originality Score</span>
                            <span class="result-value">${originality}%</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Similarity Score</span>
                            <span class="result-value">${similarity}%</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Status</span>
                            <span class="status-badge status-${originality >= 80 ? 'high' : originality >= 60 ? 'medium' : 'low'}">
                                ${status}
                            </span>
                        </div>
                        ${data.sources_checked !== undefined ? `
                            <div class="result-item">
                                <span class="result-label">Sources Checked</span>
                                <span class="result-value">${data.sources_checked}</span>
                            </div>
                        ` : ''}
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${originality}%; background: var(--accent);"></div>
                    </div>
                </div>
            `;
            
            // Matched sources
            if (data.matches && data.matches.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-link"></i>
                            Matched Sources
                        </h4>
                        <div class="claims-list">
                `;
                
                data.matches.forEach(match => {
                    const matchPercentage = match.similarity || match.match_percentage || match.percentage || 0;
                    content += `
                        <div class="claim-item">
                            <div class="claim-header">
                                <div class="claim-text">${match.source || match.url || match.title || 'Unknown source'}</div>
                                <div class="claim-status">
                                    ${matchPercentage}% match
                                </div>
                            </div>
                            ${match.matched_text || match.excerpt ? `
                                <div class="claim-details">
                                    "${escapeHtml((match.matched_text || match.excerpt).substring(0, 150))}..."
                                    ${match.published_date ? `<br><small>Published: ${formatDate(match.published_date)}</small>` : ''}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            // Analysis breakdown
            if (data.analysis_breakdown) {
                const breakdown = data.analysis_breakdown;
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-chart-pie"></i>
                            Content Breakdown
                        </h4>
                        <div class="service-results">
                            ${breakdown.original_content !== undefined ? `
                                <div class="result-item">
                                    <span class="result-label">Original Content</span>
                                    <span class="result-value">${breakdown.original_content}%</span>
                                </div>
                            ` : ''}
                            ${breakdown.quoted_content !== undefined ? `
                                <div class="result-item">
                                    <span class="result-label">Properly Quoted</span>
                                    <span class="result-value">${breakdown.quoted_content}%</span>
                                </div>
                            ` : ''}
                            ${breakdown.paraphrased_content !== undefined ? `
                                <div class="result-item">
                                    <span class="result-label">Paraphrased</span>
                                    <span class="result-value">${breakdown.paraphrased_content}%</span>
                                </div>
                            ` : ''}
                            ${breakdown.potentially_plagiarized !== undefined ? `
                                <div class="result-item">
                                    <span class="result-label">Potentially Plagiarized</span>
                                    <span class="result-value" style="color: var(--danger);">${breakdown.potentially_plagiarized}%</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            // Recommendations
            if (data.recommendations && data.recommendations.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-lightbulb"></i>
                            Recommendations
                        </h4>
                        <ul style="margin-left: 1.5rem; color: var(--gray-700);">
                            ${data.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            // Summary
            if (data.summary || data.analysis_summary) {
                content += `
                    <div class="info-box">
                        <div class="info-box-title">
                            <i class="fas fa-info-circle"></i>
                            Analysis Summary
                        </div>
                        <div class="info-box-content">
                            ${data.summary || data.analysis_summary}
                        </div>
                    </div>
                `;
            }
            
            return content;
        }

        // Utility functions
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            
            // Make error messages more user-friendly
            let displayMessage = message;
            
            // Common error translations
            if (message.includes('timed out') || message.includes('timeout')) {
                displayMessage = 'The website took too long to respond. This might be due to the site blocking automated requests. Try a different article.';
            } else if (message.includes('extraction methods failed')) {
                displayMessage = 'Unable to extract article content. The website may be blocking our service or the URL might be invalid.';
            } else if (message.includes('Invalid URL')) {
                displayMessage = 'Please enter a valid news article URL starting with http:// or https://';
            } else if (message.includes('Analysis failed')) {
                displayMessage = 'Unable to analyze the article. Please try a different URL or check your internet connection.';
            }
            
            errorEl.textContent = displayMessage;
            errorEl.classList.add('active');
            
            // Hide error after 10 seconds
            setTimeout(() => {
                hideError();
            }, 10000);
        }

        function hideError() {
            const errorEl = document.getElementById('errorMessage');
            errorEl.classList.remove('active');
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        function hideResults() {
            document.getElementById('resultsSection').classList.remove('active');
        }

        function getScoreColor(score) {
            if (score >= 80) return '#10B981';
            if (score >= 60) return '#3B82F6';
            if (score >= 40) return '#F59E0B';
            return '#EF4444';
        }

        function getDimensionColor(score) {
            if (score >= 80) return 'var(--accent)';
            if (score >= 60) return 'var(--info)';
            if (score >= 40) return 'var(--warning)';
            return 'var(--danger)';
        }

        function getBiasColor(score) {
            // Lower bias score is better
            if (score <= 20) return 'var(--accent)';
            if (score <= 50) return 'var(--warning)';
            return 'var(--danger)';
        }

        function getEmotionColor(emotion) {
            const emotionColors = {
                'fear': '#EF4444',
                'anger': '#DC2626',
                'joy': '#10B981',
                'sadness': '#3B82F6',
                'trust': '#6366F1',
                'disgust': '#A855F7',
                'surprise': '#F59E0B',
                'anticipation': '#EC4899'
            };
            return emotionColors[emotion.toLowerCase()] || '#6B7280';
        }

        function formatDate(dateString) {
            if (!dateString) return 'Unknown';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function formatFactorName(factor) {
            return factor
                .replace(/_/g, ' ')
                .replace(/\b\w/g, l => l.toUpperCase());
        }

        function formatDimensionName(dimension) {
            const dimensionNames = {
                'political': 'Political Bias',
                'ideological': 'Ideological Bias',
                'commercial': 'Commercial Bias',
                'sensational': 'Sensationalism',
                'cultural': 'Cultural Bias',
                'confirmation': 'Confirmation Bias'
            };
            return dimensionNames[dimension.toLowerCase()] || formatFactorName(dimension);
        }

        function formatMetricName(metric) {
            return metric
                .replace(/_/g, ' ')
                .replace(/score/gi, '')
                .trim()
                .replace(/\b\w/g, l => l.toUpperCase());
        }

        function formatEmotionName(emotion) {
            return emotion.charAt(0).toUpperCase() + emotion.slice(1);
        }

        function formatStatus(status) {
            const statusNames = {
                'verified': 'Verified',
                'false': 'False',
                'unverified': 'Unverified',
                'partially_true': 'Partially True',
                'misleading': 'Misleading'
            };
            return statusNames[status.toLowerCase()] || status;
        }

        function getTransparencyLevel(score) {
            if (score >= 80) return 'Highly Transparent';
            if (score >= 60) return 'Transparent';
            if (score >= 40) return 'Partially Transparent';
            return 'Low Transparency';
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // PDF download with comprehensive report
        async function downloadPDF() {
            if (!currentAnalysis || !currentAnalysis.analysis || !currentAnalysis.article) {
                showError('No analysis available to download');
                return;
            }
            
            showLoading();
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                let yPosition = 20;
                const lineHeight = 7;
                const pageHeight = doc.internal.pageSize.height;
                const pageWidth = doc.internal.pageSize.width;
                const margin = 20;
                const contentWidth = pageWidth - (2 * margin);
                
                // Helper function to add text with page break check
                function addText(text, fontSize = 12, fontStyle = 'normal', indent = 0) {
                    doc.setFontSize(fontSize);
                    doc.setFont(undefined, fontStyle);
                    
                    const lines = doc.splitTextToSize(text, contentWidth - indent);
                    
                    lines.forEach(line => {
                        if (yPosition > pageHeight - 30) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        doc.text(line, margin + indent, yPosition);
                        yPosition += fontSize === 12 ? lineHeight : lineHeight + 2;
                    });
                }
                
                // Title Page
                doc.setFillColor(99, 102, 241);
                doc.rect(0, 0, pageWidth, 60, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(24);
                doc.setFont(undefined, 'bold');
                doc.text('TruthLens AI Analysis Report', pageWidth / 2, 30, { align: 'center' });
                
                doc.setFontSize(14);
                doc.setFont(undefined, 'normal');
                doc.text('Professional News Verification', pageWidth / 2, 45, { align: 'center' });
                
                doc.setTextColor(0, 0, 0);
                yPosition = 80;
                
                // Executive Summary
                addText('EXECUTIVE SUMMARY', 18, 'bold');
                yPosition += 5;
                
                addText(`URL: ${document.getElementById('urlInput').value}`, 12);
                addText(`Analysis Date: ${new Date().toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                })}`, 12);
                
                yPosition += 10;
                
                // Trust Score Box
                doc.setFillColor(240, 240, 240);
                doc.rect(margin, yPosition, contentWidth, 40, 'F');
                
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text(`Overall Trust Score: ${currentAnalysis.analysis.trust_score}/100`, margin + 10, yPosition + 15);
                
                doc.setFontSize(14);
                doc.text(`Trust Level: ${currentAnalysis.analysis.trust_level}`, margin + 10, yPosition + 30);
                
                yPosition += 50;
                
                // Article Information
                addText('ARTICLE INFORMATION', 16, 'bold');
                yPosition += 5;
                
                addText(`Title: ${currentAnalysis.article.title || 'Unknown'}`, 12);
                addText(`Author: ${currentAnalysis.article.author || 'Unknown'}`, 12);
                addText(`Source: ${currentAnalysis.article.domain || 'Unknown'}`, 12);
                addText(`Publication Date: ${formatDate(currentAnalysis.article.publish_date)}`, 12);
                addText(`Word Count: ${currentAnalysis.article.word_count || 'Unknown'}`, 12);
                
                yPosition += 10;
                
                // Analysis Summary
                addText('ANALYSIS SUMMARY', 16, 'bold');
                yPosition += 5;
                addText(currentAnalysis.analysis.summary || 'No summary available.', 12);
                
                // Key Findings
                if (currentAnalysis.analysis.key_findings && currentAnalysis.analysis.key_findings.length > 0) {
                    yPosition += 10;
                    addText('KEY FINDINGS', 16, 'bold');
                    yPosition += 5;
                    
                    currentAnalysis.analysis.key_findings.forEach((finding, index) => {
                        const findingText = `${index + 1}. ${finding.text || finding.finding}`;
                        const severity = finding.severity === 'positive' ? '' : 
                                       finding.severity === 'high' ? '' : '';
                        addText(`${severity} ${findingText}`, 12, 'normal', 5);
                    });
                }
                
                // New page for detailed analysis
                doc.addPage();
                yPosition = 20;
                
                addText('DETAILED ANALYSIS', 18, 'bold');
                yPosition += 10;
                
                // Process each service
                const detailedAnalysis = currentAnalysis.detailed_analysis || {};
                
                services.forEach(service => {
                    const serviceData = detailedAnalysis[service.id];
                    if (!serviceData) return;
                    
                    const actualData = serviceData.data || serviceData;
                    if (!actualData || Object.keys(actualData).length === 0) return;
                    
                    // Add page break if needed
                    if (yPosition > pageHeight - 80) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    // Service header
                    doc.setFillColor(245, 245, 245);
                    doc.rect(margin, yPosition, contentWidth, 10, 'F');
                    addText(service.name.toUpperCase(), 14, 'bold');
                    yPosition += 5;
                    
                    // Service-specific content
                    switch (service.id) {
                        case 'source_credibility':
                            if (actualData.credibility_score !== undefined) {
                                addText(`Credibility Score: ${actualData.credibility_score}/100`, 12);
                            }
                            if (actualData.credibility_level) {
                                addText(`Credibility Level: ${actualData.credibility_level}`, 12);
                            }
                            if (actualData.analysis_details) {
                                addText('Analysis:', 12, 'bold');
                                addText(actualData.analysis_details, 12, 'normal', 5);
                            }
                            break;
                            
                        case 'author_analyzer':
                            if (actualData.name) {
                                addText(`Author: ${actualData.name}`, 12);
                            }
                            if (actualData.credibility_score !== undefined) {
                                addText(`Author Credibility: ${actualData.credibility_score}/100`, 12);
                            }
                            if (actualData.credentials) {
                                addText(`Credentials: ${actualData.credentials}`, 12);
                            }
                            if (actualData.expertise_areas && actualData.expertise_areas.length > 0) {
                                addText(`Expertise: ${actualData.expertise_areas.join(', ')}`, 12);
                            }
                            break;
                            
                        case 'bias_detector':
                            if (actualData.overall_bias_score !== undefined) {
                                addText(`Bias Score: ${actualData.overall_bias_score}/100`, 12);
                            }
                            if (actualData.bias_level) {
                                addText(`Bias Level: ${actualData.bias_level}`, 12);
                            }
                            if (actualData.detected_biases && actualData.detected_biases.length > 0) {
                                addText('Detected Biases:', 12, 'bold');
                                actualData.detected_biases.forEach(bias => {
                                    addText(` ${bias.type || bias.name}: ${bias.description || bias.evidence}`, 12, 'normal', 5);
                                });
                            }
                            break;
                            
                        case 'fact_checker':
                            if (actualData.total_claims) {
                                addText(`Claims Analyzed: ${actualData.total_claims}`, 12);
                            }
                            if (actualData.verified_claims !== undefined) {
                                addText(`Verified Claims: ${actualData.verified_claims}`, 12);
                            }
                            if (actualData.claims && actualData.claims.length > 0) {
                                addText('Individual Claims:', 12, 'bold');
                                actualData.claims.forEach(claim => {
                                    addText(` "${claim.claim_text || claim.text}"`, 12, 'normal', 5);
                                    addText(`  Status: ${claim.verification_status || 'unverified'}`, 11, 'normal', 10);
                                });
                            }
                            break;
                            
                        case 'transparency_analyzer':
                            if (actualData.transparency_score !== undefined) {
                                addText(`Transparency Score: ${actualData.transparency_score}%`, 12);
                            }
                            if (actualData.transparency_issues && actualData.transparency_issues.length > 0) {
                                addText('Transparency Issues:', 12, 'bold');
                                actualData.transparency_issues.forEach(issue => {
                                    addText(` ${issue.description}`, 12, 'normal', 5);
                                });
                            }
                            break;
                            
                        case 'manipulation_detector':
                            if (actualData.manipulation_level) {
                                addText(`Manipulation Risk: ${actualData.manipulation_level}`, 12);
                            }
                            if (actualData.techniques_found && actualData.techniques_found.length > 0) {
                                addText('Detected Techniques:', 12, 'bold');
                                actualData.techniques_found.forEach(technique => {
                                    addText(` ${technique.name || technique.type}: ${technique.description || technique.evidence}`, 12, 'normal', 5);
                                });
                            }
                            break;
                            
                        case 'content_analyzer':
                            if (actualData.readability_score !== undefined) {
                                addText(`Readability Score: ${actualData.readability_score}/100`, 12);
                            }
                            if (actualData.reading_level) {
                                addText(`Reading Level: ${actualData.reading_level}`, 12);
                            }
                            if (actualData.structure_quality) {
                                addText(`Structure Quality: ${actualData.structure_quality}`, 12);
                            }
                            break;
                            
                        case 'plagiarism_detector':
                            const originality = actualData.similarity_score !== undefined ? 
                                100 - actualData.similarity_score : 100;
                            addText(`Originality Score: ${originality}%`, 12);
                            if (actualData.matched_sources && actualData.matched_sources.length > 0) {
                                addText('Matched Sources:', 12, 'bold');
                                actualData.matched_sources.forEach(source => {
                                    addText(` ${source.source || source.url}: ${source.similarity || source.match_percentage}% match`, 12, 'normal', 5);
                                });
                            }
                            break;
                    }
                    
                    yPosition += 10;
                });
                
                // Footer
                doc.setFontSize(10);
                doc.setTextColor(128, 128, 128);
                const totalPages = doc.internal.getNumberOfPages();
                
                for (let i = 1; i <= totalPages; i++) {
                    doc.setPage(i);
                    doc.text(
                        `Page ${i} of ${totalPages} | Generated by TruthLens AI | ${new Date().toLocaleDateString()}`,
                        pageWidth / 2,
                        pageHeight - 10,
                        { align: 'center' }
                    );
                }
                
                // Save the PDF
                const fileName = `truthlens-analysis-${Date.now()}.pdf`;
                doc.save(fileName);
                
            } catch (error) {
                console.error('PDF generation error:', error);
                showError('Failed to generate PDF report. Please try again.');
            } finally {
                hideLoading();
            }
        }

        // Share results
        function shareResults() {
            if (!currentAnalysis || !currentAnalysis.analysis) {
                showError('No analysis available to share');
                return;
            }
            
            const trustScore = currentAnalysis.analysis.trust_score || 0;
            const articleTitle = currentAnalysis.article.title || 'Article';
            
            const shareText = `TruthLens AI Analysis: "${articleTitle}" scored ${trustScore}/100 for trustworthiness. Check out the detailed analysis:`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'TruthLens AI Analysis',
                    text: shareText,
                    url: window.location.href
                }).catch(err => {
                    console.log('Share cancelled:', err);
                });
            } else {
                // Fallback: Copy link to clipboard
                const url = window.location.href;
                navigator.clipboard.writeText(`${shareText} ${url}`).then(() => {
                    showError('Analysis link copied to clipboard!');
                    setTimeout(hideError, 3000);
                }).catch(() => {
                    showError('Sharing is not supported on this device');
                });
            }
        }

        // Show upgrade modal (placeholder)
        function showUpgradeModal() {
            alert('Pro features coming soon! For now, all features are available.');
        }
    </script>
</body>
</html><div class="dimension-item">
                            <div class="dimension-header">
                                <span class="dimension-name">${factorLabel}</span>
                                <span class="dimension-score">${factorScore}%</span>
                            </div>
                            <div class="dimension-bar">
                                <div class="dimension-fill" style="width: ${factorScore}%; background: ${getDimensionColor(factorScore)};"></div>
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
                
                // Create radar chart visualization
                content += `
                    <div class="service-visualization">
                        <div class="chart-container">
                            <canvas id="credibilityChart-${Date.now()}"></canvas>
                        </div>
                    </div>
                `;
                
                // Create chart after DOM update
                setTimeout(() => {
                    const chartCanvas = document.querySelector('#servicesGrid canvas[id^="credibilityChart-"]');
                    if (chartCanvas && factors) {
                        const ctx = chartCanvas.getContext('2d');
                        const labels = Object.keys(factors).map(k => formatFactorName(k));
                        const values = Object.values(factors).map(v => 
                            typeof v === 'number' ? v : (v.score || 0)
                        );
                        
                        new Chart(ctx, {
                            type: 'radar',
                            data: {
                                labels: labels,
                                datasets: [{
                                    data: values,
                                    backgroundColor: 'rgba(99, 102, 241, 0.2)',
                                    borderColor: 'rgba(99, 102, 241, 1)',
                                    borderWidth: 2,
                                    pointBackgroundColor: 'rgba(99, 102, 241, 1)',
                                    pointBorderColor: '#fff',
                                    pointHoverBackgroundColor: '#fff',
                                    pointHoverBorderColor: 'rgba(99, 102, 241, 1)'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: { display: false }
                                },
                                scales: {
                                    r: {
                                        beginAtZero: true,
                                        max: 100,
                                        ticks: {
                                            stepSize: 20
                                        }
                                    }
                                }
                            }
                        });
                    }
                }, 100);
            }
            
            // Awards and recognitions
            if (data.awards && data.awards.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-trophy"></i>
                            Awards & Recognition
                        </h4>
                        <div class="techniques-grid">
                `;
                
                data.awards.forEach(award => {
                    content += `
                        <div class="technique-card">
                            <div class="technique-name">${award.name || award}</div>
                            ${award.year ? `<div class="technique-description">Awarded: ${award.year}</div>` : ''}
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            // Findings
            if (data.findings && data.findings.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-search"></i>
                            Key Findings
                        </h4>
                        <div class="claims-list">
                `;
                
                data.findings.forEach(finding => {
                    const severityClass = finding.severity === 'positive' ? 'verified' : 
                                        finding.severity === 'negative' ? 'false' : 'unverified';
                    content += `
                        <div class="claim-item">
                            <div class="claim-header">
                                <div class="claim-text">${finding.text}</div>
                                <div class="claim-status claim-${severityClass}">
                                    <i class="fas ${finding.severity === 'positive' ? 'fa-check' : 'fa-info'}"></i>
                                    ${finding.type || finding.severity}
                                </div>
                            </div>
                            ${finding.explanation ? `
                                <div class="claim-details">
                                    ${finding.explanation}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            // Summary
            if (data.summary || data.analysis_summary) {
                content += `
                    <div class="info-box">
                        <div class="info-box-title">
                            <i class="fas fa-lightbulb"></i>
                            Analysis Summary
                        </div>
                        <div class="info-box-content">
                            ${data.summary || data.analysis_summary}
                        </div>
                    </div>
                `;
            }
            
            return content;
        }

        function renderAuthorAnalysis(data) {
            console.log('renderAuthorAnalysis data:', data);
            
            // Extract author information from various possible locations
            const authorName = data.author_name || data.name || data.author_info?.name || 'Unknown Author';
            const authorScore = data.author_score || data.score || data.credibility_score || 0;
            const level = data.level || 'Unknown';
            
            let content = '';
            
            // Author information section
            content += `
                <div class="service-section">
                    <h4 class="section-title">
                        <i class="fas fa-id-card"></i>
                        Author Information
                    </h4>
                    <div class="service-results">
                        <div class="result-item">
                            <span class="result-label">Name</span>
                            <span class="result-value">${authorName}</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Credibility Score</span>
                            <span class="result-value">${authorScore}/100</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Credibility Level</span>
                            <span class="status-badge status-${authorScore >= 70 ? 'high' : authorScore >= 40 ? 'medium' : 'low'}">
                                ${level}
                            </span>
                        </div>
                    </div>
                </div>
            `;
            
            // Author details from author_info
            if (data.author_info) {
                const info = data.author_info;
                
                // Credentials and expertise
                if (info.position || info.bio || info.expertise_areas?.length > 0) {
                    content += `
                        <div class="service-section">
                            <h4 class="section-title">
                                <i class="fas fa-graduation-cap"></i>
                                Professional Background
                            </h4>
                            <div class="service-results">
                    `;
                    
                    if (info.position) {
                        content += `
                            <div class="result-item">
                                <span class="result-label">Position</span>
                                <span class="result-value">${info.position}</span>
                            </div>
                        `;
                    }
                    
                    if (info.bio) {
                        content += `
                            <div class="result-item" style="flex-direction: column; align-items: flex-start;">
                                <span class="result-label">Biography</span>
                                <span class="result-value" style="margin-top: 0.5rem; line-height: 1.6;">${info.bio}</span>
                            </div>
                        `;
                    }
                    
                    if (info.expertise_areas && info.expertise_areas.length > 0) {
                        content += `
                            <div class="result-item">
                                <span class="result-label">Areas of Expertise</span>
                                <span class="result-value">${info.expertise_areas.join(', ')}</span>
                            </div>
                        `;
                    }
                    
                    if (info.experience_years !== null && info.experience_years !== undefined) {
                        content += `
                            <div class="result-item">
                                <span class="result-label">Years of Experience</span>
                                <span class="result-value">${info.experience_years || 'Not specified'}</span>
                            </div>
                        `;
                    }
                    
                    content += `
                            </div>
                        </div>
                    `;
                }
                
                // Publications
                if (info.outlets && info.outlets.length > 0) {
                    content += `
                        <div class="service-section">
                            <h4 class="section-title">
                                <i class="fas fa-newspaper"></i>
                                Publications
                            </h4>
                            <div class="techniques-grid">
                                ${info.outlets.map(outlet => `
                                    <div class="technique-card">
                                        <div class="technique-name">${outlet}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                
                // Awards
                if (info.awards && info.awards.length > 0) {
                    content += `
                        <div class="service-section">
                            <h4 class="section-title">
                                <i class="fas fa-trophy"></i>
                                Awards & Recognition
                            </h4>
                            <div class="techniques-grid">
                                ${info.awards.map(award => `
                                    <div class="technique-card">
                                        <div class="technique-name">${award}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
            }
            
            // Verification status
            if (data.verification_status) {
                const verStatus = data.verification_status;
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-check-circle"></i>
                            Verification Status
                        </h4>
                        <div class="service-results">
                            <div class="result-item">
                                <span class="result-label">Verification Level</span>
                                <span class="status-badge status-${verStatus.verified ? 'high' : 'low'}">
                                    ${verStatus.verification_level || (verStatus.verified ? 'Verified' : 'Unverified')}
                                </span>
                            </div>
                            ${verStatus.verification_details && verStatus.verification_details.length > 0 ? `
                                <div class="result-item" style="flex-direction: column; align-items: flex-start;">
                                    <span class="result-label">Verification Details</span>
                                    <ul style="margin-top: 0.5rem; margin-left: 1rem;">
                                        ${verStatus.verification_details.map(detail => `<li>${detail}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            // Publication context
            if (data.publication_context) {
                const pubContext = data.publication_context;
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-building"></i>
                            Publication Context
                        </h4>
                        <div class="service-results">
                            <div class="result-item">
                                <span class="result-label">Publication</span>
                                <span class="result-value">${pubContext.name || 'Unknown'}</span>
                            </div>
                            ${pubContext.type ? `
                                <div class="result-item">
                                    <span class="result-label">Type</span>
                                    <span class="result-value">${pubContext.type}</span>
                                </div>
                            ` : ''}
                            ${pubContext.credibility_score !== undefined ? `
                                <div class="result-item">
                                    <span class="result-label">Publication Credibility</span>
                                    <span class="result-value">${pubContext.credibility_score}/100</span>
                                </div>
                            ` : ''}
                            ${pubContext.fact_checking !== undefined ? `
                                <div class="result-item">
                                    <span class="result-label">Fact Checking</span>
                                    <span class="result-value">
                                        ${pubContext.fact_checking ? 
                                            '<i class="fas fa-check" style="color: var(--accent);"></i> Yes' : 
                                            '<i class="fas fa-times" style="color: var(--danger);"></i> No'}
                                    </span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            // Findings
            if (data.findings && data.findings.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-search"></i>
                            Analysis Findings
                        </h4>
                        <div class="claims-list">
                `;
                
                data.findings.forEach(finding => {
                    const severityClass = finding.severity === 'low' ? 'verified' : 
                                        finding.severity === 'high' ? 'false' : 'unverified';
                    content += `
                        <div class="claim-item">
                            <div class="claim-header">
                                <div class="claim-text">${finding.text}</div>
                                <div class="claim-status claim-${severityClass}">
                                    ${finding.type || finding.severity}
                                </div>
                            </div>
                            ${finding.explanation ? `
                                <div class="claim-details">
                                    ${finding.explanation}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            // Summary
            if (data.summary) {
                content += `
                    <div class="info-box">
                        <div class="info-box-title">
                            <i class="fas fa-lightbulb"></i>
                            Analysis Summary
                        </div>
                        <div class="info-box-content">
                            ${data.summary}
                        </div>
                    </div>
                `;
            }
            
            return content;
        }

        function renderBiasDetection(data) {
            console.log('renderBiasDetection data:', data);
            
            // Extract bias information
            const overallBias = data.bias_score || data.overall_bias_score || data.score || 0;
            const biasLevel = data.level || data.bias_level || 'Unknown';
            const objectivityScore = data.objectivity_score || (100 - overallBias);
            
            let content = '';
            
            // Overall bias assessment
            content += `
                <div class="service-section">
                    <h4 class="section-title">
                        <i class="fas fa-balance-scale"></i>
                        Overall Bias Assessment
                    </h4>
                    <div class="service-results">
                        <div class="result-item">
                            <span class="result-label">Bias Score</span>
                            <span class="result-value">${overallBias}/100</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Bias Level</span>
                            <span class="status-badge status-${overallBias <= 20 ? 'high' : overallBias <= 50 ? 'medium' : 'low'}">
                                ${biasLevel}
                            </span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Objectivity Score</span>
                            <span class="result-value">${objectivityScore.toFixed(0)}%</span>
                        </div>
                        ${data.confidence !== undefined ? `
                            <div class="result-item">
                                <span class="result-label">Analysis Confidence</span>
                                <span class="result-value">${data.confidence}%</span>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            // Bias dimensions from either dimensions or detailed_analysis
            const dimensions = data.dimensions || data.bias_dimensions;
            const detailedAnalysis = data.detailed_analysis;
            
            if (dimensions || detailedAnalysis) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-chart-bar"></i>
                            Bias Dimensions Analysis
                        </h4>
                        <div class="dimension-list">
                `;
                
                if (dimensions) {
                    Object.entries(dimensions).forEach(([dimension, dimData]) => {
                        let score, label, explanation;
                        
                        if (typeof dimData === 'object') {
                            score = Math.abs(dimData.score || 0) * 100;
                            label = dimData.label || dimension;
                            explanation = dimData.explanation || '';
                        } else {
                            score = dimData;
                            label = formatDimensionName(dimension);
                            explanation = '';
                        }
                        
                        content += `
                            <div class="dimension-item">
                                <div class="dimension-header">
                                    <span class="dimension-name">${label}</span>
                                    <span class="dimension-score">${score.toFixed(0)}%</span>
                                </div>
                                <div class="dimension-bar">
                                    <div class="dimension-fill" style="width: ${score}%; background: ${getBiasColor(score)};"></div>
                                </div>
                                ${explanation ? `<div style="font-size: 0.875rem; color: var(--gray-600); margin-top: 0.25rem;">${explanation}</div>` : ''}
                            </div>
                        `;
                    });
                } else if (detailedAnalysis) {
                    // Handle detailed_analysis format
                    const analysisMap = {
                        'political_lean': { label: 'Political Bias', value: detailedAnalysis.political_label },
                        'sensationalism': { label: 'Sensationalism', value: detailedAnalysis.sensationalism },
                        'corporate_stance': { label: 'Corporate Bias', value: detailedAnalysis.corporate_stance },
                        'establishment_trust': { label: 'Establishment Bias', value: detailedAnalysis.establishment_trust }
                    };
                    
                    Object.entries(analysisMap).forEach(([key, info]) => {
                        if (info.value) {
                            content += `
                                <div class="dimension-item">
                                    <div class="dimension-header">
                                        <span class="dimension-name">${info.label}</span>
                                        <span class="dimension-score">${info.value}</span>
                                    </div>
                                </div>
                            `;
                        }
                    });
                }
                
                content += `
                        </div>
                    </div>
                `;
                
                // Create visualization if we have dimensional data
                if (dimensions && Object.keys(dimensions).length > 0) {
                    content += `
                        <div class="service-visualization">
                            <div class="chart-container">
                                <canvas id="biasChart-${Date.now()}"></canvas>
                            </div>
                        </div>
                    `;
                    
                    // Create chart after DOM update
                    setTimeout(() => {
                        const chartCanvas = document.querySelector('#servicesGrid canvas[id^="biasChart-"]');
                        if (chartCanvas) {
                            const ctx = chartCanvas.getContext('2d');
                            const labels = [];
                            const values = [];
                            
                            Object.entries(dimensions).forEach(([dimension, dimData]) => {
                                if (typeof dimData === 'object') {
                                    labels.push(dimData.label || formatDimensionName(dimension));
                                    values.push(Math.abs(dimData.score || 0) * 100);
                                } else {
                                    labels.push(formatDimensionName(dimension));
                                    values.push(dimData);
                                }
                            });
                            
                            new Chart(ctx, {
                                type: 'polarArea',
                                data: {
                                    labels: labels,
                                    datasets: [{
                                        data: values,
                                        backgroundColor: [
                                            'rgba(255, 99, 132, 0.5)',
                                            'rgba(54, 162, 235, 0.5)',
                                            'rgba(255, 206, 86, 0.5)',
                                            'rgba(75, 192, 192, 0.5)',
                                            'rgba(153, 102, 255, 0.5)',
                                            'rgba(255, 159, 64, 0.5)'
                                        ],
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: {
                                            position: 'right',
                                        }
                                    },
                                    scales: {
                                        r: {
                                            beginAtZero: true,
                                            max: 100
                                        }
                                    }
                                }
                            });
                        }
                    }, 100);
                }
            }
            
            // Loaded phrases
            if (data.loaded_phrases && data.loaded_phrases.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-quote-left"></i>
                            Loaded Language Detected
                        </h4>
                        <div class="claims-list">
                `;
                
                data.loaded_phrases.forEach(phrase => {
                    content += `
                        <div class="claim-item">
                            <div class="claim-header">
                                <div class="claim-text">"${phrase.text}"</div>
                                <div class="claim-status claim-${phrase.severity === 'high' ? 'false' : 'unverified'}">
                                    ${phrase.type || phrase.severity}
                                </div>
                            </div>
                            <div class="claim-details">
                                ${phrase.explanation || 'Potentially biased language'}
                                ${phrase.context ? `<br><small>Context: "${phrase.context}"</small>` : ''}
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            // Manipulation tactics
            if (data.manipulation_tactics && data.manipulation_tactics.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Manipulation Tactics
                        </h4>
                        <div class="techniques-grid">
                `;
                
                data.manipulation_tactics.forEach(tactic => {
                    content += `
                        <div class="technique-card">
                            <div class="technique-name">${tactic.name || tactic.type}</div>
                            <div class="technique-description">
                                ${tactic.description}
                                <span class="technique-severity severity-${(tactic.severity || 'medium').toLowerCase()}">${tactic.severity || 'medium'}</span>
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            // Source analysis
            if (data.source_analysis) {
                const sourceAnalysis = data.source_analysis;
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-users"></i>
                            Source Diversity
                        </h4>
                        <div class="service-results">
                            ${sourceAnalysis.total_sources !== undefined ? `
                                <div class="result-item">
                                    <span class="result-label">Total Sources</span>
                                    <span class="result-value">${sourceAnalysis.total_sources}</span>
                                </div>
                            ` : ''}
                            ${sourceAnalysis.diversity_score !== undefined ? `
                                <div class="result-item">
                                    <span class="result-label">Diversity Score</span>
                                    <span class="result-value">${sourceAnalysis.diversity_score}%</span>
                                </div>
                            ` : ''}
                            ${sourceAnalysis.primary_source ? `
                                <div class="result-item">
                                    <span class="result-label">Primary Source Type</span>
                                    <span class="result-value">${sourceAnalysis.primary_source}</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            // Findings
            if (data.findings && data.findings.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-search"></i>
                            Key Findings
                        </h4>
                        <div class="claims-list">
                `;
                
                data.findings.forEach(finding => {
                    const severityClass = finding.severity === 'low' ? 'verified' : 
                                        finding.severity === 'high' ? 'false' : 'unverified';
                    content += `
                        <div class="claim-item">
                            <div class="claim-header">
                                <div class="claim-text">${finding.text}</div>
                                <div class="claim-status claim-${severityClass}">
                                    ${finding.type || finding.severity}
                                </div>
                            </div>
                            ${finding.explanation ? `
                                <div class="claim-details">
                                    ${finding.explanation}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            // Summary
            if (data.summary) {
                content += `
                    <div class="info-box">
                        <div class="info-box-title">
                            <i class="fas fa-lightbulb"></i>
                            Analysis Summary
                        </div>
                        <div class="info-box-content">
                            ${data.summary}
                        </div>
                    </div>
                `;
            }
            
            return content;
        }

        function renderFactChecker(data) {
            console.log('renderFactChecker data:', data);
            
            const verified = data.verified_claims || data.claims_verified || 0;
            const total = data.total_claims || data.claims_analyzed || 0;
            const accuracy = total > 0 ? Math.round((verified / total) * 100) : 0;
            
            let content = `
                <div class="service-section">
                    <h4 class="section-title">
                        <i class="fas fa-check-circle"></i>
                        Fact Checking Summary
                    </h4>
                    <div class="service-results">
                        <div class="result-item">
                            <span class="result-label">Claims Analyzed</span>
                            <span class="result-value">${total}</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Verified Claims</span>
                            <span class="result-value">${verified}</span>
                        </div>
                        ${data.disputed_claims !== undefined ? `
                            <div class="result-item">
                                <span class="result-label">Disputed Claims</span>
                                <span class="result-value">${data.disputed_claims}</span>
                            </div>
                        ` : ''}
                        <div class="result-item">
                            <span class="result-label">Accuracy Rate</span>
                            <span class="result-value">${accuracy}%</span>
                        </div>
                    </div>
                    ${total > 0 ? `
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${accuracy}%"></div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            // Overall credibility
            if (data.overall_credibility !== undefined) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-shield-alt"></i>
                            Factual Credibility
                        </h4>
                        <div class="service-results">
                            <div class="result-item">
                                <span class="result-label">Credibility Score</span>
                                <span class="result-value">${data.overall_credibility}%</span>
                            </div>
                            ${data.confidence_level ? `
                                <div class="result-item">
                                    <span class="result-label">Confidence Level</span>
                                    <span class="status-badge status-${data.confidence_level.toLowerCase() === 'high' ? 'high' : 'medium'}">
                                        ${data.confidence_level}
                                    </span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            // Summary
            if (data.summary) {
                content += `
                    <div class="info-box">
                        <div class="info-box-title">
                            <i class="fas fa-lightbulb"></i>
                            Analysis Summary
                        </div>
                        <div class="info-box-content">
                            ${data.summary}
                        </div>
                    </div>
                `;
            }
            
            // Individual claims
            if (data.claims && data.claims.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-list"></i>
                            Individual Claims Analysis
                        </h4>
                        <div class="claims-list">
                `;
                
                data.claims.forEach(claim => {
                    const status = claim.verification_status || claim.status || 'unverified';
                    const statusClass = status === 'verified' || status === 'true' ? 'verified' : 
                                      status === 'false' || status === 'disputed' ? 'false' : 'unverified';
                    const statusIcon = status === 'verified' || status === 'true' ? 'fa-check' : 
                                     status === 'false' || status === 'disputed' ? 'fa-times' : 'fa-question';
                    
                    content += `
                        <div class="claim-item">
                            <div class="claim-header">
                                <div class="claim-text">"${escapeHtml(claim.claim || claim.claim_text || claim.text || 'Claim text unavailable')}"</div>
                                <div class="claim-status claim-${statusClass}">
                                    <i class="fas ${statusIcon}"></i>
                                    ${formatStatus(status)}
                                </div>
                            </div>
                            ${claim.explanation || claim.fact_check_result || claim.verification_details ? `
                                <div class="claim-details">
                                    ${claim.explanation || claim.fact_check_result || claim.verification_details}
                                    ${claim.sources && claim.sources.length > 0 ? 
                                        `<br><small>Sources: ${claim.sources.map(s => s.name || s).join(', ')}</small>` : ''}
                                    ${claim.confidence ? `<br><small>Confidence: ${claim.confidence}%</small>` : ''}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            // Claim categories if available
            if (data.claim_categories) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-chart-pie"></i>
                            Claim Categories
                        </h4>
                        <div class="dimension-list">
                `;
                
                Object.entries(data.claim_categories).forEach(([category, count]) => {
                    const percentage = total > 0 ? Math.round((count / total) * 100) : 0;
                    content += `
                        <div class="dimension-item">
                            <div class="dimension-header">
                                <span class="dimension-name">${formatFactorName(category)}</span>
                                <span class="dimension-score">${count} claims (${percentage}%)</span>
                            </div>
                            <div class="dimension-bar">
                                <div class="dimension-fill" style="width: ${percentage}%; background: var(--primary);"></div>
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            // Fact checking sources
            if (data.sources_used && data.sources_used.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-database"></i>
                            Verification Sources
                        </h4>
                        <div class="techniques-grid">
                            ${data.sources_used.map(source => `
                                <div class="technique-card">
                                    <div class="technique-name">${source.name || source}</div>
                                    ${source.type ? `<div class="technique-description">Type: ${source.type}</div>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            return content;
        }

        function renderTransparency(data) {
            console.log('renderTransparency data:', data);
            
            const score = data.transparency_score || data.score || 0;
            const level = data.transparency_level || data.level || getTransparencyLevel(score);
            
            let content = `
                <div class="service-section">
                    <h4 class="section-title">
                        <i class="fas fa-eye"></i>
                        Transparency Assessment
                    </h4>
                    <div class="service-results">
                        <div class="result-item">
                            <span class="result-label">Transparency Score</span>
                            <span class="result-value">${score}%</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Transparency Level</span>
                            <span class="status-badge status-${score >= 70 ? 'high' : score >= 40 ? 'medium' : 'low'}">
                                ${level}
                            </span>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${score}%"></div>
                    </div>
                </div>
            `;
            
            // Transparency factors
            if (data.factors || data.transparency_factors) {
                const factors = data.factors || data.transparency_factors;
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-list-check"></i>
                            Transparency Checklist
                        </h4>
                        <div class="service-results">
                `;
                
                Object.entries(factors).forEach(([factor, value]) => {
                    const present = typeof value === 'boolean' ? value : (value.present || value.found || false);
                    const score = typeof value === 'number' ? value : (value.score || 0);
                    
                    content += `
                        <div class="result-item">
                            <span class="result-label">${formatFactorName(factor)}</span>
                            <span class="result-value">
                                ${typeof value === 'boolean' || value.present !== undefined ?
                                    (present ? 
                                        '<i class="fas fa-check" style="color: var(--accent);"></i> Present' : 
                                        '<i class="fas fa-times" style="color: var(--danger);"></i> Missing') :
                                    `${score}%`
                                }
                            </span>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            // Disclosures found
            if (data.disclosures_found && data.disclosures_found.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-file-contract"></i>
                            Disclosures Found
                        </h4>
                        <div class="techniques-grid">
                `;
                
                data.disclosures_found.forEach(disclosure => {
                    content += `
                        <div class="technique-card">
                            <div class="technique-name">${disclosure.type || disclosure.name || 'Disclosure'}</div>
                            <div class="technique-description">
                                ${disclosure.content || disclosure.description || 'Information disclosed'}
                                ${disclosure.location ? `<br><small>Location: ${disclosure.location}</small>` : ''}
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            // Missing disclosures
            if (data.missing_disclosures && data.missing_disclosures.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-exclamation-circle"></i>
                            Missing Disclosures
                        </h4>
                        <div class="claims-list">
                `;
                
                data.missing_disclosures.forEach(missing => {
                    content += `
                        <div class="claim-item">
                            <div class="claim-header">
                                <div class="claim-text">${missing.type || missing.name || 'Required disclosure'}</div>
                                <div class="claim-status claim-false">
                                    <i class="fas fa-times"></i>
                                    Missing
                                </div>
                            </div>
                            ${missing.importance || missing.description ? `
                                <div class="claim-details">
                                    ${missing.importance || missing.description}
                                    ${missing.impact ? `<br><small>Impact: ${missing.impact}</small>` : ''}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            // Transparency issues
            if (data.issues && data.issues.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Transparency Issues
                        </h4>
                        <div class="techniques-grid">
                `;
                
                data.issues.forEach(issue => {
                    content += `
                        <div class="technique-card">
                            <div class="technique-name">${issue.type || issue.name || 'Issue'}</div>
                            <div class="technique-description">
                                ${issue.description || issue.details}
                                ${issue.severity ? `<span class="technique-severity severity-${issue.severity.toLowerCase()}">${issue.severity} severity</span>` : ''}
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            // Summary
            if (data.summary) {
                content += `
                    <div class="info-box">
                        <div class="info-box-title">
                            <i class="fas fa-lightbulb"></i>
                            Analysis Summary
                        </div>
                        <div class="info-box-content">
                            ${data.summary}
                        </div>
                    </div>
                `;
            }
            
            return content;
        }

        function renderManipulation(data) {
            console.log('renderManipulation data:', data);
            
            const level = data.manipulation_level || data.level || 'Low';
            const score = data.manipulation_score || data.score || 0;
            const riskScore = data.risk_score !== undefined ? data.risk_score : score;
            
            let content = `
                <div class="service-section">
                    <h4 class="section-title">
                        <i class="fas fa-mask"></i>
                        Manipulation Assessment
                    </h4>
                    <div class="service-results">
                        <div class="result-item">
                            <span class="result-label">Manipulation Level</span>
                            <span class="status-badge status-${level.toLowerCase() === 'low' || level.toLowerCase() === 'minimal' ? 'high' : level.toLowerCase() === 'moderate' ? 'medium' : 'low'}">
                                ${level}
                            </span>
                        </div>
                        ${riskScore !== undefined ? `
                            <div class="result-item">
                                <span class="result-label">Risk Score</span>
                                <span class="result-value">${riskScore}/100</span>
                            </div>
                        ` : ''}
                        ${data.techniques_count !== undefined ? `
                            <div class="result-item">
                                <span class="result-label">Techniques Detected</span>
                                <span class="result-value">${data.techniques_count}</span>
                            </div>
                        ` : ''}
                        ${data.confidence !== undefined ? `
                            <div class="result-item">
                                <span class="result-label">Detection Confidence</span>
                                <span class="result-value">${data.confidence}%</span>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            // Manipulation techniques
            if (data.techniques && data.techniques.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-brain"></i>
                            Detected Manipulation Techniques
                        </h4>
                        <div class="techniques-grid">
                `;
                
                data.techniques.forEach(technique => {
                    content += `
                        <div class="technique-card">
                            <div class="technique-name">${technique.name || technique.type}</div>
                            <div class="technique-description">
                                ${technique.description || technique.details || technique.evidence}
                                ${technique.severity ? 
                                    `<span class="technique-severity severity-${technique.severity.toLowerCase()}">${technique.severity} severity</span>` : ''}
                            </div>
                        </div>
                    `;
                });
                
                content += `
                        </div>
                    </div>
                `;
            }
            
            // Emotional tactics
            if (data.emotional_tactics && data.emotional_tactics.length > 0) {
                content += `
                    <div class="service-section">
                        <h4 class="section-title">
                            <i class="fas fa-heart"></i>
                            Emotional Manipulation Tactics
                        </h4>
                        <div class="claims-list">
                `;
                
                data.emotional_tactics.forEach(tactic => {
                    const impactClass = tactic.impact === 'high' ? 'false' : tactic.impact === 'low' ? 'verified' : 'unverified';
                    content += `
                        <div class="claim-item">
                            <div class="claim-header">
                                <div class="claim-text">${tactic.emotion || tactic.type}</div>
                                <div class="claim-status claim-${impactClass}">
                                    ${tactic.intensity || tactic.impact || 'Detected'}
                                </div>
                            </div>
                            ${tactic.evidence || tactic.description ? `
                                <div class="claim-details">
                                    ${tactic.evidence || tactic.description}
                                    ${tactic.examples && tactic.examples.length > 0 ? 
                                        `<br><small>Examples: "${tactic.examples.join('", "')}"</small>` : ''}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                content += `
