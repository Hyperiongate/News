<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detailed Text Analysis - Claim-by-Claim Breakdown</title>
    <style>
        :root {
            --primary-color: #1e40af;
            --secondary-color: #059669;
            --accent-color: #dc2626;
            --warning-color: #d97706;
            --success-color: #059669;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, var(--gray-50) 0%, #ffffff 100%);
            min-height: 100vh;
            line-height: 1.6;
            color: var(--gray-800);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .main-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: 1rem;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            font-size: 1.25rem;
            color: var(--gray-600);
            margin-bottom: 2rem;
        }
        
        /* Input Section */
        .analysis-section {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
            padding: 2.5rem;
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .text-input {
            width: 100%;
            min-height: 160px;
            padding: 1rem;
            border: 2px solid var(--gray-300);
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            line-height: 1.5;
            resize: vertical;
            transition: all 0.2s ease;
        }
        
        .text-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }
        
        .analyze-button {
            width: 100%;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--primary-color) 0%, #1e3a8a 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 1rem;
            transition: all 0.2s ease;
        }
        
        .analyze-button:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 8px 24px rgba(30, 64, 175, 0.3);
        }
        
        .analyze-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Results Section */
        .results-section {
            display: none;
        }
        
        .results-section.visible {
            display: block;
            animation: slideUp 0.4s ease;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Trust Score Display */
        .trust-score-header {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .trust-score-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            font-weight: 800;
            color: white;
        }
        
        .trust-very-high { background: linear-gradient(135deg, #059669 0%, #047857 100%); }
        .trust-high { background: linear-gradient(135deg, #0891b2 0%, #0e7490 100%); }
        .trust-moderate { background: linear-gradient(135deg, #d97706 0%, #b45309 100%); }
        .trust-low { background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); }
        .trust-very-low { background: linear-gradient(135deg, #991b1b 0%, #7f1d1d 100%); }
        
        /* Analysis Sections */
        .analysis-section-box {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .analysis-section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--gray-200);
        }
        
        .analysis-section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
        }
        
        .section-icon {
            font-size: 1.5rem;
        }
        
        /* Claims Analysis */
        .claim-item {
            background: var(--gray-50);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--gray-400);
        }
        
        .claim-item.true-claim {
            border-left-color: var(--success-color);
            background: #f0fdf4;
        }
        
        .claim-item.false-claim {
            border-left-color: var(--accent-color);
            background: #fef2f2;
        }
        
        .claim-item.misleading-claim {
            border-left-color: var(--warning-color);
            background: #fffbeb;
        }
        
        .claim-item.unverified-claim {
            border-left-color: var(--gray-400);
            background: var(--gray-50);
        }
        
        .claim-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .claim-number {
            background: var(--primary-color);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 600;
            flex-shrink: 0;
            margin-right: 1rem;
        }
        
        .claim-content {
            flex: 1;
        }
        
        .claim-text {
            font-size: 1rem;
            font-weight: 500;
            color: var(--gray-800);
            margin-bottom: 0.75rem;
            line-height: 1.5;
        }
        
        .claim-type {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            margin-bottom: 0.75rem;
        }
        
        .accuracy-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .accuracy-true { background: var(--success-color); color: white; }
        .accuracy-false { background: var(--accent-color); color: white; }
        .accuracy-misleading { background: var(--warning-color); color: white; }
        .accuracy-unverified { background: var(--gray-400); color: white; }
        
        .claim-explanation {
            margin-bottom: 0.75rem;
        }
        
        .explanation-text {
            font-size: 0.9375rem;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
        }
        
        .evidence-text {
            font-size: 0.875rem;
            color: var(--gray-600);
            font-style: italic;
        }
        
        /* Analysis Cards */
        .analysis-card {
            background: var(--gray-50);
            border-radius: 10px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }
        
        .analysis-card-header {
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 0.5rem;
        }
        
        .analysis-card-content {
            color: var(--gray-700);
            font-size: 0.9375rem;
        }
        
        .bias-indicator {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .bias-high { background: var(--accent-color); color: white; }
        .bias-medium { background: var(--warning-color); color: white; }
        .bias-low { background: var(--success-color); color: white; }
        .bias-none { background: var(--gray-300); color: var(--gray-700); }
        
        .loaded-language-list {
            list-style: none;
            padding: 0;
            margin: 0.5rem 0;
        }
        
        .loaded-language-item {
            display: inline-block;
            background: var(--gray-200);
            color: var(--gray-700);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            margin: 0.25rem 0.25rem 0.25rem 0;
            font-size: 0.8125rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .main-title {
                font-size: 2rem;
            }
            
            .analysis-section,
            .analysis-section-box,
            .trust-score-header {
                padding: 1.5rem;
            }
            
            .claim-header {
                flex-direction: column;
            }
            
            .claim-number {
                align-self: flex-start;
                margin-bottom: 0.5rem;
            }
        }
        
        /* Error states */
        .error-message {
            background: var(--accent-color);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: center;
        }
        
        /* No claims message */
        .no-claims {
            text-align: center;
            padding: 2rem;
            color: var(--gray-500);
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1 class="main-title">
                <span class="gradient-text">Detailed Text Analysis</span>
            </h1>
            <p class="subtitle">
                Get claim-by-claim analysis with accuracy assessment, bias detection, and source evaluation
            </p>
        </div>

        <!-- Input Section -->
        <div class="analysis-section">
            <h2 class="section-title">📝 Enter Text for Detailed Analysis</h2>
            
            <textarea 
                id="text-input" 
                class="text-input" 
                placeholder="Paste your text here for detailed claim-by-claim analysis...

Example: &quot;Trump can impose tariffs all that he wants and the importing country will have to pay them. The COVID-19 vaccines are causing more problems than they solve.&quot;

The system will identify specific claims and evaluate each one for accuracy, bias, and credibility."
                maxlength="50000">
            </textarea>
            
            <button class="analyze-button" id="analyze-btn">
                🔍 Analyze Claims & Credibility
            </button>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="results-section">
            <!-- Trust Score Header -->
            <div class="trust-score-header">
                <div class="trust-score-circle" id="trust-score-circle">
                    <span id="trust-score-number">--</span>
                </div>
                <h3>Overall Credibility Score</h3>
                <p id="analysis-summary">--</p>
            </div>

            <!-- Specific Claims Analysis -->
            <div class="analysis-section-box" id="claims-section">
                <div class="analysis-section-header">
                    <span class="section-icon">📋</span>
                    <h3 class="analysis-section-title">Specific Claims Analysis</h3>
                </div>
                <div id="claims-content">
                    <!-- Claims will be populated here -->
                </div>
            </div>

            <!-- Political Bias Analysis -->
            <div class="analysis-section-box" id="bias-section">
                <div class="analysis-section-header">
                    <span class="section-icon">⚖️</span>
                    <h3 class="analysis-section-title">Political Bias Analysis</h3>
                </div>
                <div id="bias-content">
                    <!-- Bias analysis will be populated here -->
                </div>
            </div>

            <!-- Manipulation Analysis -->
            <div class="analysis-section-box" id="manipulation-section">
                <div class="analysis-section-header">
                    <span class="section-icon">🎭</span>
                    <h3 class="analysis-section-title">Manipulation & Propaganda Analysis</h3>
                </div>
                <div id="manipulation-content">
                    <!-- Manipulation analysis will be populated here -->
                </div>
            </div>

            <!-- Source Information (only shown if external source) -->
            <div class="analysis-section-box" id="source-section" style="display: none;">
                <div class="analysis-section-header">
                    <span class="section-icon">🔗</span>
                    <h3 class="analysis-section-title">Source Information</h3>
                </div>
                <div id="source-content">
                    <!-- Source analysis will be populated here -->
                </div>
            </div>

            <!-- Author Information (only shown if author detected) -->
            <div class="analysis-section-box" id="author-section" style="display: none;">
                <div class="analysis-section-header">
                    <span class="section-icon">✍️</span>
                    <h3 class="analysis-section-title">Author Information</h3>
                </div>
                <div id="author-content">
                    <!-- Author analysis will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let isAnalyzing = false;
        
        const textInput = document.getElementById('text-input');
        const analyzeBtn = document.getElementById('analyze-btn');
        const resultsSection = document.getElementById('results-section');
        const trustScoreCircle = document.getElementById('trust-score-circle');
        const trustScoreNumber = document.getElementById('trust-score-number');
        const analysisSummary = document.getElementById('analysis-summary');
        
        analyzeBtn.addEventListener('click', analyzeContent);
        
        async function analyzeContent() {
            if (isAnalyzing) return;
            
            const content = textInput.value.trim();
            if (!content) {
                showError('Please enter some text to analyze.');
                return;
            }
            
            if (content.length < 10) {
                showError('Please enter at least 10 characters for meaningful analysis.');
                return;
            }
            
            setLoadingState(true);
            hideResults();
            
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: content
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Analysis failed');
                }
                
                displayDetailedResults(data);
                
            } catch (error) {
                console.error('Analysis error:', error);
                showError('Analysis failed: ' + error.message);
            } finally {
                setLoadingState(false);
            }
        }
        
        function displayDetailedResults(data) {
            // Update trust score
            const trustScore = data.trust_score || 0;
            trustScoreNumber.textContent = trustScore;
            analysisSummary.textContent = data.analysis_summary || 'Analysis completed';
            
            // Set trust score color
            trustScoreCircle.className = 'trust-score-circle';
            if (trustScore >= 80) {
                trustScoreCircle.classList.add('trust-very-high');
            } else if (trustScore >= 65) {
                trustScoreCircle.classList.add('trust-high');
            } else if (trustScore >= 50) {
                trustScoreCircle.classList.add('trust-moderate');
            } else if (trustScore >= 30) {
                trustScoreCircle.classList.add('trust-low');
            } else {
                trustScoreCircle.classList.add('trust-very-low');
            }
            
            // Display specific claims
            displayClaims(data.specific_claims || []);
            
            // Display bias analysis
            displayBiasAnalysis(data.political_bias || {});
            
            // Display manipulation analysis
            displayManipulationAnalysis(data.manipulation_analysis || {});
            
            // Display source information if available
            if (data.source_information && data.source_information.source_type !== 'Direct Text Input') {
                displaySourceInfo(data.source_information);
                document.getElementById('source-section').style.display = 'block';
            }
            
            // Display author information if available
            if (data.author_information && data.author_information.author_found) {
                displayAuthorInfo(data.author_information);
                document.getElementById('author-section').style.display = 'block';
            }
            
            showResults();
        }
        
        function displayClaims(claims) {
            const claimsContent = document.getElementById('claims-content');
            
            if (!claims.length) {
                claimsContent.innerHTML = '<div class="no-claims">No specific verifiable claims detected in the text.</div>';
                return;
            }
            
            claimsContent.innerHTML = claims.map(claim => `
                <div class="claim-item ${getClaimClass(claim.accuracy_assessment)}">
                    <div class="claim-header">
                        <div class="claim-number">${claim.claim_number}</div>
                        <div class="claim-content">
                            <div class="claim-text">"${claim.claim_text}"</div>
                            <div class="claim-type">${claim.claim_type}</div>
                            <div class="accuracy-status ${getAccuracyClass(claim.accuracy_assessment)}">
                                ${getAccuracyIcon(claim.accuracy_assessment)} ${claim.accuracy_assessment}
                            </div>
                        </div>
                    </div>
                    <div class="claim-explanation">
                        <div class="explanation-text"><strong>Analysis:</strong> ${claim.explanation}</div>
                        <div class="evidence-text"><strong>Evidence:</strong> ${claim.supporting_evidence}</div>
                    </div>
                </div>
            `).join('');
        }
        
        function displayBiasAnalysis(biasData) {
            const biasContent = document.getElementById('bias-content');
            
            const biasLevel = biasData.bias_level || 'Low';
            const biasDirection = biasData.political_leaning || 'None detected';
            const loadedLanguage = biasData.loaded_language || [];
            
            biasContent.innerHTML = `
                <div class="analysis-card">
                    <div class="analysis-card-header">Bias Level</div>
                    <div class="analysis-card-content">
                        <span class="bias-indicator ${getBiasClass(biasLevel)}">${biasLevel} Bias</span>
                        ${biasDirection !== 'None detected' ? ` - ${biasDirection} leaning` : ''}
                    </div>
                </div>
                <div class="analysis-card">
                    <div class="analysis-card-header">Analysis</div>
                    <div class="analysis-card-content">${biasData.explanation || 'No significant bias detected.'}</div>
                </div>
                ${loadedLanguage.length ? `
                <div class="analysis-card">
                    <div class="analysis-card-header">Loaded Language Detected</div>
                    <div class="analysis-card-content">
                        <ul class="loaded-language-list">
                            ${loadedLanguage.map(phrase => `<li class="loaded-language-item">"${phrase}"</li>`).join('')}
                        </ul>
                    </div>
                </div>
                ` : ''}
            `;
        }
        
        function displayManipulationAnalysis(manipData) {
            const manipContent = document.getElementById('manipulation-content');
            
            const riskLevel = manipData.risk_level || 'Low';
            const tacticsFound = manipData.tactics_found || [];
            
            manipContent.innerHTML = `
                <div class="analysis-card">
                    <div class="analysis-card-header">Manipulation Risk Level</div>
                    <div class="analysis-card-content">
                        <span class="bias-indicator ${getBiasClass(riskLevel)}">${riskLevel} Risk</span>
                    </div>
                </div>
                <div class="analysis-card">
                    <div class="analysis-card-header">Analysis</div>
                    <div class="analysis-card-content">${manipData.explanation || 'No significant manipulation tactics detected.'}</div>
                </div>
                ${tacticsFound.length ? `
                <div class="analysis-card">
                    <div class="analysis-card-header">Tactics Detected</div>
                    <div class="analysis-card-content">
                        <ul class="loaded-language-list">
                            ${tacticsFound.map(tactic => `<li class="loaded-language-item">${tactic}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                ` : ''}
            `;
        }
        
        function displaySourceInfo(sourceData) {
            const sourceContent = document.getElementById('source-content');
            
            sourceContent.innerHTML = `
                <div class="analysis-card">
                    <div class="analysis-card-header">Source Type</div>
                    <div class="analysis-card-content">${sourceData.source_type}</div>
                </div>
                <div class="analysis-card">
                    <div class="analysis-card-header">Credibility Rating</div>
                    <div class="analysis-card-content">${sourceData.credibility_rating}</div>
                </div>
                <div class="analysis-card">
                    <div class="analysis-card-header">Analysis</div>
                    <div class="analysis-card-content">${sourceData.source_analysis}</div>
                </div>
            `;
        }
        
        function displayAuthorInfo(authorData) {
            const authorContent = document.getElementById('author-content');
            
            authorContent.innerHTML = `
                <div class="analysis-card">
                    <div class="analysis-card-header">Author</div>
                    <div class="analysis-card-content">${authorData.author_name}</div>
                </div>
                <div class="analysis-card">
                    <div class="analysis-card-header">Credibility Assessment</div>
                    <div class="analysis-card-content">${authorData.author_analysis}</div>
                </div>
                <div class="analysis-card">
                    <div class="analysis-card-header">Background</div>
                    <div class="analysis-card-content">${authorData.background_info}</div>
                </div>
            `;
        }
        
        // Helper functions
        function getClaimClass(accuracy) {
            if (accuracy.includes('True')) return 'true-claim';
            if (accuracy.includes('False')) return 'false-claim';
            if (accuracy.includes('Misleading')) return 'misleading-claim';
            return 'unverified-claim';
        }
        
        function getAccuracyClass(accuracy) {
            if (accuracy.includes('True')) return 'accuracy-true';
            if (accuracy.includes('False')) return 'accuracy-false';
            if (accuracy.includes('Misleading')) return 'accuracy-misleading';
            return 'accuracy-unverified';
        }
        
        function getAccuracyIcon(accuracy) {
            if (accuracy.includes('True')) return '✅';
            if (accuracy.includes('False')) return '❌';
            if (accuracy.includes('Misleading')) return '⚠️';
            return '❓';
        }
        
        function getBiasClass(level) {
            const l = level.toLowerCase();
            if (l.includes('high')) return 'bias-high';
            if (l.includes('medium') || l.includes('moderate')) return 'bias-medium';
            if (l.includes('low')) return 'bias-low';
            return 'bias-none';
        }
        
        function setLoadingState(loading) {
            isAnalyzing = loading;
            
            if (loading) {
                analyzeBtn.disabled = true;
                analyzeBtn.innerHTML = `
                    <div class="loading-spinner"></div>
                    Analyzing Claims...
                `;
            } else {
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '🔍 Analyze Claims & Credibility';
            }
        }
        
        function showResults() {
            resultsSection.classList.add('visible');
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        function hideResults() {
            resultsSection.classList.remove('visible');
        }
        
        function showError(message) {
            document.querySelectorAll('.error-message').forEach(el => el.remove());
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.innerHTML = `⚠️ ${message}`;
            
            analyzeBtn.parentNode.insertBefore(errorDiv, analyzeBtn.nextSibling);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            textInput.focus();
        });
    </script>
</body>
</html>
